/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-animation-manager",function(a){a.namespace("Squarespace").AnimationManager=Class.create({initialize:function(){this._concurrentAnimations=[];
this._animationsFinished=false;
this._destroyed=false
},push:function(b){if(a.Lang.isArray(b)){for(var c=0;
c<b.length;
c++){this._concurrentAnimations.push(b[c])
}}else{this._concurrentAnimations.push(b)
}},run:function(e,c){this.callback=e;
this.context=c||this;
var d=function(){this._animEnd()
};
for(var b=0;
b<this._concurrentAnimations.length;
b++){this._concurrentAnimations[b].on("end",d,this);
this._concurrentAnimations[b].run()
}this._running=true
},stop:function(c){c=!!c;
for(var b=0;
b<this._concurrentAnimations.length;
b++){this._concurrentAnimations[b].stop(c);
this._animationsFinished=true
}if(this._running){this._running=false
}},_animEnd:function(){if(a.Array.every(this._concurrentAnimations,function(b){return !b.get("running")
})){this._animationsFinished=true;
this._running=false;
if(this.callback){this.callback.call(this.context)
}this.fire("end")
}},isRunning:function(){return this._running
},destroy:function(b){this.fire("destroy");
if(this._destroyed){throw"MultipleAnimationManager: Sorry bro, I'm already destroyed."
}this._destroyed=true;
this.stop(b);
for(var c=0;
c<this._concurrentAnimations.length;
c++){this._concurrentAnimations[c].destroy()
}if(this._running){this._running=false;
this._animationsFinished=!!b
}this.fire("destroyed")
},isDestroyed:function(){return this._destroyed
}});
a.augment(a.Squarespace.AnimationManager,a.EventTarget)
},"1.0");/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-gizmo",function(g){g.namespace("Squarespace");
var f="squarespace-";
var b="-bbox";
var d=new RegExp("[ ]+","g");
var e=new RegExp("[^a-zA-Z0-9\\-]","g");
var c=function(m,h,i,k,j){var l=j?g.Array.reject:g.Array.filter;
return l(m,function(p){for(var n=0;
n<i.length;
++n){var o=i[n];
var q=k[n];
if(p[o]!==q){return false
}}if(h){h(p)
}return true
})
};
var a=function(n,m,l,o,j){if(this._destroyed){return
}if(g.Lang.isArray(m)){return g.Array.map(m,function(h){return a.apply(this,[n].concat(g.Array(h)))
},this)
}if(g.Lang.isObject(m)&&g.Lang.isFunction(m[n])){var i=[l,o,j||this];
i=i.concat(Array.prototype.slice.call(arguments,5));
var k=m[n].apply(m,i);
this._eventSubList.push({object:m,event:l,eventSub:k});
return k
}else{throw"Gizmo["+this._name+"]: Could not subscribe to event: "+l
}};
g.Squarespace.Gizmo=Class.create({_name:"Gizmo",_events:{render:{},rendered:{},destroy:{},destroyed:{}},initialize:function(j){g.augment(this,g.EventTarget,true,null,{prefix:this._name});
this.params=g.merge(j);
this._initState();
var i=this;
var h=function(k,l){this.publish(l,k)
};
while(i!==null&&i!==undefined){g.Object.each(i._events,h,this);
i=i.superclass
}},getClassNames:function(){var i=this;
var h=[];
for(;
;
i=i.superclass){if(!i){return h
}h.push(i.getClassName())
}},_initState:function(){this._el=null;
this._parentEl=null;
this._eventSubList=[];
this._anims=[];
this._timers=[];
this._destroyed=false;
this._children=[];
this._guid=g.guid();
if(!this._name){this._name="No Name"
}},getClassName:function(){return this._name
},getId:function(){return this._guid
},getCssClassName:function(){var h=this._name;
h=h.trim().replace(d,"-").replace(e,"").toLowerCase();
return f+h
},getElement:function(){return this._el
},render:function(h){this.fire("render");
h=h||this._parentEl;
if(this.params.noBoundingBox){this._el=this._render()
}else{this._el=g.Node.create("<div></div>");
this._el.addClass(this.getCssClassName()+b);
this._el.append(this._render())
}if(h&&g.Lang.isFunction(h.append)){h.append(this._el)
}this._parentEl=h;
this.fire("rendered")
},_render:function(){},_subscribe:function(k,j,l,i){var h=["on"].concat(g.Array(arguments));
return a.apply(this,h)
},_subscribeOnce:function(k,j,l,i){var h=["once"].concat(g.Array(arguments));
return a.apply(this,h)
},_subscribeBefore:function(k,j,l,i){var h=["before"].concat(g.Array(arguments));
return a.apply(this,h)
},_subscribeAfter:function(k,j,l,i){var h=["after"].concat(g.Array(arguments));
return a.apply(this,h)
},_unsubscribe:function(j,i){var h=i?["object","event"]:["object"];
this._eventSubList=c(this._eventSubList,function(k){k.eventSub.detach()
},h,g.Array(arguments),true)
},_detach:function(h){this._eventSubList=c(this._eventSubList,function(i){i.eventSub.detach()
},["eventSub"],[h],true)
},_clearEvents:function(){var j=this._eventSubList;
for(var h=0;
h<j.length;
++h){j[h].eventSub.detach()
}this._eventSubList=[]
},destroy:function(){if(this._destroyed){console.warn("Gizmo["+this._name+"] already destroyed.");
return
}if(!this._eventSubList){console.error("Gizmo not initialized for...",this);
throw ("Gizmo["+this._name+"] was never initialzed.  Missing _super?")
}this.fire("destroy");
this._destroy();
var j=0;
this._clearEvents();
this._eventSubList=[];
var l=[];
g.Array.each(this._anims,function(i){l.push(i)
},this);
g.Array.each(l,function(i){if(i.get("running")){i.stop(false)
}i.destroy()
});
this._anims=null;
var k=this._children;
while(k.length>0){var n=k[0];
n._removeParent();
n.destroy()
}this._children=null;
var m=this._timers;
for(j=0;
j<m.length;
++j){var h=m[j];
h.cancel()
}this._timers=null;
if(this._el&&g.Lang.isFunction(this._el.remove)){this._el.remove();
this._el=null
}this._destroyed=true;
this.fire("destroyed")
},_destroy:function(){},isDestroyed:function(){return this._destroyed
},_setParent:function(h){this._parentGizmo=h
},_removeParent:function(){if(this._parentGizmo){this._parentGizmo._removeChild(this);
this._parentGizmo=null
}},_addChild:function(h){if(!this._children){return
}if(h._setParent){h._setParent(this)
}this._children.push(h)
},_removeChild:function(h){this._children.splice(this._children.indexOf(h),1)
},_getChildren:function(){return this._children
},_anim:function(i){if(this.destroyed){return
}if(!i.node){throw"Gizmo["+this._name+"]: Animation must specify a node!"
}var h;
if(!i.node.ancestor("body",true)){console.warn("Gizmo["+this._name+"]: _anim passed a YUI node not in the DOM! Returning an empty animation.");
h=new g.Anim()
}else{if(!i.node._node){console.warn("Gizmo["+this._name+"]: _anim passed a YUI node with _node = null! Returning an empty animation.");
console.trace();
h=new g.Anim()
}else{h=new g.Anim(i);
h.on("end",function(j){this._removeAnim(h)
},this);
this._anims.push(h)
}}return h
},_removeAnim:function(j){var h=this._anims.indexOf(j);
if(h!==-1){this._anims.splice(h,1)
}},_trace:function(m){var n=this.getEvent(m);
var k=n.getSubs();
var o=[];
var h=function(p,i){if(p.context&&p.context.getName){o.push(p.context.getName())
}else{var q={};
q[p.fn.name]=p.fn.toString();
o.push(q)
}};
for(var j=0;
j<k.length;
++j){var l=k[j];
g.Object.each(l,h)
}console.log("[trace] Event",m,"is notifying the following:",o);
this.fire(m)
},_later:function(h,j,m,l,k){if(this.destroyed){return
}m=m||this;
var i=g.later(h,m,j,l,k);
this._timers.push(i);
return i
},_cb:function(h){var i=g.bind(function(){if(!this._destroyed){return h.apply(this,arguments)
}},this);
return i
}});
g.augment(g.Squarespace.Gizmo,g.EventTarget);
g.Squarespace.ZombieGizmo=Class.extend(g.Squarespace.Gizmo,{_name:"ZombieGizmo",_events:{resurrect:{},resurrected:{}},initialize:function(h){this._super(h)
},destroy:function(){this._super();
this.resurrect()
},resurrect:function(){this.fire("resurrect");
this._initState();
this.fire("resurrected")
}})
},"1.0",{requires:["array-extras","node","event-custom"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-toggle",function(a){a.namespace("Squarespace.Widgets").ToggleButton=a.Base.create("toggleButton",a.Widget,[a.WidgetChild],{renderUI:function(){var c=this.get("contentBox"),e=this.get("active"),d=e?"active":"inactive";
c.append(a.DB.DIV("switch-box-container animate "+d,a.DB.DIV("switch-box",a.DB.DIV("toggle-box",a.DB.DIV("togglebg",a.DB.DIV("on",{html:this.get("onLabel")}),a.DB.DIV("off",{html:this.get("offLabel")})))),a.DB.DIV("switch-shadow",{html:"&nbsp;"}),a.DB.DIV("handle-wrapper",a.DB.DIV("handle",{html:"&nbsp;"}))))
},destructor:function(){a.detachAll(this.get("id")+"|*")
},bindUI:function(){var c=this.get("contentBox"),d=this.get("id");
c.one(".handle-wrapper").on(d+"|click",this._onClick,this);
this.after("activeChange",this.syncUI,this);
this.after("enabledChange",this.syncUI,this)
},_onClick:function(c){c.halt();
if(this.get("enabled")){this.set("active",!this.get("active"))
}},syncUI:function(){var c=this.get("contentBox"),f=c.one(".switch-box-container"),g=c.all(".togglebg, .handle"),h=this.get("active");
g.setStyles({marginLeft:null,left:null});
if(h){f.removeClass("inactive").addClass("active")
}else{f.removeClass("active").addClass("inactive")
}var e=this.get("boundingBox");
var d=this.get("enabled");
if(d){e.removeClass("disabled").addClass("enabled")
}else{e.removeClass("enabled").addClass("disabled")
}}},{ATTRS:{active:{value:false},onLabel:{value:"On"},offLabel:{value:"Off"},enabled:{value:true}}});
function b(){b.superclass.constructor.apply(this,arguments)
}b.NAME="toggleDragPlugin";
b.NS="drag";
a.extend(b,a.Plugin.Base,{initializer:function(){this._host=this.get("host");
this.afterHostMethod("bindUI",this._afterBindUI)
},destructor:function(){a.detachAll(this.get("id")+"|*");
if(this._handleDrag){this._handleDrag.destroy()
}},_afterBindUI:function(){var c=this._host.get("contentBox"),d=c.one(".switch-box"),f=c.one(".handle-wrapper").get("region"),e=this.get("id");
this._handleDrag=new a.DD.Drag({node:c.one(".handle")});
this._handleDrag.plug(a.Plugin.DDProxy);
this._handleDrag.on(e+"|drag:start",this._onDragStart,this);
this._handleDrag.on(e+"|drag:drag",this._onDragDrag,this);
this._handleDrag.on(e+"|drag:end",this._onDragEnd,this)
},_onDragStart:function(d){var c=d.target,f=this._host.get("contentBox").one(".handle-wrapper").get("region");
if(!c.hasPlugin("con")){c.plug(a.Plugin.DDConstrained,{constrain:f})
}},_onDragDrag:function(h){var g=h.target;
var c=this._host.get("contentBox");
var i=this.get("maxValue");
var f=c.one(".handle-wrapper").getX();
var d=Math.abs(f-g.lastXY[0]);
d=Math.max(0,d);
d=Math.min(i,d);
c.one(".togglebg").setStyle("marginLeft",d);
c.one(".handle").setStyle("left",h.target.get("dragNode").getX()-c.one(".handle-wrapper").getX())
},_onDragEnd:function(i){var f=i.target;
var g=f.get("node");
var h=f.con.get("constrain");
var d=Math.abs(h.left-h.right);
var j=Math.abs(f.nodeXY[0]-f.lastXY[0])/(d-g.get("offsetWidth"));
var c=this._host.get("active");
if(j>0.5){this._host.set("active",!c)
}if(this._host.get("active")===c){this._host.syncUI()
}}},{ATTRS:{resistance:{value:10},maxValue:{value:70}}});
a.Squarespace.ToggleDrag=b
},"1.0",{requires:["widget","widget-child","squarespace-toggle-css","dd-drag","dd-constrain","dd-proxy"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-node-flyout",function(a){a.namespace("Squarespace.Animations").Flyout=a.Base.create("flyoutPlugin",a.Plugin.Base,[],{initializer:function(b){this._mask=a.Node.create('<div class="flyout-animation-wrapper"></div>');
this._mask.setStyles({position:"fixed",overflow:"hidden"});
this._mask.setStyle("z-index","200000");
this._isShowing=false;
this._isHiding=false
},destructor:function(){if(this._anim){this._anim.stop().destroy()
}this._mask.remove(true);
a.detachAll(this.get("id")+"|*")
},_onScroll:function(c){var b=this.get("host");
if(c.target.contains(b)||c.currentTarget.contains(b)){this._updateMaskPosition()
}},_onResize:function(){this._updateMaskPosition()
},show:function(){if(!this.get("visible")&&!this._isShowing){this._animateFlyout(true)
}},hide:function(){if(this.get("visible")&&!this._isHiding){this._animateFlyout(false)
}},_measureNode:a.Squarespace.Utils.measureNode,_animateFlyout:function(g){var c=this._mask,b=this.get("node"),e=b.get("region"),d=this._measureNode(b),f=this._getInitialFlyoutOffset();
this._updateMaskPosition();
if(this._anim){this._anim.stop(true);
this._anim=null
}if(g){c.setStyles({height:d.height,width:d.width+1});
b.setStyles({position:"absolute",top:f.yOffset,left:f.xOffset});
c.appendChild(b);
a.one("body").appendChild(c)
}this._anim=new a.Anim({duration:this.get("duration"),easing:this.get("easing"),node:b,to:{top:g?0:f.yOffset,left:g?0:f.xOffset}});
if(this.get("animateOpacity")){this._anim.set("from.opacity",g?0:1);
this._anim.set("to.opacity",g?1:0)
}this._anim.on(this._yuid+"|end",function(){this._anim=null;
if(g){this._isShowing=false;
this._mousewheelEvent=a.on(this.get("id")+"|mousewheel",this._onScroll,this);
this._resizeEvent=a.one(window).on(this.get("id")+"|resize",this._onResize,this)
}else{this._isHiding=false;
b.remove();
c.remove();
if(this._mousewheelEvent){this._mousewheelEvent.detach();
this._mousewheelEvent=null
}if(this._resizeEvent){this._resizeEvent.detach();
this._resizeEvent=null
}}this.set("visible",g);
this.fire(g?"shown":"hidden",{flyout:b});
this.get("host").fire("flyout-"+g?"shown":"hidden",{flyout:b})
},this);
if(g){this._isShowing=true
}else{this._isHiding=true
}if(b.inDoc()){this._anim.run()
}},_updateMaskPosition:function(){if(!this._mask){return
}var b=this._mask,c=this._getIntendedMaskPosition();
b.setStyles({left:c.x,top:c.y});
return c
},_getInitialFlyoutOffset:function(){var c=a.Squarespace.Animations.Flyout,f=this.get("alignment"),d=this._measureNode(this.get("node"));
var b,e;
switch(f){case c.LT:case c.LC:case c.LR:b=d.width;
break;
case c.TL:case c.TC:case c.TR:case c.BL:case c.BC:case c.BC:b=0;
break;
case c.RT:case c.RC:case c.RB:b=d.width*-1;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}switch(f){case c.LT:case c.LC:case c.LB:case c.RT:case c.RC:case c.RB:e=0;
break;
case c.BL:case c.BC:case c.BR:e=d.height*-1;
break;
case c.TL:case c.TC:case c.TR:e=d.height;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}return{xOffset:b,yOffset:e}
},_getIntendedMaskPosition:function(){var c=a.Squarespace.Animations.Flyout,i=this.get("alignment"),e=this.get("host").get("region"),d=this._measureNode(this.get("node"));
var b,h;
var g=a.DOM.docScrollY(),f=a.DOM.docScrollX();
e.top-=g;
e.bottom-=g;
e.left-=f;
e.right-=f;
switch(i){case c.RT:case c.RC:case c.RB:b=e.right;
break;
case c.LT:case c.LC:case c.LB:b=e.left-d.width;
break;
case c.TR:case c.BR:b=e.left;
break;
case c.TC:case c.BC:b=e.left+e.width/2-d.width/2;
break;
case c.TR:case c.BR:b=e.right-d.width;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}switch(i){case c.TL:case c.TC:case c.TR:h=e.top-d.height;
break;
case c.LT:case c.RT:h=e.top;
break;
case c.LC:case c.RC:h=e.top+e.height/2-d.height/2;
break;
case c.LB:case c.RB:h=e.bottom-d.height;
break;
case c.BL:case c.BC:case c.BR:h=e.bottom;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}return{x:b,y:h}
}},{NS:"flyoutPlugin",TL:"tl",TC:"tc",TR:"tr",RT:"rt",RC:"rc",RB:"rb",BC:"bc",BL:"bl",BR:"br",LT:"lt",LC:"lc",Lb:"lb",ATTRS:{duration:{value:0.3,validator:a.Lang.isNumber},easing:{value:a.Easing.easeOutStrong},alignment:{value:"rt",validator:function(c){var b=a.Squarespace.Animations.Flyout;
switch(c){case b.TL:case b.TC:case b.TR:case b.LT:case b.RT:case b.LC:case b.RC:case b.LB:case b.RB:case b.BL:case b.BC:case b.BR:return true;
default:console.warn(this.name+": Invalid alignment value ("+c+")");
return false
}}},node:{value:null},animateOpacity:{value:true},visible:{value:false}}})
},"1.0",{requires:["plugin","node"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-structured-input",function(b){var a="\1";
b.namespace("Squarespace");
b.Squarespace.StructuredInput=b.Base.create("structuredInput",b.Base,[],{initializer:function(d){this.config=b.merge({selectAllOnFocus:false},d);
this.fieldScroll=0;
this.targetEl=b.instanceOf(d.target,b.Node)?d.target:b.one(d.target);
if(!this.targetEl){console.error("Invalid structured input target: ",d.target);
return
}this.leftPadding=parseInt(this.targetEl.getStyle("paddingLeft"),10);
this.topPadding=parseInt(this.targetEl.getStyle("paddingTop"),10);
this.inputEl=b.DB.INPUT();
if(this.config.tabIndex){this.inputEl.set("tabIndex",this.config.tabIndex)
}this.targetEl.setContent();
this.targetEl.append(this.inputEl);
this.contentEl=b.DB.DIV();
this.contentEl.setContent("&nbsp;");
this.targetEl.append(this.contentEl);
this.helpEl=b.DB.DIV("help-tag");
this.targetEl.append(this.helpEl);
var e="This field accepts variables.  Type one of the codes below to activate a variable:<br/><br/>";
for(var c in this.config.variables){e+="<strong>"+c+"</strong> &mdash; "+this.config.variables[c].tip;
e+="<br/>"
}this.tooltip=new b.Squarespace.ToolTip({target:this.helpEl,title:"Formatting",dialogTooltip:true,body:e.trim(),showTimeout:200,width:300,clickToShow:true});
this.targetEl.on("mousedown",this.mousedown,this);
this.targetEl.on("mousemove",this.mousemove,this);
this.targetEl.on("mouseup",this.mouseup,this);
this.targetEl.on("dblclick",this.selectAll,this);
this.inputEl.on("focus",this.onFocus,this);
this.inputEl.on("blur",this.onBlur,this);
this.inputEl.on("keydown",this.onKeyDown,this);
this.cursorEl=b.DB.DIV("cursor");
this.targetEl.append(this.cursorEl);
this.lineHeightPx=(this.targetEl.get("offsetHeight")-(this.topPadding*2))+2;
this.cursorEl.setStyle("height",this.lineHeightPx+"px");
this.cursorEl.setStyle("top",(this.topPadding-2)+"px");
this.scrapeChars();
this.render();
this.updateCursor()
},destructor:function(){if(this.cursorBlinkInterval){this.cursorBlinkInterval.cancel()
}if(this.scrapeInterval){this.scrapeInterval.cancel()
}if(this.resumeBlinkTimer){this.resumeBlinkTimer.cancel()
}if(this.tooltip){this.tooltip.destroy()
}},stopScrape:function(){if(this.scrapeInterval){this.scrapeInterval.cancel()
}},startScrape:function(){this.scrapeInterval=b.later(50,this,this.scrapeChars,null,true)
},onFocus:function(){this.startScrape();
this.resumeBlink();
if(!this.hasSel()){this.cursorEl.setStyle("display","block")
}this.targetEl.addClass("focused")
},onBlur:function(){this.mousepressed=false;
this.stopScrape();
this.clearSel();
this.pauseBlink();
this.updateCursor();
this.cursorEl.setStyle("display","none");
this.targetEl.removeClass("focused")
},pauseBlink:function(){if(this.cursorBlinkInterval){this.cursorBlinkInterval.cancel();
this.cursorBlinkInterval=null;
this.cursorEl.setStyle("visibility","visible");
if(this.resumeBlinkTimer){this.resumeBlinkTimer.cancel()
}this.resumeBlinkTimer=b.later(400,this,this.resumeBlink)
}},resumeBlink:function(){if(!this.cursorBlinkInterval){if(this.resumeBlinkTimer){this.resumeBlinkTimer.cancel();
this.resumeBlinkTimer=null
}this.cursorBlinkInterval=b.later(600,this,this.blinkCursor,null,true)
}this.cursorEl.setStyle("visibility","visible")
},blinkCursor:function(){if(this.cursorEl.getStyle("visibility")=="hidden"){this.cursorEl.setStyle("visibility","visible")
}else{this.cursorEl.setStyle("visibility","hidden")
}},updateCursor:function(){var d;
if(this.hasSel()){var h=this.getDistanceToPos(this.selStart,"cursor");
var f=this.getDistanceToPos(this.selEnd,"cursor");
if(this.movingLeft){d=Math.min(h,f)
}else{d=Math.max(h,f)
}if(!this.selEl){this.selEl=b.DB.DIV("sel");
this.targetEl.append(this.selEl);
this.selEl.setStyles({top:(parseInt(this.cursorEl.getStyle("top"))-1)+"px",height:(this.lineHeightPx+6)+"px"});
this.cursorEl.setStyle("display","none")
}this.selEl.setStyles({left:(this.leftPadding+Math.min(h,f)+this.fieldScroll)+"px",width:Math.abs(h-f)+"px"})
}else{if(b.Lang.isUndefined(this.cursorPos)){this.cursorPos=this.length()
}var c=this.getDistanceToPos(this.cursorPos,"cursor");
d=c;
this.cursorEl.setStyle("left",(this.leftPadding+c)+"px");
if(this.selEl){this.selEl.remove();
this.selEl=null;
this.cursorEl.setStyle("display","block")
}}var e=this.targetEl.get("offsetWidth")-64;
var g=false;
if((d+this.fieldScroll-1)>e){while(d+this.fieldScroll-1>e){this.fieldScroll-=60
}g=true
}else{if(d<-this.fieldScroll){while(d<-this.fieldScroll){this.fieldScroll+=60
}g=true
}}if(g){this.contentEl.setStyle("margin-left",this.fieldScroll+"px");
this.cursorEl.setStyle("margin-left",this.fieldScroll+"px")
}},insertChars:function(g){var e=this._compressVariables(this.get("value"));
var d=e.substring(0,this.cursorPos);
var f=e.substring(this.cursorPos);
this.set("value",this._uncompressVariables((d+g+f).replace(new RegExp("\\s+","g")," ")));
this.cursorPos+=g.length;
this.render();
this.updateCursor()
},escapeBuffer:function(c){return c.replace(new RegExp("&","g"),"&amp;").replace(new RegExp("\\s+","g"),"&nbsp;")
},unescapeBuffer:function(c){return c.replace(new RegExp("&nbsp;","g")," ").replace(new RegExp("&amp;","g"),"&")
},render:function(){var g=this.get("value");
if(g.length==0){this.contentEl.setContent("&nbsp;");
return
}this.contentEl.setContent("");
var f="";
for(var e=0;
e<g.length;
++e){if(this.isVariableAt(g,e)){if(f.length>0){this.contentEl.append(b.DB.SPAN({html:this.escapeBuffer(f)}));
f=""
}var c=g[e]+g[e+1];
var d=this.config.variables[c];
if(d){this.contentEl.append(b.DB.SPAN("unbreakable",{html:d.title,title:d.tip}))
}else{f+=c
}e+=(this.getVariableLengthAt(g,e)-1)
}else{f+=g[e]
}}if(f.length>0){this.contentEl.append(b.DB.SPAN({html:this.escapeBuffer(f)}));
f=""
}},isVariableAt:function(e,d){if(e[d]!="%"||(d+1)>=e.length){return
}var c=this.config.variables[this.getVariableAt(e,d)];
return(c!=null)
},getVariableAt:function(d,c){return(d[c]+d[c+1])
},getVariableLengthAt:function(d,c){return 2
},_compressVariables:function(f){var c="";
this.varStack=[];
for(var e=0;
e<f.length;
++e){if(this.isVariableAt(f,e)){var d=this.getVariableAt(f,e);
if(this.config.variables[d]){this.varStack.push(d);
c+=a;
e+=(this.getVariableLengthAt(f,e)-1);
continue
}}c+=f[e]
}return c
},_uncompressVariables:function(e){var c="";
var f=0;
for(var d=0;
d<e.length;
++d){if(this.isVariableAt(e,d)){this.cursorPos-=(this.getVariableLengthAt(e,d)-1)
}if(e[d]==a){c+=this.varStack[f];
++f
}else{c+=e[d]
}}delete this.varStack;
return c
},_varCount:function(c){var e=0,d=-1;
while(true){d=c.indexOf(a,d);
if(d==-1){break
}e++;
d++
}return e
},deleteChars:function(j,d){if(j<0){return
}var f=this._compressVariables(this.get("value"));
var e=f.substring(0,j);
var g=f.substring(j,j+d);
var i=f.substring(j+d);
var c=this._varCount(g);
if(c>0){var h=this._varCount(e);
while(c>0){this.varStack.splice(h,1);
c--
}}this.set("value",this._uncompressVariables(e+i));
if(j<this.cursorPos){this.cursorPos-=d
}this.render();
this.updateCursor()
},deleteSelection:function(){this.deleteChars(Math.min(this.selStart,this.selEnd),Math.abs(this.selStart-this.selEnd));
this.cursorPos=Math.min(this.selStart,this.selEnd);
this.clearSel();
this.updateCursor()
},onKeyDown:function(c){this.pauseBlink();
if((c.keyCode==8||c.keyCode==46)&&this.hasSel()){this.deleteSelection();
return
}if(c.shiftKey){if(!this.hasSel()){this.selStart=this.cursorPos;
this.selEnd=this.selStart
}}if(c.keyCode==8){this.deleteChars((this.cursorPos-1),1)
}else{if(c.keyCode==46){this.deleteChars(this.cursorPos,1)
}else{if(c.keyCode==65&&(c.metaKey)){this.cursorPos=0;
this.selStart=0;
this.selEnd=this.length();
this.updateCursor()
}else{if(c.keyCode==38){this.cursorPos=0;
if(c.shiftKey){this.selEnd=this.cursorPos
}else{if(this.hasSel()){this.clearSel()
}}this.movingLeft=true;
this.updateCursor()
}else{if(c.keyCode==40){this.cursorPos=this.length();
if(c.shiftKey){this.selEnd=this.cursorPos
}else{if(this.hasSel()){this.clearSel()
}}this.movingLeft=false;
this.updateCursor()
}else{if(c.keyCode==37){if(c.shiftKey){if(this.selEnd==0){return
}this.selEnd--
}else{if(this.hasSel()){this.cursorPos=Math.min(this.selStart,this.selEnd);
this.clearSel()
}else{if(this.cursorPos==0){return
}this.cursorPos--
}}this.movingLeft=true;
this.updateCursor()
}else{if(c.keyCode==39){if(c.shiftKey){if(this.selEnd==this.length()){return
}this.selEnd++
}else{if(this.hasSel()){this.cursorPos=Math.max(this.selStart,this.selEnd);
this.clearSel()
}else{if(this.cursorPos==this.length()){return
}this.cursorPos++
}}this.movingLeft=false;
this.updateCursor()
}else{b.later(1,this,this.scrapeChars)
}}}}}}}},scrapeChars:function(){var c=this.inputEl.get("value");
this.inputEl.set("value","");
if(c!=""){if(this.hasSel()){this.deleteSelection()
}this.insertChars(c)
}},length:function(){return this._compressVariables(this.get("value")).length
},getDistanceToPos:function(e,h){if(e==0){return 0
}var f=b.DB.SPAN("measure-span",{style:"visibility: hidden; left: -9999px"});
var c=0;
var g=0;
this.targetEl.append(f);
this.contentEl.all("span").each(function(p){if((h=="cursor"&&c==e)||(h=="px"&&f.get("offsetWidth")>=e)){return
}if(p.hasClass("unbreakable")){c++;
f.append(b.DB.SPAN("unbreakable",{html:p.getContent()}));
if(h=="px"){if(f.get("offsetWidth")>=e){c--
}}}else{var m=this.unescapeBuffer(p.getContent());
if(h=="cursor"){var k="";
for(var l=0;
l<m.length;
++l){k+=m[l];
c++;
if(c==e){break
}}if(k!=""){f.append(b.DB.SPAN({html:this.escapeBuffer(k)}))
}}else{var j=b.DB.SPAN();
f.append(j);
for(var l=0;
l<m.length;
++l){var o=m[l];
c++;
if(o==" "){o="&nbsp;"
}j.setContent(j.getContent()+o);
if(f.get("offsetWidth")>=e){c--;
break
}}}}},this);
var d=f.get("offsetWidth");
f.remove();
if(h=="cursor"){return d
}else{return c
}},clearSel:function(){delete this.selStart;
delete this.selEnd
},hasSel:function(){return !b.Lang.isUndefined(this.selStart)&&!b.Lang.isUndefined(this.selStart)
},mousedown:function(c){this.mousepressed=true;
this.focus(c);
c.halt()
},mousemove:function(d){if(this.mousepressed){if(!this.hasSel()){this.selStart=this.cursorPos
}var c=(d.clientX-this.targetEl.getXY()[0]-this.leftPadding)-this.fieldScroll;
this.selEnd=this.getDistanceToPos(c,"px");
this.updateCursor()
}},mouseup:function(c){this.mousepressed=false
},selectAll:function(){this.selStart=0;
this.selEnd=this.length();
this.updateCursor()
},focus:function(f){var d=this.length();
var g=false;
if(f){var c=(f.clientX-this.targetEl.getXY()[0]-this.leftPadding)-this.fieldScroll;
this.cursorPos=this.getDistanceToPos(c,"px")
}else{this.cursorPos=d
}if(!this.targetEl.hasClass("focused")){if(this.cursorPos==d){this.selStart=d;
this.selEnd=0;
g=this.config.selectAllOnFocus
}}if(!g){this.clearSel()
}this.updateCursor();
this.inputEl.focus()
}},{ATTRS:{value:{value:""}}})
},"1.0",{requires:["base","squarespace-dombuilder","squarespace-ui-base"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-mailcheck",function(a){a.namespace("Squarespace.Plugin");
a.Squarespace.Plugin.MailCheck=a.Base.create("MailCheck",a.Plugin.Base,[],{initializer:function(b){this._host=b.host;
this._host.on("blur",this.checkMailAddress,this)
},checkMailAddress:function(c){var b=this._host.get("value");
if(b!=null&&b.length>3){Kicksend.mailcheck.run({email:b,suggested:a.bind(this.emailSuggestions,this),empty:a.bind(this.noEmailSuggestions,this)})
}},emailSuggestions:function(c){if(!this._host.hasPlugin("flyoutPlugin")){this._host.plug(a.Squarespace.Animations.Flyout,{duration:0.3})
}this.get("field").showError('Did you mean <a class="corrected-email" href="#">'+c.full+"</a>?");
var b=a.one(".corrected-email");
if(b){a.one(".corrected-email").once("click",this._onClick,this)
}},noEmailSuggestions:function(c){var b=this._host.flyoutPlugin;
if(b){b.hide()
}},_onClick:function(c){c.preventDefault();
c.halt();
var b=this._host.flyoutPlugin;
if(b){this._host.set("value",b.get("node").one("a").getHTML());
b.hide();
this.get("field").clearError()
}},destructor:function(){}},{NS:"mailCheck",ATTRS:{field:{}}})
},"1.0",{requires:["thirdparty-kicksend","squarespace-node-flyout"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-dialog-fields",function(b){b.namespace("Squarespace");
function a(d){var c={13:true,27:true,16:true,17:true,18:true,20:true,36:true,35:true,33:true,34:true,37:true,38:true,39:true,40:true,112:true,113:true,114:true,115:true,116:true,117:true,118:true,119:true,120:true,121:true,122:true,123:true,45:true,91:true,144:true};
return !c[d]
}b.Squarespace.DialogField=Class.extend(b.Squarespace.Gizmo,{_name:"DialogField",initialize:function(e,d,f){this._super();
var c={defaultHidden:false};
this.config=b.merge(c,e);
this.panel=f;
this.dialog=f;
this.initialData=b.merge({},d);
this.className="";
this.inActiveFrame=true;
if(this.config&&(typeof this.config.name!=="undefined")&&(this.config.name in d)){this.value=d[this.config.name]
}this._debug=new b.Squarespace.Debugger({name:this._name,output:false})
},hide:function(c){this.temporaryHide(c)
},getTakenHeight:function(){return this.html.get("offsetHeight")
},show:function(c){this.temporaryShow(c)
},getName:function(){return this.config.name
},getType:function(){return this.type
},getDialog:function(){return this.dialog
},append:function(c){c.append(this.html);
if(this.config.defaultHidden){this.temporaryHide(false)
}},resize:function(){},isValid:function(){return this.getErrors().length>0
},getErrors:function(){if(this.config.validator&&this.config.validationErrorMsg&&!this.config.validator.call(this)){return[this.config.validationErrorMsg]
}return[]
},showError:function(d){if(!d){return
}var e=this.errorFlyoutAnchor||this.control;
if(!e){console.error("dialog-field: [DialogField] No control or error flyout anchor set to throw form field error on. Set this.control or this.errorFlyoutAnchor to a node.")
}if(!e.hasPlugin("flyoutPlugin")){e.plug(b.Squarespace.Animations.Flyout,{duration:0.3})
}var c=e.flyoutPlugin;
if(c.get("visible")){if(this._showErrorSub){this._showErrorSub.detach()
}this._showErrorSub=c.once(this.getId()+"|hidden",function(){this._showErrorSub=null;
this._doShowErrorFlyout(d)
},this);
c.hide()
}else{this._doShowErrorFlyout(d)
}},_doShowErrorFlyout:function(i){var h=(this.errorFlyoutAnchor||this.control);
var d=h.flyoutPlugin;
this.html.addClass("error");
if(!this._errorEl){this._errorEl=b.DB.DIV("flyout-error-message",{html:i});
this._errorEl.setStyle("zIndex",this.dialog.zIndex+10);
this._errorEl.on(this.getId()+"|click",function(k){k.halt()
},this)
}this._errorEl.setContent(i);
var f=b.Squarespace.Utils.measureNode(this._errorEl).width,j=(h.getX()+h.get("offsetWidth")-(this.html.hasClass("thin")?-10:1)),g=j+f,e=b.one(window).get("region").right,c=g>e;
if(c){this._errorEl.addClass("out-from-left")
}d.setAttrs({node:this._errorEl,alignment:c?"lt":"rt"});
this._clearErrorSub=b.on(this.getId()+"|click",this.clearError,this.errorEl,this);
d.show()
},hideError:function(){var d=this.errorFlyoutAnchor||this.control;
if(!d||!d.hasPlugin("flyoutPlugin")||!d.flyoutPlugin.get("visible")){return
}if(this._clearErrorSub){this._clearErrorSub.detach()
}var c=d.flyoutPlugin;
this._subscribeOnce(c,this.getId()+"|hidden",function(f){this.html.removeClass("error")
},this);
c.hide()
},clearError:function(){this.dialog.clearError(this);
this.hideError()
},updateInlineTitle:function(){},setHeight:function(c){if(this.control){this.control.setStyle("height",c+"px")
}},getValue:function(){return this.value
},setValue:function(c){var d=this.value;
this.value=c;
if("config" in this&&"name" in this.config){this.fire("value-changed",{name:this.config.name,value:c,oldValue:d,field:this})
}},temporaryHide:function(c){this.fire("hide",this);
this.hidden=true;
if(this.hideAnim){this.hideAnim.stop()
}if(c){this.html.setStyle("display","none");
this.fire("hidden",this)
}else{this.hideAnim=this._anim({node:this.html,to:{opacity:0},duration:0.35,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){this.html.setStyle("display","none");
this.fire("hidden",this)
},this);
this.hideAnim.run()
}},temporaryShow:function(){this.fire("show",this);
this.hidden=false;
if(this.hideAnim){this.hideAnim.stop()
}this.html.setStyle("display","block");
this.hideAnim=this._anim({node:this.html,to:{opacity:1},duration:0.35,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){b.fire("shown",this);
b.fire("showing",this);
this.fire("shown")
},this);
this.hideAnim.run()
},getNode:function(){return this.html
},didDataChange:function(){if(this.config.ignoreChanges){return false
}var c;
if(!this.initialData||(b.Lang.isUndefined(this.initialData[this.getName()])&&this.getValue()==="")){c=false
}else{if(b.Lang.isArray(this.initialData[this.getName()])){c=b.JSON.stringify(this.initialData[this.getName()])!==b.JSON.stringify(this.getValue())
}else{c=this.getValue()!==this.initialData[this.getName()]
}}if(c){this._debug.log(this.getName(),this.getType(),"changed",["current",this.getValue()],["initial",this.initialData[this.getName()]])
}return c
}});
b.Squarespace.DialogFieldGenerators={select:Class.extend(b.Squarespace.DialogField,{initialize:function(f,c,d){this._super(f,c,d);
if(!this.config.options){this.config.options=[];
console.warn("Select '"+this.config.name+"' has no options.")
}if(!this.config.icon){this.config.icon="";
this.noIcon=true
}this.control=b.DB.DIV("field-input-wrapper select "+(this.config.className?this.config.className:""),{html:"&nbsp;"});
if(this.config.width){if(b.Lang.isNumber(this.config.width)){if(this.config.width>=1){this.selectElWidth=this.config.width+"px"
}}else{if(b.Lang.isString(this.config.width)){this.selectElWidth=this.config.width
}else{console.log("dialog: [DialogField] Width is not a number or string",this)
}}}else{this.selectElWidth=false
}this.underlyingControl=b.DB.SELECT("input",{tabIndex:d.getNextTabIndex(),style:"position: absolute; top: 0; left: 0px; opacity: 0"});
var g;
for(var e in this.config.options){if(c[this.config.name]==e){this.value=e
}if(!g){g=e
}this.underlyingControl.append(b.DB.OPTION({html:this.config.options[e].title,value:e}))
}if(b.Lang.isUndefined(this.value)||b.Lang.isNull(this.value)||!this.config.options[this.value]){if(this.config.defaultValue!=null&&!b.Lang.isUndefined(this.config.defaultValue)&&this.config.options[this.config.defaultValue]){this.value=this.config.defaultValue
}else{this.value=g
}}this.html=b.DB.DIV("field-wrapper select-field-wrapper clear thin dialog-field-"+this.config.name,(this.config.title?b.DB.DIV("field-title",{html:this.config.title}):null),b.DB.DIV("field-wrapper-inner clear"+(this.config.icon?" icon "+this.config.icon:""),{style:"position: relative;"+(this.selectElWidth?"width: "+this.selectElWidth:"")},b.DB.DIV("field-rhs",this.control),this.underlyingControl),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null));
this.setValue(this.value);
this._subscribe([[this.html.one(".field-wrapper-inner"),"click",this.onClick],[this.underlyingControl,"change",this.onChange]]);
if(this.config.onChange){this._subscribe([[this.underlyingControl,"change",this.config.onChange]])
}if(b.Object.isEmpty(this.config.options)){this.html.setStyle("display","none")
}if(f.hidden){this.temporaryHide(true)
}},didDataChange:function(){if(b.Lang.isNumber(Number(this.initialData[this.getName()]))&&b.Lang.isNumber(this.getValue())){return Number(this.initialData[this.getName()])!=Number(this.getValue())
}else{return this.initialData[this.getName()]!=this.getValue()
}},updateOptions:function(d,c){d=d||{};
this.html.setStyle("display",b.Object.isEmpty(d)?"none":null);
this.config.options=d;
this.underlyingControl.set("innerHTML","");
b.Object.each(d,function(f,e){this.underlyingControl.append(b.DB.OPTION({html:d[e].title,value:e}))
},this);
if(!b.Lang.isUndefined(c)&&d[c]!=null){this.setValue(c);
this.html.one(".field-input-wrapper.select").setContent(this.getValueTitle(c))
}},onClick:function(f){f.halt();
if(this._disabled){return
}var d;
if(f.target.get("tagName")=="SELECT"){return
}else{if(f.target.hasClass("field-wrapper-inner")){d=f.target
}else{if(!f.target.ancestors(".field-wrapper-inner").isEmpty()){d=f.target.ancestors(".field-wrapper-inner").item(0)
}else{return
}}}var c=d.one("select");
c.simulate("mousedown")
},show:function(){if(!this.noIcon){var d=parseInt(this.html.get("offsetWidth"),10)-parseInt(this.html.getStyle("paddingLeft"),10);
var c=(d-5);
this.underlyingControl.setStyle("width",c+"px")
}},onChange:function(){this.setValue(this.underlyingControl.get("value"));
this.fire("change",this.getValue());
this.dialog.fire("datachange",this)
},hideDescription:function(){this.html.one(".field-description").hide()
},showDescription:function(c){this.html.one(".field-description").show();
this.html.one(".field-description").setContent(c)
},getDescription:function(){return this.html.one(".field-description")
},rollback:function(){this.setValue(this.previousValue);
this.html.one(".field-input-wrapper.select").setContent(this.getValueTitle(this.getValue()))
},setValue:function(c){this.previousValue=this.value;
this.value=c;
this.underlyingControl.set("value",c);
if(!b.Object.isEmpty(this.config.options)){this.control.setContent(this.getValueTitle());
if(this.getValueIsEmpty()){this.html.addClass("empty-value")
}else{this.html.removeClass("empty-value")
}}},getPreviousValue:function(){return this.previousValue
},getValue:function(){return this.underlyingControl.get("value")
},getValueTitle:function(){return this.config.options[this.underlyingControl.get("value")].title
},getValueIsEmpty:function(){return this.config.options[this.underlyingControl.get("value")].empty
},disable:function(){this._disabled=true;
this.underlyingControl.setAttribute("disabled","disabled");
this.html.addClass("disabled")
},enable:function(){this._disabled=false;
this.underlyingControl.removeAttribute("disabled");
this.html.removeClass("disabled")
}}),"multi-frame":Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.frames={};
this.activeEl=null;
this.value=this.config.initialFrame;
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this))
},onClick:function(c){this.panel.fire("datachange",this)
},show:function(d){var g=this.frames[d];
if(this.activeEl){if(this.activeEl==g){return
}if(this.activeEl.a){this.activeEl.a.stop()
}var c=this.activeEl.fields;
this.activeEl.a=this._anim({node:this.activeEl.el,to:{height:0},duration:0.3,easing:b.Easing.easeOutStrong});
c.forEach(this.setInActiveFrame(false),this);
this.activeEl.a.on("end",function(f){f.target.get("node").addClass("hidden")
},this);
this.activeEl.a.run()
}if(g.a){g.a.stop()
}if(this.activeEl){g.el.ancestor().insertBefore(g.el,this.activeEl.el.next())
}g.el.removeClass("hidden");
var e=g.el.getStyle("height");
g.el.setStyles({height:null});
g.realHeight=g.el.get("offsetHeight");
g.el.setStyles({height:e});
g.a=this._anim({node:g.el,to:{height:g.realHeight},duration:0.3,easing:b.Easing.easeOutStrong});
g.a.on("end",function(l,k){for(var j=0;
j<k.fields.length;
++j){var h=this.panel.fields[k.fields[j].name];
if(h&&h.updateInlineTitle){h.updateInlineTitle()
}}this.focusCurrentFrame()
},this,g);
g.a.run();
g.fields.forEach(this.setInActiveFrame(true),this);
this.activeEl=g;
this.value=d
},focusCurrentFrame:function(){for(var c=0;
c<this.activeEl.fields.length;
++c){var d=this.panel.fields[this.activeEl.fields[c].name];
if(d.getNode){d.getNode().focus();
return
}}},setInActiveFrame:function(c){return function(e){if(e.name){var d=this.panel.getField(e.name);
d.inActiveFrame=c;
d.fire("mutli-frame-focus")
}}
},append:function(d,c,e,g){for(var i in this.config.frames){var f=this.config.frames[i];
var h=b.DB.DIV("frame-wrapper clear");
e.append(h);
this.panel._renderFields(d,f.fields,h,g);
this.frames[i]=this.config.frames[i];
this.frames[i].el=h;
this.frames[i].realHeight=h.get("offsetHeight");
if(i!=this.config.initialFrame){h.setStyle("height","0px");
h.addClass("hidden");
this.frames[i].visible=false;
this.config.frames[i].fields.forEach(this.setInActiveFrame(false),this)
}else{this.activeEl=this.frames[i];
this.frames[i].visible=true;
this.config.frames[i].fields.forEach(this.setInActiveFrame(true),this)
}}}}),"multi-option":Class.extend(b.Squarespace.DialogField,{initialize:function(f,k,c){this._super(f,k,c);
this.config.options=this.config.options.filter(function(i){return !b.Lang.isUndefined(i)&&!b.Lang.isNull(i)
});
this.value=(k[this.config.name]?k[this.config.name]:this.config.defaultValue);
if(!this.config.columns){this.config.columns=this.config.options.length
}if(!this.value&&this.config.multi){this.value=[]
}this.options=[];
this.tips=[];
this.remover={};
this.dds=[];
for(var l=0;
l<this.config.options.length;
++l){var d=this.config.options[l];
if(!d){continue
}var g;
if(this.config.multi){g=false;
for(var h=0;
h<this.value.length;
++h){if(this.value[h]==d.value){g=true;
break
}}}else{g=(d.value==this.value)
}if(!d.disabled||(!this.config.hideDisabled&&d.disabled)){var e=b.DB.DIV("multioption-element option-"+d.value+(g?" active":"")+(this.config.buttonStyle?" button":"")+(this.config.optionStyle?" "+this.config.optionStyle:"")+(d.optionStyle?" "+d.optionStyle:"")+(d.disabled?" disabled":""),{html:'<div class="text clear"><div class="title">'+d.title+"</div>"+(d.description?'<div class="description">'+d.description+"</div>":"")+"</div>",style:"background-position: center "+this.config.iconDropPx+"px; background-image: url("+d.icon+"); padding: "+this.config.optionPadding,data:{value:d.value}});
if(this.config.height){e.setStyle("height",this.config.height)
}if(!d.title&&!d.description){e.setStyle("visibility","hidden")
}this.options.push(e);
this.remover[d.value]=e;
if(d.value==this.value){this.activeEl=e
}if(this.config.dragTray){e.setStyle("cursor","move");
e.setData(d);
var m=new b.DD.Drag({node:e}).plug(b.Plugin.DDProxy,{moveOnEnd:false,hideOnEnd:false});
this.dds.push(m);
m.on("drag:start",function(o,i,n){var j=o.target.get("node");
b.one("body").append(j);
j.addClass("free-block reattached-node");
this.dds.splice(this.dds.indexOf(i),1);
this.panel.close()
},this,m,d.value);
m.on("drag:end",function(r,j,q){var o=b.DD.DDM.activeDrag;
var p=o.get("node");
var n=o.get("dragNode");
var s={easing:"ease-out",transform:{value:(!p.placeholder?"scale(1.04)":"scale(.6)"),duration:0.4},opacity:{value:0,duration:0.4}};
n.transition(s,function(){this.setStyle("display","none");
this.setStyle("transform","");
this.setStyle("opacity","")
});
j.destroy();
var i=b.one("body").one(".reattached-node");
if(i){i.remove()
}},this,m,d.value);
this.config.attachDragHandlers(m)
}}}this.empty=b.DB.DIV("multioption-placeholder",{style:(this.config.backgroundIcon?"background-image: url("+this.config.backgroundIcon+")":"")});
this.elements=b.DB.DIV("field-input-wrapper",(this.options.length>0?this.options:this.empty));
this.html=b.DB.DIV("field-wrapper multioption-field-wrapper clear "+(this.config.alwaysShowTitles?" show-titles ":"")+(this.config.style?this.config.style:""),(this.config.padding?{style:"padding-top: "+this.config.padding[0]+"; padding-bottom: "+this.config.padding[1]+";"}:null),((this.config.title&&(this.config.titleStyle=="left"||this.config.titleStyle=="top"))?b.DB.DIV("field-lhs "+this.config.titleStyle,{html:this.config.title}):null),b.DB.DIV("field-rhs",this.elements,(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description "+this.config.titleStyle,{html:this.config.description})):null)));
this.control=this.html;
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this));
this.panel.bodyEvents.push(b.on("contextmenu",this.onRightClick,this.html,this))
},show:function(){this.config.options.forEach(function(d){var c=b.one(".option-"+d.value);
if(d.tip&&c){this.tips.push(new b.Squarespace.ToolTip({target:c,alwaysEnable:true,title:d.tip.title,body:d.tip.text,dialogTooltip:true}))
}},this)
},onRightClick:function(f){var c=f.target.ancestor(".multioption-element",true);
if(!c){return
}var d=this.value;
this.value=c.data().value;
this.panel.fire("contextmenu",this);
this.value=d;
f.halt()
},onClick:function(f){this.previousValue=this.value;
var c=f.target.ancestor(".multioption-element",true);
f.halt();
if(!c){return
}var g=c.getData();
var d=g.value;
if(!d){return
}if(c.hasClass("disabled")){this.fire("disabled-click",g.value);
return
}this.panel.fire("multioption-click",c.data().value);
if(this.config.multi){c.toggleClass("active");
this.value=[];
this.html.all(".multioption-element.active").each(function(e){this.value.push(e.data().value)
},this)
}else{if(this.activeEl){this.activeEl.removeClass("active")
}c.addClass("active");
this.activeEl=c;
this.value=d
}if(this.config.linkFrame){this.panel.getField(this.config.linkFrame).show(this.value)
}this.panel.fire("datachange",this,g)
},resize:function(){var d=parseInt(this.html.getStyle("width"),10);
if(this.config.titleStyle=="left"){d-=110
}var e=(d-(this.config.columns*2))/this.config.columns;
for(var c=0;
c<this.options.length;
++c){this.options[c].setStyle("width",e+"px")
}},add:function(e,d,f){this.empty.setStyle("display","none");
var c=b.DB.DIV("multioption-element "+(e==this.value?"active":"")+(this.config.buttonStyle?"button":""),{html:'<div class="multioption-thumbnail" style="background-image:url('+d+')"></div><div class="multioption-title">'+f+"</div>",style:"padding: "+this.config.optionPadding+(this.config.height?"height: "+this.config.height+"px;":""),data:{value:e}});
this.remover[e]=c;
this.elements.appendChild(this.remover[e])
},remove:function(c){if(this.remover[c]){this.remover[c].remove();
delete this.remover[c]
}},clear:function(){for(var c in this.remover){if(c!==false&&c!==undefined){this.remover[c].remove();
delete this.remover[c]
}}this.empty.setStyle("display","block")
},setHighlight:function(c){if(this.remover[c]){this.remover[c].addClass("highlighted")
}},removeHighlight:function(c){if(this.remover[c]){this.remover[c].removeClass("highlighted")
}},clearHighlight:function(c){this.html.all(".multioption-element").removeClass("highlighted")
},_destroy:function(){var c;
this._super();
for(c=0;
c<this.tips.length;
++c){this.tips[c].destroy()
}for(c=0;
c<this.dds.length;
++c){this.dds[c].destroy()
}}}),slider:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
if(e.min===e.max){console.error("Created Slider "+(e.name||e.title||"NO NAME")+" with no range. ["+e.min+", "+e.max+"]")
}else{if(b.Lang.isUndefined(e.min)||b.Lang.isUndefined(e.max)){console.error("Created Slider "+(e.name||e.title||"NO NAME")+" with undefined min or max value.")
}}this.config=e;
this.panel=d;
this.value=((c.hasOwnProperty(this.config.name)?c[this.config.name]:this.config.defaultValue)||this.config.min);
this.control=b.DB.DIV("slider-container",{style:(this.config.labelWidth?"margin-left: "+this.config.labelWidth+"px":"")});
this.titleEl=b.DB.DIV("field-lhs "+this.config.titleStyle,{html:this.config.title});
this.sliderDisplayEl=b.DB.DIV("slider-numeric-display",{html:this.getDisplayValue(),style:(this.config.labelWidth?"width: "+this.config.labelWidth+"px":"")});
this.html=b.DB.DIV("field-wrapper slider-field-wrapper clear "+(this.config.style),((this.config.title&&(this.config.titleStyle=="left"||this.config.titleStyle=="top"))?this.titleEl:null),b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.sliderDisplayEl,this.control),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description "+this.config.titleStyle,{html:this.config.description})):null)));
this.on("shown",this.resize,this);
if(e.hidden){this.temporaryHide(true)
}},getDisplayValue:function(){if(this.config.percentage){return Math.floor((this.value/this.config.max)*100)+"%"
}else{return(this.value===0&&this.config.zeroTitle?this.config.zeroTitle:this.value+(this.config.numericSuffix?"&nbsp;"+this.config.numericSuffix+(this.value!=1?"s":""):""))
}},resize:function(){var c=this.control.get("offsetWidth");
if(this.slider){this.slider.destroy()
}this.slider=new b.Slider({min:this.config.min,max:this.config.max,length:c,axis:"x",value:this.value});
this.slider.after("valueChange",function(d){this.value=d.newVal;
this.sliderDisplayEl.set("innerHTML",this.getDisplayValue());
this.panel.fire("datachange",this)
},this);
this.slider.render(this.control)
},_destroy:function(){this._super();
this.slider.removeTarget()
}}),check:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.active=((c[this.config.name]===undefined?this.config.defaultValue:c[this.config.name])?true:false);
this.html=b.DB.DIV("field-wrapper check-field-wrapper clear thin",(this.config.padding?{style:"padding-top: "+this.config.padding[0]+"; padding-bottom: "+this.config.padding[1]+";"}:null),b.DB.DIV("check-element "+(this.active?"active":""),((this.config.title)?b.DB.DIV("field-title",{html:this.config.title}):null),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null)));
if(e.hidden){this.temporaryHide(true)
}this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this))
},onClick:function(c){this.setValue(!this.active);
this.panel.fire("datachange",this);
this.fire("changed",this.getValue())
},setValue:function(c){this.active=c;
if(this.active){this.html.one(".check-element").addClass("active")
}else{this.html.one(".check-element").removeClass("active")
}},getValue:function(){return this.active
},didDataChange:function(){if(!this.initialData[this.getName()]&&!this.getValue()){return false
}else{return this._super()
}}}),text:Class.extend(b.Squarespace.DialogField,{initialize:function(f,d,e){this.hideAnim=null;
this._super(f,d,e);
var c=d[this.config.name];
if(b.Lang.isUndefined(c)||b.Lang.isNull(c)){c=""
}this.control=b.DB.INPUT("field-input "+(this.config.className?this.config.className:""),{type:(this.config.password?"password":"text"),spellcheck:"false",tabIndex:this.panel.getNextTabIndex(),value:c,style:(f.bold?"font-weight: bold;":"")+((f.width&&f.width>1)?"width: "+f.width+"px;":""),maxLength:(f.maxLength?f.maxLength:""),placeholder:(this.config.placeholder?this.config.placeholder:"")});
if(this.config.readonly){this.control.setAttribute("readonly",true)
}if(!this.config.titleStyle){this.config.titleStyle="top"
}if(!this.config.style){this.config.style="normal"
}if(!this.config.filter){this.config.filter="none"
}if(!this.config.icon){this.config.icon="none"
}if(this.config.style=="minor"){this.html=b.DB.DIV("field-wrapper text-field-wrapper clear minor dialog-field-"+this.config.name,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control),((this.config.title&&this.config.titleStyle=="top")?b.DB.DIV("field-lhs",{html:this.config.title}):null),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null)))
}else{if(this.config.style=="thin"||this.config.style=="small"){this.prefixEl=b.DB.DIV("field-lhs",{html:this.config.prefix});
this.html=b.DB.DIV("field-wrapper text-field-wrapper clear "+this.config.style+" dialog-field-"+this.config.name,((this.config.title&&this.config.style!="small")?b.DB.DIV("field-title",{html:this.config.title}):null),b.DB.DIV("field-wrapper-inner clear "+this.config.icon,this.prefixEl,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control))),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null));
this.errorFlyoutAnchor=this.html.one(".field-wrapper-inner")
}else{if(this.config.style=="normal"||this.config.style=="major"||this.config.style=="title"){if(this.config.prefixText){this.titleEl=b.DB.DIV("field-lhs left",{html:this.config.prefixText})
}else{if(this.config.title&&(this.config.titleStyle=="left"||this.config.titleStyle=="top")){this.titleEl=b.DB.DIV("field-lhs "+this.config.titleStyle,{html:this.config.title})
}}this.html=b.DB.DIV("field-wrapper text-field-wrapper clear "+(this.config.style)+" dialog-field-"+this.config.name,this.titleEl,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description "+this.config.titleStyle,{html:this.config.description})):null)))
}}}if(this.config.hide){this.html.setStyle("display","none")
}this.panel.bodyEvents.push(b.on("paste",this.onPaste,this.control,this));
this.panel.bodyEvents.push(b.on("keyup",this.onKeyUp,this.control,this));
this.panel.bodyEvents.push(b.on("keypress",this.applyKeyFilter,this.control,this));
this.panel.bodyEvents.push(b.on("keydown",this.onKeyDown,this.control,this));
this.panel.bodyEvents.push(b.on("key",this.onSubmit,this.control,"down:13",this));
this.control.on("input",function(g){console.log(g.target.get("value"))
});
this._subscribe([[this.control,"change",this.onChange]]);
if(f.mailcheck){this.control.plug(b.Squarespace.Plugin.MailCheck,{field:this})
}},onChange:function(){this.fire("change",this.getValue());
this.dialog.fire("datachange",this)
},onPaste:function(c){b.later(1,this,function(){this.updateInlineTitle();
this.updateTextSuffix()
})
},onKeyDown:function(c){if(c.keyCode===9){this.updateInlineTitle();
this.updateTextSuffix()
}else{if(a(c.keyCode)){this.hideInlineTitle()
}}if(c.keyCode!==27){c.stopPropagation()
}},applyKeyFilter:function(d){if(this.config.keyFilter){if(b.UA.gecko!==0&&!d._event.isChar){return
}var f=String.fromCharCode(d.which);
if(!f.match(new RegExp(this.config.keyFilter))&&f.length>0){if(this.config.keyFilterExplanation){this.showError(this.config.keyFilterExplanation)
}d.halt()
}}},onKeyUp:function(d){if(this.config.filter==="url-slug"||this.config.filter=="url-slug-with-slash"){var c,f=this.control.get("value");
if(this.config.filter==="url-slug"){c=b.Squarespace.Utils.createUrl(f)
}else{c=b.Squarespace.Utils.createUrlWithSlash(f)
}var g=this.control._node.selectionStart-(d.keyCode==32?0:1);
if(f!=c){this.control.set("value",c);
this.control._node.selectionStart=g;
this.control._node.selectionEnd=g
}}if(this.config.syncedField){this.panel.getField(this.config.syncedField).setValue(this.getValue())
}if(a(d.keyCode)){this.panel.fire("keyup",this);
this.updateInlineTitle();
this.updateTextSuffix();
this.panel.fire("datachange",this);
this.clearError();
d.stopPropagation()
}if(d.keyCode==13){this.fire("keyup-enter")
}},onSubmit:function(c){c.halt(true);
if(this.config.submitOnEnter){this.dialog.saveAndClose()
}if(this.config.saveOnEnter){if(this.dialog.anchorData){this.dialog.anchorData.once("save",function(){this.panel.hideSaveOverlay()
},this)
}this.panel.save()
}},isEmpty:function(){if(!this.control){return false
}return(this.control.get("value").length===0)
},enable:function(){this.html.removeClass("disabled");
this.control.set("disabled","")
},disable:function(){this.html.addClass("disabled");
this.control.set("disabled","true")
},showInlineTitle:function(){if(this.hideAnim!==null){this.hideAnim.stop();
this.hideAnim=null
}if(!this.inlineTitle){this.inlineTitle=b.DB.DIV("inline-field-title "+(this.config.style),{html:this.config.title});
this.inlineTitle.event=b.on("click",this.focus,this.inlineTitle,this);
b.one(this.html).append(this.inlineTitle)
}var d,c;
switch(this.config.style){case"major":d=16;
break;
case"title":d=17;
break;
case"small":d=3;
break;
default:d=15
}if(this.config.prefixText){d+=110
}c=(this.control.get("offsetHeight")-this.inlineTitle.get("offsetHeight"))/2;
this.currentXY=[d+26,c];
this.inlineTitle.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px",opacity:1})
},hideInlineTitle:function(){if(this.hideAnim!==null){this.hideAnim.stop();
this.hideAnim=null
}if(this.inlineTitle&&this.inlineTitle.inDoc()){this.hideAnim=this._anim({node:this.inlineTitle,from:{opacity:1},to:{opacity:0},duration:0.05,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){this.inlineTitle.event.detach();
this.inlineTitle.remove();
this.inlineTitle=null;
this.hideAnim=null
},this);
this.hideAnim.run()
}},updateInlineTitle:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}else{this.hideInlineTitle()
}}},showTextSuffix:function(){var f=null;
var h=10,e=6;
if(this.config.style=="major"){h=12;
e=11
}if(this.config.style=="title"){h=19;
e=10
}if(this.config.style=="small"){h=3;
e=3
}if(!this.textSuffixwrapper){f=b.DB.DIV("suffix inline-field-title "+(this.config.style),{style:"position: relative;",html:this.config.suffix});
f.setStyles({top:e+"px",opacity:1});
this.textSuffixwrapper=b.DB.DIV("suffix-wrapper",f);
this.textSuffixwrapper.setStyle("height",this.control.get("offsetHeight")+"px");
this.textSuffixwrapper.setStyle("width",this.control.get("offsetWidth")+"px");
this.textSuffixwrapper.setStyle("top",(e)+"px");
this.textSuffixwrapper.setStyle("overflow","hidden");
this.textSuffixwrapper.setStyle("position","absolute");
this.textSuffixwrapper.event=this.textSuffixwrapper.on("click",this.focus,this);
b.one(this.html.one(".field-input-wrapper")).append(this.textSuffixwrapper);
this.measurementEl=b.DB.DIV("measurement-el inline-field-title "+(this.config.style),{style:"position: absolute; opacity: 0;",html:""});
b.one(this.html.one(".field-input-wrapper")).append(this.measurementEl)
}if(f===null){f=this.textSuffixwrapper.one(".suffix")
}var g=this.getValue().replace(/ /g,".");
this.measurementEl.setContent(g);
h+=this.measurementEl.get("offsetWidth");
var d=this.control.get("offsetWidth");
var c=23;
this.textSuffixwrapper.setStyle("width",(d-h)+"px");
this.textSuffixwrapper.setStyle("left",(c+h)+"px");
this.textSuffixwrapper.setStyle("top","0px")
},hideTextSuffix:function(){if(this.textSuffixwrapper){this.textSuffixwrapper.remove();
this.textSuffixwrapper.event.detach();
this.textSuffixwrapper=null;
this.measurementEl.remove()
}},updateTextSuffix:function(){if(this.config.suffix){if(this.isEmpty()){this.hideTextSuffix()
}else{this.showTextSuffix()
}}},resize:function(){var c;
if(this.config.titleStyle=="left"){c=parseInt(this.html.getStyle("width"),10)-parseInt(this.titleEl.get("offsetWidth"),10);
this.control.setStyle("width",c+"px")
}else{if(this.config.style=="thin"){c=parseInt(this.html.getStyle("width"),10)-parseInt(this.html.getStyle("paddingLeft"),10)-parseInt(this.html.getStyle("paddingRight"),10);
this.control.setStyle("width",(c-this.prefixEl.get("offsetWidth")-(this.config.icon!==""?18:0))+"px")
}}},focus:function(c){if(c){c.halt()
}if(this.control){this.control.focus()
}},show:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}else{this.updateTextSuffix()
}}this._super()
},hide:function(){if(this.config.titleStyle=="inline"){this.hideInlineTitle()
}this._super()
},getErrors:function(){var c=this._super();
if(this.config.required&&this.control.get("value")===""){return["Required field."]
}else{return c
}},getValue:function(){return this.control.get("value")
},setValue:function(c){if(!this.control){return
}this.control.set("value",(c!==undefined?c:""));
this.updateInlineTitle();
this.updateTextSuffix();
this.clearError()
},_destroy:function(){this._super();
if(this.testSuffixwrapper&&this.testSuffixwrapper.event){this.testSuffixwrapper.event.detach()
}}}),textarea:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this.hideAnim=null;
this._super(e,c,d);
this.control=b.DB.TEXTAREA("field-textarea",{tabIndex:d.getNextTabIndex()});
if(!this.config.titleStyle){this.config.titleStyle="top"
}if(c[this.config.name]){this.control.set("value",c[this.config.name])
}this.fieldTitleEl=((this.config.title&&this.config.titleStyle=="top")?b.DB.DIV("field-lhs top",{html:this.config.title}):null);
this.html=b.DB.DIV("field-wrapper textarea-field-wrapper clear "+(this.config.style),this.fieldTitleEl,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null)));
if(this.config.height){this.control.setStyle("height",this.config.height+"px")
}this.panel.bodyEvents.push(b.on("keydown",function(f){if(f.keyCode===9){this.updateInlineTitle()
}f.stopPropagation()
},this.control,this));
this.panel.bodyEvents.push(b.on("keyup",this.onDataChanged,this.control,this));
this.panel.bodyEvents.push(b.on("focus",this.onFocus,this.control,this));
this.panel.bodyEvents.push(b.on("blur",this.onBlur,this.control,this));
if(this.value){this.setValue(c[this.config.name])
}if(this.config.hide){this.html.setStyle("display","none")
}},isEmpty:function(){if(!this.control){return false
}return(this.control.get("value").length===0)
},enable:function(){this.html.removeClass("disabled");
this.control.set("disabled","")
},disable:function(){this.html.addClass("disabled");
this.control.set("disabled","true")
},showInlineTitle:function(){if(this.hideAnim!==null){this.hideAnim.stop();
this.hideAnim=null
}if(!this.inlineTitle){this.inlineTitle=b.DB.DIV("inline-field-title textarea",{html:this.config.title});
this.currentXY=[38,12];
this.inlineTitle.setStyles({top:this.currentXY[1]+"px",left:this.currentXY[0]+"px",opacity:1});
this.inlineTitle.event=b.on("click",this.focus,this.inlineTitle,this);
b.one(this.html).append(this.inlineTitle)
}},hideInlineTitle:function(){if(this.inlineTitle&&this.hideAnim===null){this.hideAnim=this._anim({node:this.inlineTitle,from:{opacity:1},to:{opacity:0},duration:0.05,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){this.inlineTitle.event.detach();
this.inlineTitle.remove();
this.inlineTitle=null;
this.hideAnim=null
},this);
this.hideAnim.run()
}},updateInlineTitle:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}else{this.hideInlineTitle()
}}},focus:function(){this.control.focus()
},onDataChanged:function(c){this.updateInlineTitle();
this.panel.fire("datachange",this);
this.clearError()
},onBlur:function(){if(window.CONFIG_PANEL){window.CONFIG_PANEL.set("allowContextMenu",false)
}},onFocus:function(){if(window.CONFIG_PANEL){window.CONFIG_PANEL.set("allowContextMenu",true)
}},show:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}}},hide:function(){if(this.config.titleStyle=="inline"){this.hideInlineTitle()
}},getTakenHeight:function(){if(this.config.verticalSpan){return(this.html.get("offsetHeight")-this.control.get("offsetHeight"))
}else{return(this.html.get("offsetHeight"))
}},getValue:function(){return this.control.get("value")
},setValue:function(c){this.control.set("value",(c?c:""));
this.updateInlineTitle();
this.clearError()
}}),tags:Class.extend(b.Squarespace.DialogField,{_defaultOptions:{allowOnlyExistingTags:false,style:"thin"},initialize:function(e,c,d){this._super(e,c,d);
this.config=b.merge(this._defaultOptions,e);
this.panel=d;
if(this.config.options===null){this.config.options=[]
}this.control=b.DB.DIV("tag-field clear",{html:"&nbsp;"});
if(this.config.style=="minor"){if(this.config.description){this.descriptionEl=b.DB.DIV("field-description",{html:this.config.description})
}this.html=b.DB.DIV("field-wrapper tag-field-wrapper clear minor",b.DB.DIV("field-rhs",b.DB.DIV("field-lhs",{html:this.config.title}),b.DB.DIV("field-input-wrapper",this.control),(this.config.description?b.DB.DIV("field-description-wrapper",this.descriptionEl):null)))
}else{if(this.config.style=="thin"){this.html=b.DB.DIV("field-wrapper tag-field-wrapper clear thin",b.DB.DIV("field-lhs",{html:this.config.title}),b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control)))
}}var f={};
if(this.config.collectionId){f.collectionId=this.config.collectionId
}if(this.config.mode==="tags"&&(this.config.existingTags===null||this.config.existingTags.length<=0)&&!this.config.allowOnlyExistingTags&&this.config.autoCompleteTagsUrl){b.Data.get({url:this.config.autoCompleteTagsUrl,data:f,success:this._cb(function(g){this.config.existingTags=g
})},this)
}if(this.config.mode=="select"){b.Data.get({url:"/api/commondata/GetCollectionCategories",data:f,success:this._cb(function(h){var g=[],i;
for(i in h){if(!h.hasOwnProperty(i)){continue
}g.push(h[i].name)
}this.config.options=g
})},this)
}this.dialog._subscribe([[b,"mouseenter",this.onMouseEnter,this.control,this],[b,"mouseover",this.onMouseOver,this.control,this],[b,"mouseout",this.onMouseOut,this.control,this],[b,"mousemove",this.onMouseMove,this.control,this],[b,"click",this.onClick,this.html,this]]);
if(c[this.config.name]){this.setValue(c[this.config.name])
}else{this.setValue({})
}},blurTag:function(){if(this.activeTag){this.activeTag.a.stop();
var c=this.activeTag.one(":last-child");
if(c){c.remove()
}this.activeTag.setStyle("paddingRight","18px");
this._anim({node:this.activeTag,to:{paddingRight:6},duration:0.25,easing:b.Easing.easeOutStrong}).run();
this.activeTag=null
}},onClick:function(g){g.halt();
if(g.target.get("className")=="x"){var h=b.DB.unpackData(this.activeTag);
this.removeTag(h)
}else{if(this.config.mode=="tags"){if(this.flyoutOpen){return
}this.flyoutOpen=true;
var c=this.html.getX()+40;
var j=this.control.getY()-b.one(document.body).get("docScrollY");
this.flyoutControl=b.DB.INPUT("field-input");
if(this.config.maxtaglength){this.flyoutControl.setAttribute("maxlength",this.config.maxtaglength)
}this.flyoutContents=b.DB.DIV("workflow-flyout-options clear",b.DB.DIV("flyout-title",{html:this.config.createLabel}),this.flyoutControl);
this.flyout=b.DB.DIV("workflow-flyout tight",this.flyoutContents,b.DB.DIV("flyout-notch"));
b.one(document.body).append(this.flyout);
this.flyoutHeight=this.flyout.get("offsetHeight");
this.fieldTop=j-this.flyoutHeight-2;
this.flyout.setStyles({width:(250)+"px",height:this.flyoutHeight+"px",opacity:1,left:(c-10)+"px",top:this.fieldTop+"px"});
this.flyoutContents.setStyles({marginTop:this.flyoutHeight+"px",opacity:0});
var d=this._anim({node:this.flyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong});
d.on("end",function(){this.flyoutControl.focus()
},this);
d.run();
this.flyoutAutoCompleteContents=b.DB.DIV("workflow-flyout-autocomplete clear",{html:"&nbsp;"});
this.flyoutAutoComplete=b.DB.DIV("workflow-flyout tight",this.flyoutAutoCompleteContents);
b.one(document.body).append(this.flyoutAutoComplete);
this.flyoutAutoCompleteContents.setStyles({height:"0px"});
if(this.descriptionEl){this._anim({node:this.descriptionEl,to:{opacity:0},duration:0.2,easing:b.Easing.easeOutStrong}).run()
}this._subscribe([[b,"keydown",this.onTagsFieldKeyDown,this.flyoutControl,this],[b,"keyup",this.onTagsFieldKeyUp,this.flyoutControl,this],[b,"click",this.onAutoCompleteAreaClick,this.flyoutAutoCompleteContents,this]]);
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout, .match",field:this});
if(this.selectCount===0){this.control.set("innerHTML",'<div class="text">'+this.config.emptyText+"</div>")
}}else{if(this.config.mode=="select"){if(this.flyoutOpen){return
}this.flyoutOpen=true;
this.flyoutOptions=[];
for(var f in this.config.options){if(!this.config.options.hasOwnProperty(f)){continue
}this.flyoutOptions.push(b.DB.DIV("flyout-option "+(this.values[this.config.options[f]]?"active":""),{html:this.config.options[f],data:this.config.options[f]}))
}if(this.config.canAddElements){this.createOption=b.DB.DIV("flyout-option add",{html:this.config.addElementText});
this.flyoutOptions.push(this.createOption)
}this.flyoutOptionsArea=b.DB.DIV("flyout-select-options dialog-style-scroll",this.flyoutOptions);
this.flyoutContents=b.DB.DIV("workflow-flyout-options clear",b.DB.DIV("flyout-title",{html:this.config.selectLabel}),this.flyoutOptionsArea);
this.flyout=b.DB.DIV("workflow-flyout tight",this.flyoutContents,b.DB.DIV("flyout-notch"));
var c=this.html.getX()+40;
var j=this.control.getY()-b.one(document.body).get("docScrollY");
b.one(document.body).append(this.flyout);
this.flyoutHeight=this.flyout.get("offsetHeight");
this.fieldTop=j-this.flyoutHeight;
this.flyout.setStyles({width:(this.html.get("offsetWidth")+30)+"px",height:this.flyoutHeight+"px",opacity:1,left:(c-20)+"px",top:this.fieldTop+"px"});
this.flyoutContents.setStyles({marginTop:this.flyoutHeight+"px",opacity:0});
this._anim({node:this.flyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong}).run();
if(this.descriptionEl){this._anim({node:this.descriptionEl,to:{opacity:0},duration:0.2,easing:b.Easing.easeOutStrong}).run()
}this.createControl=b.DB.INPUT("flyout-option-add");
if(this.config.maxtaglength){this.createControl.setAttribute("maxlength",this.config.maxtaglength)
}this._subscribe([[b,"click",this.onFlyoutOptionsClick,this.flyoutOptionsArea,this],[b,"blur",this.onFlyoutCreateFieldBlur,this.createControl,this],[b,"keydown",this.onFlyoutCreateFieldKeyDown,this.createControl,this],[b,"keyup",this.onFlyoutCreateFieldKeyUp,this.createControl,this],[b,"createcategory",this.categoryCreatedCallback,this]]);
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout",field:this});
if(this.selectCount===0){this.control.set("innerHTML",'<div class="text">'+this.config.emptyText+"</div>")
}}}}},onFlyoutOptionsClick:function(d){var c=d.target;
if(c.hasClass("flyout-option")){if(c.hasClass("add")){c.addClass("active");
c.set("innerHTML","");
c.append(this.createControl);
this.createControl.focus();
c.scrollIntoView()
}else{var f=b.DB.unpackData(c);
if(c.hasClass("active")){c.removeClass("active");
this.removeTag(f)
}else{c.addClass("active");
this.createTag(f)
}}}},onFlyoutCreateFieldBlur:function(c){this.createOption.set("innerHTML",this.config.addElementText);
this.createOption.removeClass("active")
},onFlyoutCreateFieldKeyUp:function(c){c.halt()
},onFlyoutCreateFieldKeyDown:function(d){d.stopPropagation();
var f=this._filterVal(this.createControl.get("value"));
if(d.keyCode===13&&f!==""){this.createControl.blur();
this.createControl.set("value","");
if(b.Array.indexOf(this.config.options,f)>=0){this.createOption.set("innerHTML",this.config.addElementText);
this.createOption.removeClass("active");
this.createOption.addClass("add");
var c=this.flyoutOptionsArea.all(".flyout-option");
c.each(function(e){if(f===e.get("text")){e.addClass("active")
}});
this.createTag(f);
return
}this.createOption.set("innerHTML","Creating...");
this.createOption.removeClass("add");
this.createOption.addClass("active");
b.Data.post({url:"/api/commondata/AddCategory",data:{collectionId:this.config.collectionId,category:f},success:this._cb(function(h){var i=b.Squarespace.Library.getCollection(this.config.collectionId);
var g=i.getCategories()||[];
g.push(f);
i.setCategories(g);
var e=[];
h=h.collectionCategories;
for(var j in h){if(!h.hasOwnProperty(j)){continue
}e.push(h[j].name)
}this.config.options=e;
b.fire("createcategory",f)
}),failure:function(e){console.log("Failed to add category")
}},this)
}},onAutoCompleteAreaClick:function(d){if(d.target.hasClass("match")){var c=b.DB.unpackData(d.target);
var f=this.currentAutoCompleteMatches[c.matchIdx].value;
this._addTag(f);
this.flyoutControl.focus()
}},categoryCreatedCallback:function(e){this.createOption.set("innerHTML",this.config.addElementText);
this.createOption.removeClass("active");
this.createOption.addClass("add");
if(e){var d=b.DB.DIV("flyout-option",{style:"opacity: 0; height: 0",html:e,data:e});
this.flyoutOptionsArea.append(d);
this.flyoutOptionsArea.append(this.createOption);
var c=this._anim({node:d,to:{opacity:1,height:16},duration:0.25,easing:b.Easing.easeOutStrong});
c.on("end",function(){this.get("node").setStyle("opacity","");
this.get("node").addClass("active")
});
c.run()
}this.createControl.blur()
},_wordHighlight:function(d,g){var c;
if(d.startsWith(g)){c=0
}else{c=d.toLowerCase().indexOf(" "+g.toLowerCase());
c++
}var f=d.substring(0,c);
var e=d.substring(c,c+g.length);
var h=d.substring(c+g.length);
return(f+"<strong>"+e+"</strong>"+h)
},_filterVal:function(c){return b.Lang.trim((c.replace(new RegExp("[,<>]","g"),"")))
},_addTag:function(c){if(c.length===0||this.values[c]){return
}if(this.config.allowOnlyExistingTags){if(b.Object.hasValue(this.config.existingTags,c)){this.flyoutControl.set("value","");
this.createTag(c);
this.autoCompleteIndex=-1;
this._displayAutoComplete()
}}else{if(this.config.existingTags&&!b.Object.hasValue(this.config.existingTags,c)){this.config.existingTags.push(c)
}this.flyoutControl.set("value","");
this.createTag(c);
this.autoCompleteIndex=-1;
this._displayAutoComplete()
}},onTagsFieldKeyDown:function(d){if(d.keyCode===13||d.keyCode===188){d.preventDefault();
var c=this.flyoutControl.get("value");
var f=this._filterVal(c);
this._addTag(f)
}else{if(d.keyCode==38){if(!this.currentAutoCompleteMatches.length){return
}if(this.autoCompleteIndex!=-1){this.currentAutoCompleteMatches[this.autoCompleteIndex].node.removeClass("selected")
}if(this.autoCompleteIndex>0){this.autoCompleteIndex--
}this.flyoutControl.set("value",this.currentAutoCompleteMatches[this.autoCompleteIndex].value);
this.currentAutoCompleteMatches[this.autoCompleteIndex].node.addClass("selected");
d.preventDefault()
}else{if(d.keyCode==40){if(!this.currentAutoCompleteMatches.length){return
}if(this.autoCompleteIndex!=-1){this.currentAutoCompleteMatches[this.autoCompleteIndex].node.removeClass("selected")
}if(this.autoCompleteIndex<(this.currentAutoCompleteMatches.length-1)){this.autoCompleteIndex++
}this.flyoutControl.set("value",this.currentAutoCompleteMatches[this.autoCompleteIndex].value);
this.currentAutoCompleteMatches[this.autoCompleteIndex].node.addClass("selected");
d.preventDefault()
}else{this.autoCompleteIndex=-1
}}}d.stopPropagation()
},_displayAutoComplete:function(){var j=this.flyoutControl.get("value").replace(new RegExp("[,<>]","g"),"");
var f=0;
this.flyoutAutoCompleteContents.set("innerHTML","");
if(j.length!==0){var h="";
this.currentAutoCompleteMatches=[];
for(var e=0;
e<this.config.existingTags.length;
++e){var d=j.toLowerCase();
var g=this.config.existingTags[e].toLowerCase();
var c=g.indexOf(d);
if(c===0||g[c-1]===" "){var k=b.DB.DIV("match",{html:this._wordHighlight(this.config.existingTags[e],d),data:{matchIdx:f}});
this.flyoutAutoCompleteContents.append(k);
this.currentAutoCompleteMatches.push({node:k,value:this.config.existingTags[e]});
f++
}if(this.currentAutoCompleteMatches.length==6){break
}}}if(this.flyoutAnim){this.flyoutAnim.stop()
}if(f){this.flyoutControl.setStyles({borderBottomLeftRadius:"0px",borderBottomRightRadius:"0px"});
this.flyoutAutoComplete.setStyles({display:"block",width:(210-2)+"px",opacity:1,left:(this.flyoutControl.getX())+"px",top:(this.flyoutControl.getY()+this.flyoutControl.get("offsetHeight"))+"px"});
this.flyoutAutoCompleteContents.setStyles({opacity:1,display:"block"});
this.flyoutAnim=this._anim({node:this.flyoutAutoCompleteContents,to:{height:(f*23)},duration:0.25,easing:b.Easing.easeOutStrong});
this.flyoutAnim.run()
}else{this.flyoutControl.setStyles({borderBottomLeftRadius:"3px",borderBottomRightRadius:"3px"});
this.flyoutAnim=this._anim({node:this.flyoutAutoCompleteContents,to:{height:0},duration:0.25,easing:b.Easing.easeOutStrong});
this.flyoutAnim.on("end",function(){this.get("node").setStyle("display","none")
});
this.flyoutAnim.run()
}},onTagsFieldKeyUp:function(c){c.halt();
if(this.config.mode=="tags"&&this.autoCompleteIndex==-1){this._displayAutoComplete()
}},createTag:function(h,g){if(!g){g=h
}if(this.values[h]){return
}if(this.selectCount===0){this.control.set("innerHTML","")
}var c=b.DB.DIV("tag "+this.config.itemClass,{html:h,data:g});
c.setStyle("opacity",0);
this.control.append(c);
var e=c.get("offsetWidth");
c.setStyles({width:"0px",paddingLeft:"0px",paddingRight:"0px",opacity:1});
this.updateMeasurements(e);
this.viewportToPercent(100);
if(this.config.style=="minor"){c.a=this._anim({node:c,to:{width:e-20,paddingRight:14,paddingLeft:10},duration:0.15,easing:b.Easing.easeOutStrong})
}else{c.a=this._anim({node:c,to:{width:e-20,paddingRight:6,paddingLeft:14},duration:0.15,easing:b.Easing.easeOutStrong})
}c.a.on("end",function(){this.get("node").setStyle("width","")
});
c.a.run();
this.values[h]=true;
this.selectCount++;
var f=b.Squarespace.Library.getCollection(this.config.collectionId);
var d=f.getTags()||[];
d.push(g);
f.setTags(d);
this.panel.fire("datachange",this)
},removeTag:function(d){this.seekVal=d;
this.control.all(".tag").each(function(f){var e=b.DB.unpackData(f);
if(this.seekVal==e){this.theNode=f
}},this);
this.seekVal=null;
if(!this.theNode){return
}if(this.activeTag==this.theNode){this.removingNode=this.theNode;
this.activeTag=null
}if(this.theNode.a){this.theNode.a.stop()
}var c=this._anim({node:this.theNode,to:{width:0,paddingRight:0,paddingLeft:0,marginRight:0},duration:0.15,easing:b.Easing.easeOutStrong});
c.on("end",function(){this.theNode.remove();
this.theNode=null;
if(this.selectCount===0){this.control.set("innerHTML",'<div class="text dialog-element">'+(this.flyoutOpen?this.config.emptyText:this.config.addText)+"</div>")
}this.updateMeasurements()
},this);
c.run();
delete this.values[d];
this.selectCount--;
this.panel.fire("datachange",this)
},closeFlyout:function(){if(this.selectCount===0){this.control.set("innerHTML",'<div class="text dialog-element">'+this.config.addText+"</div>")
}if(this.descriptionEl){this._anim({node:this.descriptionEl,to:{opacity:1},duration:0.2,easing:b.Easing.easeOutStrong}).run()
}var d=this._anim({node:this.flyoutContents,to:{marginTop:this.flyoutHeight,opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
d.on("end",function(){this._clearEvents();
this.flyout.remove();
this.flyoutOpen=false
},this);
d.run();
if(this.flyoutAutoCompleteContents){var c=this._anim({node:this.flyoutAutoCompleteContents,to:{marginTop:-this.flyoutAutoComplete.get("offsetHeight"),opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
c.on("end",function(){this.flyoutAutoComplete.remove()
},this);
c.run()
}this.panel.clearActiveFlyout()
},updateMeasurements:function(f){if(!f){f=0
}var c=this.html.one(".tag-field .tag:last-child");
var d=this.html.one(".field-input-wrapper");
var e=parseInt(this.html.one(".tag-field").getStyle("margin-left"));
if(c){this.lastChildEndX=c.getX()-this.html.getX()+c.get("offsetWidth")-19-e+f
}},onMouseEnter:function(){if(!this.lastChildEndX){this.updateMeasurements()
}},onMouseMove:function(i){var f=this.html.one(".field-input-wrapper");
var d=f.get("offsetWidth");
var h=this.lastChildEndX-d;
if(h>0){var c=i.clientX-f.getX();
var g=c/d;
this.viewportToPercent(g)
}},onMouseOver:function(c){if(this.blurTimer){this.blurTimer.cancel();
this.blurTimer=null
}if(this.snapBackTimer){this.snapBackTimer.cancel();
this.snapBackTimer=null
}if(c.target.hasClass("tag")){if(this.activeTag==c.target){return
}if(this.removingNode==c.target){return
}this.blurTag();
this.activeTag=c.target;
this.activeTag.a=this._anim({node:this.activeTag,to:{paddingRight:18},duration:0.25,easing:b.Easing.easeOutStrong});
this.activeTag.a.on("end",function(){this.get("node").append(b.DB.DIV("x",{html:"&times;"}));
this.get("node").setStyle("paddingRight","2px")
});
this.activeTag.a.run()
}},onMouseOut:function(c){if(c.target.hasClass("x")){return
}if(this.blurTimer){return
}if(!this.snapBackTimer){this.snapBackTimer=b.later(150,this,this.viewportTo,0)
}this.blurTimer=b.later(50,this,this.blurTag)
},viewportToPercent:function(e){var d=this.html.one(".field-input-wrapper");
var c=d.get("offsetWidth");
var f=this.lastChildEndX-c;
if(f>0){if(e<0.04){e=0
}if(e>0.96){e=1
}var g=f*e;
this.html.one(".tag-field").setStyle("margin-left","-"+g)
}},viewportTo:function(c){if(this.snapBackAnim){this.snapBackAnim.stop()
}this.snapBackAnim=this._anim({node:this.html.one(".tag-field"),to:{marginLeft:c},duration:0.3,easing:b.Easing.easeOutStrong});
this.snapBackAnim.run();
this.snapBacktimer=null
},focus:function(){this.control.focus()
},onDataChanged:function(c){this.panel.fire("datachange",this)
},getValue:function(){if(!this.selectCount){return null
}var d=[];
for(var c in this.values){d.push(c)
}return d
},setValue:function(d){if(!d){d={}
}this.values={};
this.selectCount=0;
if(b.Lang.isArray(d)){for(var e=0;
e<d.length;
++e){this.values[d[e]]=true;
this.selectCount++
}}else{for(var c in d){this.values[c]=d[c];
this.selectCount++
}}if(this.selectCount===0){this.control.set("innerHTML",'<div class="text dialog-element">'+this.config.addText+"</div>")
}else{this.control.set("innerHTML","");
for(var f in this.values){this.control.append(b.DB.DIV("tag "+this.config.itemClass,{html:f,data:f}))
}}}}),progress:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.control=b.DB.DIV("field-progress-inner",{html:"&nbsp;",style:"width: 0px;"});
this.controlContainer=b.DB.DIV("field-progress-wrapper",this.control);
this.html=b.DB.DIV("field-wrapper clear",(this.config.title?b.DB.DIV("field-lhs",{html:this.config.title}):null),b.DB.DIV("field-rhs",this.controlContainer))
},setMessage:function(c){this.control.set("innerHTML",'<div class="text dialog-element">'+c+"</div>")
},setProgress:function(c,d){if(c>1){c=1
}if(c<0){c=0
}this.a=this._anim({node:this.control,to:{width:Math.round(c*this.controlContainer.get("offsetWidth")-6)},duration:0.25,easing:b.Easing.easeOutStrong});
if(d){this.a.on("end",function(){this.control.set("innerHTML",'<div class="text dialog-element">'+d+"</div>");
this.a=null
},this)
}else{this.a.on("end",function(){this.control.set("innerHTML",'<div class="text dialog-element">'+Math.round(c*100)+"%</div>");
this.a=null
},this)
}this.a.run();
this.previousPercentage=c
},hide:function(){if(this.a){this.a.stop()
}}}),html:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
var f;
if(typeof this.config.html=="string"){f=b.Node.create(this.config.html)
}else{f=this.config.html.cloneNode(true)
}this.html=f.addClass("field-wrapper clear html-field"+("name" in this.config?" "+this.config.name:"")+("className" in this.config?" "+this.config.className:""))
},getNode:function(){return this.getWrapperNode()
},getWrapperNode:function(){return this.html
},getContent:function(){return this.html.getContent()
},setContent:function(c){this.html.setContent(c)
}}),description:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.html=b.DB.DIV("field-wrapper clear",b.DB.DIV("custom-field-description "+(this.config.className?this.config.className:""),{html:(this.config.title?'<div class="title">'+this.config.title+'</div><div class="text">'+this.config.text+"</div>":this.config.text),style:((this.config.width&&this.config.width>1)?"width: "+this.config.width+"px;":"")+(this.config.padding?"padding-top: "+this.config.padding[0]+"px;":"")+(this.config.padding?"padding-bottom: "+this.config.padding[1]+"px;":"")}))
},setTitle:function(c){this.html.one(".title").setContent(c)
},setText:function(d){var c=this.config.title?'<div class="title">'+this.config.title+'</div><div class="text">'+d+"</div>":d;
this.html.one(".custom-field-description").setContent(c)
},onClick:function(c){this.panel.fire("click",this.config.name)
}}),link:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.html=b.DB.DIV("field-wrapper clear active custom-field-link "+(this.config.className?this.config.className:""),{html:"<span>"+(this.config.href?'<a href="'+this.config.href+'">'+this.config.title+"</a>":this.config.title)+"</span>"});
if(e.align){this.html.setStyle("textAlign",e.align)
}this.html.on("click",this.onClick,this)
},onClick:function(c){this.panel.fire("link-"+this.config.name,this.config.name)
}}),"section-title":Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.value=null;
this.titleRhs=[];
this.tabEls={};
if(this.config.tabs){for(var g=0;
g<this.config.tabs.length;
++g){var f=this.config.tabs[g];
this.tabEls[f.name]=b.DB.DIV("tab",{html:f.title,data:{value:f.name}});
this.titleRhs.push(this.tabEls[f.name]);
if(f.active){this.tabEls[f.name].addClass("active");
this.activeEl=this.tabEls[f.name];
this.value=f.name
}}}this.html=b.DB.DIV("field-wrapper clear",b.DB.DIV("nothing",{style:(this.config.padding?"padding-top: "+this.config.padding[0]+"px;":"")+(this.config.padding?"padding-bottom: "+this.config.padding[1]+"px;":"")},b.DB.DIV("field-section-title clear "+this.config.className,b.DB.DIV("lhs",{html:this.config.text}),b.DB.DIV("rhs",this.titleRhs))));
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this))
},onClick:function(c){if(!c.target.hasClass("tab")){return
}if(this.activeEl){this.activeEl.removeClass("active")
}c.target.addClass("active");
this.activeEl=c.target;
this.value=b.DB.unpackData(c.target).value;
if(this.config.linkFrame){this.panel.getField(this.config.linkFrame).show(this.value)
}this.panel.fire("datachange",this)
},getValue:function(){return this.value
}}),statepicker:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.value=c[this.config.name];
if(!this.value){this.value={state:this.config.stateOrder[0],date:(this.params.allowNever?undefined:new Date().getTime())}
}if(this.value.date){this.durationOffset=Math.round((this.value.date-new Date().getTime()-Static.SQUARESPACE_CONTEXT.website.timeZoneOffset)/1000/60/60/24)
}else{this.durationOffset=-1
}this.stateLabel=b.DB.DIV("field-workflow-title",{html:"&nbsp;"});
this.stateDescription=b.DB.DIV("field-workflow-description",{html:"&nbsp;"});
this.html=b.DB.DIV("field-wrapper clear field-workflow-wrapper",this.stateLabel,this.stateDescription);
this.panel.bodyEvents.push(b.on("click",this.onStateChangeRequest,this.stateLabel,this));
this.panel.bodyEvents.push(b.on("click",this.onStateChangeRequest,this.stateDescription,this));
this.updateDisplay()
},onStateChangeConfirm:function(d){var c=b.DB.unpackData(d.target);
if(this.value.state!=c){this.panel.fire("datachange",this)
}this.value.state=c;
this.updateDisplay();
this.closeFlyout(c)
},updateDisplay:function(){this.stateLabel.set("innerHTML",this.getStateTitle());
this.stateDescription.set("innerHTML",this.getStateDescription())
},closeFlyout:function(e){var d;
if(this.dateFlyout){this.html.removeClass("date-picker-active");
d=this._anim({node:this.dateFlyoutContents,to:{marginTop:this.dateFlyoutHeight,opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
d.on("end",function(){for(var f=0;
f<this.dateFlyoutEvents.length;
++f){this.dateFlyoutEvents[f].detach()
}if(this.durationSlider){this.durationSlider.detach()
}this.dateFlyout.remove();
this.dateFlyout=null;
this.dateFlyoutContents=null
},this);
d.run()
}else{if(!e){e=this.value.state
}for(var c=0;
c<this.optEls.length;
++c){if(this.optEls[c]._node.data!=e){this._anim({node:this.optEls[c],to:{height:0},duration:0.25,easing:b.Easing.easeOutStrong}).run()
}this.optElEvents[c].detach()
}if(this.config.direction=="up"){d=this._anim({node:this.flyout,to:{top:this.fieldTop},duration:0.25,easing:b.Easing.easeOutStrong});
d.run()
}d=this._anim({node:this.flyout,to:{opacity:0},duration:0.55,easing:b.Easing.easeOutStrong});
d.on("end",function(){this.flyout.remove()
},this);
d.run()
}this.panel.clearActiveFlyout()
},_renderCalendar:function(f,e){var o=["Su","Mo","Tu","We","Th","Fr","Sa"];
var m='<div class="calendar-wrapper"><div class="header"><div class="back">&nbsp;</div>'+b.Squarespace.Utils.dateFormat(f,{format:"%B %Y"})+'<div class="next">&nbsp;</div></div>';
m+='<table cellpadding="0" cellspacing="0">';
m+='<tr class="header-row">';
m+=(o.reduce(function(d,i){return d+"<td>"+i+"</td>"
},""));
m+="</tr>";
var k=new Date();
k.setTime(f.getTime());
var t=new Date();
t.setTime(f.getTime());
t.moveToFirstDayOfMonth();
var c=t.getDay();
var s=f.getDaysInMonth();
var g=new Date();
g.setTime(f.getTime());
g.addMonths(-1);
var r=g.getDaysInMonth();
var p=new Date();
var q=1;
for(var l=0;
l<6;
++l){m+='<tr class="body-row">';
if(q>(s+c)){for(var l=0;
l<7;
++l){m+='<td class="fade">&nbsp;</td>'
}}else{for(var h=0;
h<7;
++h){if(q<=c){m+='<td class="fade">'+(r-c+q)+"</td>"
}else{if(q<=(s+c)){k.set({day:(q-c)});
var n=new Date(this.value.date);
if(this.dateFlyoutType=="duration"){if(this.value.date&&(n.getMonth()==f.getMonth())&&(n.getDate()==(q-c))){m+='<td class="active selected">'+(q-c)+"</td>"
}else{if((p.getMonth()==f.getMonth())&&(p.getDate()==(q-c))){m+='<td class="today">'+(q-c)+"</td>"
}else{if(k.getTime()<p.getTime()){m+='<td class="fade">'+(q-c)+"</td>"
}else{m+='<td class="active">'+(q-c)+"</td>"
}}}}else{if(this.value.date&&(n.getMonth()==f.getMonth())&&(n.getDate()==(q-c))){m+='<td class="active selected">'+(q-c)+"</td>"
}else{if((p.getMonth()==f.getMonth())&&(p.getDate()==(q-c))){m+='<td class="active today">'+(q-c)+"</td>"
}else{m+='<td class="active">'+(q-c)+"</td>"
}}}}else{m+='<td class="fade">'+(q-c-s)+"</td>"
}}++q
}}m+="</tr>"
}m+="</table></div>";
e.set("innerHTML",m)
},onCalendarClick:function(d){if(d.target.hasClass("back")){this.currentCalendarMonth.addMonths(-1);
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer)
}else{if(d.target.hasClass("next")){this.currentCalendarMonth.addMonths(1);
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer)
}else{if(this.dateFlyoutType=="duration"&&(d.target.hasClass("fade")||d.target.hasClass("selected"))&&this.config.allowNever){this.value.date=null;
this.durationSlider.setValue(-1);
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
this.updateDisplay()
}else{if(d.target.hasClass("active")||d.target.hasClass("today")){if(!this.value.date){this.value.date=new Date()
}var c=new Date(this.value.date).set({year:this.currentCalendarMonth.getFullYear(),month:this.currentCalendarMonth.getMonth(),day:parseInt(d.target.get("innerHTML"),10),second:0,millisecond:0});
this.value.date=c.getTime();
if(this.dateFlyoutType=="duration"){this.durationOffset=Math.round((this.value.date-new Date().getTime()-Static.SQUARESPACE_CONTEXT.website.timeZoneOffset)/1000/60/60/24);
this.durationDisplay.set("innerHTML",this.getDurationTextShort())
}this.hourControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%l"})));
this.minuteControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%M"})));
this.ampmControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%p"})));
this._updateTime();
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
this.updateDisplay()
}}}}},onTimeFieldKeyUp:function(d){var c;
if(d.target.hasClass("hour")){c=parseInt(this.hourControl.get("value"),10);
if(c>12||c<1){this.hourControl.set("value",this.prevVal)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>60||c<0){this.minuteControl.set("value",this.prevVal)
}}}this._updateTime()
},onTimeFieldClick:function(c){if(c.target.hasClass("hour")){this.hourControl.select()
}else{if(c.target.hasClass("minute")){this.minuteControl.select()
}else{if(c.target.hasClass("ampm")){this.ampmControl.select()
}}}},onTimeFieldBlur:function(d){var c;
if(d.target.hasClass("hour")){c=this.hourControl.get("value");
if(c.indexOf("0")===0){this.hourControl.set("value",parseInt(c,10))
}c=parseInt(c,10);
if(c>12||c<1){this.hourControl.set("value",12)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>=0&&c<=9){this.minuteControl.set("value","0"+c)
}c=parseInt(c,10);
if(c>60||c<0){this.minuteControl.set("value",0)
}}}this._updateTime()
},onTimeFieldKeyDown:function(c){if(c.keyCode==65){this.ampmControl.set("value","AM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==80){this.ampmControl.set("value","PM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==13){this.closeFlyout();
return
}}}if(c.target.hasClass("hour")){if(c.keyCode==186){this.minuteControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.hourControl.get("value")
}else{if(c.target.hasClass("minute")){if(c.keyCode==32){this.ampmControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.minuteControl.get("value")
}else{if(c.target.hasClass("ampm")){if(c.keyCode!=9){c.halt()
}}}}},_updateTime:function(){var e=parseInt(this.hourControl.get("value"),10);
var c=parseInt(this.minuteControl.get("value"),10);
var d=this.ampmControl.get("value");
if(isNaN(e)){return
}if(isNaN(c)){return
}if(e>12||e<=0){e=12
}if(c>60||c<0){c=0
}if(e==12&&d=="AM"){e=0
}else{if(e!=12&&d=="PM"){e+=12
}}var i=new Date(this.value.date);
var g=e-b.Lang.trim(b.Squarespace.Utils.dateFormat(i,{format:"%H"}));
var f=c-b.Lang.trim(b.Squarespace.Utils.dateFormat(i,{format:"%M"}));
i.setHours(i.getHours()+g);
i.setMinutes(i.getMinutes()+f);
this.value.date=i.getTime();
this.updateDisplay()
},onDateChangeRequest:function(g,j){if(this.dateFlyout){return
}this.dateFlyoutType=j;
var f=400;
var h=new Date(this.value.date);
this.html.addClass("date-picker-active");
this.dateCalendarContainer=b.DB.DIV("empty",{html:"&nbsp;",style:"float: left;"});
this.hourControl=b.DB.INPUT("time-control hour",{maxlength:2,style:"text-align: right;",value:b.Lang.trim(b.Squarespace.Utils.dateFormat(h,{format:"%l"}))});
this.minuteControl=b.DB.INPUT("time-control minute",{maxlength:2,style:"text-align: left;",value:b.Squarespace.Utils.dateFormat(h,{format:"%M"})});
this.ampmControl=b.DB.INPUT("time-control ampm",{maxlength:2,style:"text-align: left; width: 36px;",value:b.Squarespace.Utils.dateFormat(h,{format:"%p"})});
this.durationDisplay=b.DB.DIV("duration-display",{html:this.getDurationTextShort()});
this.timeWrapper=b.DB.DIV("time-wrapper",this.hourControl,b.DB.DIV("time-control",{html:":",style:"width: 5px; border: 0px"}),this.minuteControl,this.ampmControl);
if(!this.value.date){this.timeWrapper.addClass("disabled");
this.hourControl.set("value","10");
this.minuteControl.set("value","00");
this.ampmControl.set("value","AM")
}else{this.timeWrapper.removeClass("disabled")
}this.dateFlyoutContents=b.DB.DIV("workflow-flyout-options",b.DB.DIV("flyout-title clear",{html:"Select a Date & Time",style:"padding-bottom: 8px;"}),b.DB.DIV("flyout-calendar clear",this.dateCalendarContainer,this.timeWrapper),(this.dateFlyoutType=="duration"?b.DB.DIV("duration-wrapper clear",this.durationDisplay,b.DB.DIV("slider-container-wrapper",b.DB.DIV("slider-container",{style:"margin-left: 75px;",id:"duration-slider-display-"+this.getName()}))):null));
var m=b.one(this.stateDescription).one((j=="duration"?".duration":".date"));
this.dateFlyout=b.DB.DIV("workflow-flyout tight",this.dateFlyoutContents,b.DB.DIV("flyout-notch"));
this.dateFlyoutEvents=[b.on("click",this.onCalendarClick,this.dateFlyout,this),b.on("keyup",this.onTimeFieldKeyUp,this.hourControl,this),b.on("keyup",this.onTimeFieldKeyUp,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.hourControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.ampmControl,this),b.on("blur",this.onTimeFieldBlur,this.hourControl,this),b.on("blur",this.onTimeFieldBlur,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.hourControl,this),b.on("click",this.onTimeFieldClick,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.ampmControl,this)];
this.currentCalendarMonth=new Date();
if(this.value.date){this.currentCalendarMonth.setTime(this.value.date)
}this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
b.one(document.body).append(this.dateFlyout);
var n=this.stateLabel.getX();
var k=this.stateLabel.getY()-b.one(document.body).get("docScrollY");
this.dateFlyoutWidth=f;
this.dateFlyoutHeight=this.dateFlyout.get("offsetHeight");
this.fieldTop=k-this.dateFlyoutHeight+22;
var c=new b.Squarespace.Position({x:(n-31),y:(this.fieldTop+b.one(document.body).get("docScrollY")),w:this.dateFlyoutWidth,h:this.dateFlyoutHeight});
c.nudgeFix();
var i=m.getX()-b.one(this.stateDescription).getX();
this.dateFlyout.setXY([c.getX(),c.getY()]);
this.dateFlyout.setStyles({width:(f)+"px",height:this.dateFlyoutHeight+"px",opacity:1});
this.dateFlyout.one(".flyout-notch").setStyle("margin-left",(c.getXAdj()+(i+(m.get("offsetWidth")/2)-8))+"px");
this.dateFlyoutContents.setStyles({marginTop:this.dateFlyoutHeight,opacity:0});
var l=this._anim({node:this.dateFlyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong});
l.on("end",function(){if(this.dateFlyoutType=="duration"){this.durationSlider=new b.Slider({min:(j=="duration"&&this.config.allowNever?-1:0),max:90,axis:"x",length:b.one("#duration-slider-display-"+this.getName()).get("offsetWidth")+"px",value:this.durationOffset});
this.durationSlider.after("valueChange",function(d){this.durationOffset=d.newVal;
if(this.durationOffset==-1){this.timeWrapper.addClass("disabled");
this.value.date=null
}else{this.timeWrapper.removeClass("disabled");
if(!this.value.date){this.value.date=new Date()
}this.value.date=(new Date().getTime()+(d.newVal*1000*60*60*24));
this._updateTime();
this.currentCalendarMonth=new Date();
this.currentCalendarMonth.setTime(this.value.date)
}this.durationDisplay.set("innerHTML",this.getDurationTextShort());
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
this.updateDisplay()
},this);
this.durationSlider.render("#duration-slider-display-"+this.getName())
}},this);
l.run();
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout, .calendar-wrapper",field:this})
},onStateChangeRequest:function(k){if(k.target.hasClass("date")){this.onDateChangeRequest(k,"date");
return
}if(k.target.hasClass("duration")){this.onDateChangeRequest(k,"duration");
return
}if(Object.keys(this.config.states).length<=1){return
}this.optEls=[];
this.optElEvents=[];
for(var f=0;
f<this.config.stateOrder.length;
++f){var o=this.config.stateOrder[f];
var q=this.config.states[o];
this.optEls.push(b.DB.DIV("field-workflow-flyout-option-wrapper "+(this.value.state==o?"selected":""),{data:o},b.DB.DIV("field-workflow-flyout-option",b.DB.DIV("field-workflow-title",{html:q.title}),b.DB.DIV("field-workflow-description",{html:q.optionDesc}))));
this.optElEvents.push(b.on("click",this.onStateChangeConfirm,this.optEls[f],this))
}var r=b.DB.DIV("workflow-flyout-options",this.optEls);
this.flyout=b.DB.DIV("workflow-flyout",r);
b.one(document.body).append(this.flyout);
var m=this.stateLabel.getX();
var l=this.stateLabel.getY()-b.one(document.body).get("docScrollY");
var n=this.optEls[0].get("offsetHeight");
var g=this.flyout.get("offsetHeight");
this.fieldTop=l-g+(n*this.optEls.length)+10;
for(var f=0;
f<this.optEls.length;
++f){if(this.optEls[f]._node.data!=this.value.state){this.optEls[f].setStyle("height","0px")
}}var c=new b.Squarespace.Position({x:(m-31),y:(this.fieldTop+b.one(document.body).get("docScrollY")),w:this.flyout.get("offsetWidth"),h:this.flyout.get("offsetHeight")});
this.flyout.setXY([c.getX(),c.getY()]);
this.flyout.setStyles({width:(this.stateLabel.get("offsetWidth")+30)+"px",opacity:1});
if(this.config.direction=="up"){this._anim({node:this.flyout,to:{top:this.fieldTop-(n*(this.optEls.length-1))},duration:0.25,easing:b.Easing.easeOutStrong}).run()
}for(var d=0;
d<this.optEls.length;
++d){if(this.optEls[d]._node.data!=this.value.state){this._anim({node:this.optEls[d],to:{height:n},duration:0.25,easing:b.Easing.easeOutStrong}).run()
}}this.panel.setActiveFlyout({constraintClasses:".workflow-flyout",field:this})
},getStateTitle:function(){return this.config.states[this.value.state].title
},getDurationText:function(){var c=new Date(this.value.date);
if(this.durationOffset==-1){return'<span class="duration-wrapper"><span class="duration">never</span></span>'
}else{if(this.durationOffset<0){return'<span class="duration-wrapper"><span class="duration">now</span></span>'
}else{if(this.durationOffset===0){return'<span class="duration-wrapper"><span class="duration">today at '+b.Squarespace.Utils.dateFormat(c,{format:"%l:%M %p"})+"</span></span>"
}else{if(this.durationOffset==1){return'<span class="duration-wrapper"><span class="duration">tomorrow at '+b.Squarespace.Utils.dateFormat(c,{format:"%l:%M %p"})+"</span></span>"
}else{return'<span class="duration-wrapper"><span class="duration">in '+this.durationOffset+" days at "+b.Squarespace.Utils.dateFormat(c,{format:"%l:%M %p"})+"</span></span>"
}}}}},getDurationTextShort:function(){if(this.durationOffset==-1){return'<span class="duration">Never</span>'
}else{if(this.durationOffset===0){return'<span class="duration">Today</span>'
}else{if(this.durationOffset==1){return'<span class="duration">Tomorrow</span>'
}else{if(this.durationOffset<-1){return'<span class="duration">'+this.durationOffset+" Days ago</span>"
}else{return'<span class="duration">In '+this.durationOffset+" Days</span>"
}}}}},getStateDescription:function(){var c,d;
d='<span class="date-wrapper"><span class="date">'+b.Squarespace.Utils.dateFormat(new Date(this.value.date),{format:"%a, %b %d at %l:%M %p"})+"</span></span>";
return(this.config.states[this.value.state].stateDesc.replace("[DATE]",d).replace("[DURATION]",this.getDurationText()))
},focus:function(){this.control.focus()
},setValue:function(c){if(!c){c={state:this.config.stateOrder[0],date:null}
}this.updateDisplay();
this._super(c)
}}),button:Class.extend(b.Squarespace.DialogField,{_events:{click:{}},initialize:function(d,c,e){this._super(d,c,e);
this._buttonEl=b.DB.BUTTON((this.config.className?this.config.className:"normal-button"),{type:"button",name:(this.config.name?this.config.name:""),value:(this.config.value?this.config.value:""),"data-field-name":(this.config.name?this.config.name:"")});
this.html=b.DB.DIV("field-wrapper button");
this.html.appendChild(this._buttonEl);
if(this.config.alignment){this.html.setStyle("text-align",this.config.alignment)
}this.control=this.html;
if(this.config.waiting){this._waitingEl=b.DB.DIV("waiting");
this.html.appendChild(this._waitingEl);
this._waitingEl.hide()
}if(this.config.icon){this._buttonEl.appendChild(b.DB.DIV("icon"))
}this._textEl=b.DB.SPAN("text",{html:(this.config.text?this.config.text:"")});
this._buttonEl.appendChild(this._textEl);
this._subscribe(this._buttonEl,"click",this._onClick,this,this.html);
this.setActiveStatus(c[this.config.name]?true:false)
},_onClick:function(c){if(!this.disabled){if(this.config.href){window.location=this.config.href
}else{if(this.config.onclick){this.config.onclick.call(this.config.context||this)
}else{this.dialog.fire("click",this);
this.fire("click",this.isActive())
}}}},setText:function(c){if(this._textEl){this._textEl.setContent(c)
}},getText:function(){return this._textEl.getContent()
},setTextAnimated:function(e){var c=new b.Anim({node:this._textEl,from:{opacity:0},to:{opacity:1},duration:0.2,easing:"easeOut"});
var d=new b.Anim({node:this._textEl,from:{opacity:1},to:{opacity:0},duration:0.2,easing:"easeIn"});
c.on("end",b.bind(function(){this.enable();
this.temporaryShow()
},this));
d.on("end",b.bind(function(){this._textEl.setContent(e);
c.run()
},this));
this.disable();
d.run()
},showWaiting:function(){this._waitingEl.show()
},hideWaiting:function(){this._waitingEl.hide()
},disable:function(){this.disabled=true;
this._buttonEl.setAttribute("disabled","disabled");
this.html.addClass("disabled")
},enable:function(){this.disabled=false;
this._buttonEl.removeAttribute("disabled");
this.html.removeClass("disabled")
},isEnabled:function(){return !this.disabled
},setActiveStatus:function(c){if(c){this.active=true;
this.html.addClass("active")
}else{this.active=false;
this.html.removeClass("active")
}},setActive:function(){this.setActiveStatus(true)
},setInactive:function(){this.setActiveStatus(false)
},isActive:function(){return this.active
}}),rating:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.active=(c[this.config.name]?true:false);
this.value=0;
this.control=b.DB.DIV("rating-slider");
this.html=b.DB.DIV("field-wrapper",b.DB.DIV("rating-field-wrapper",b.DB.DIV("rating-element",b.DB.DIV("rating-overlay"),this.control)));
this.panel.bodyEvents.push(b.on("mousedown",this.onClick,this.html,this));
this.setValue(c.rating?c.rating:0)
},onClick:function(h){var f=h.pageX-this.html.one(".rating-element").getX();
var g=13;
var c=0;
for(var d=0;
d<11;
d++){if(d*g-f>0){c=d;
break
}}this.value=c/2;
this.control.setStyle("width",c*g)
},setValue:function(c){if(c<0||c>5){return
}this.value=Math.round(c*2)/2;
this.control.setStyle("width",this.value*26)
},getValue:function(){return this.value?this.value:0
}}),"social-accounts":Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.config.networks=["facebook","twitter","foursquare","google","tumblr","email","blogger","linkedin","reddit","stumbleupon"];
this.accountContainerEl=b.DB.DIV("social-accounts");
this.html=b.DB.DIV("field-wrapper social-adder-wrapper",b.DB.DIV("header",b.DB.DIV("title",{html:"Connected Accounts"}),b.DB.DIV("description",{html:"Add your social links."})),this.accountContainerEl);
this.html.append(this.chooser);
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this));
this.panel.bodyEvents.push(b.on("keyup",this.onKeyUp,this.html,this));
if(c[this.config.name]){this.render(c[this.config.name])
}else{this.accountContainerEl.append(this.renderSocialAccount({type:this.config.networks[0],username:""}))
}},onKeyUp:function(c){this.panel.fire("datachange",this)
},onClick:function(h){var k=h.target;
var d=k.ancestor(".social-account",true);
if(!k.hasClass("logo")&&!k.hasClass("chooser-button")&&this.activeEl){this.hideChooser(this.activeEl)
}h.halt();
if(k.hasClass("logo")){this.toggleChooser(d)
}else{if(k.hasClass("plus")){if(this.getCount()>=this.config.maxCount){return
}this.showChooser(d.insert(this.renderSocialAccount({type:this.config.networks[0],username:""}),"after").next());
this.panel.fire("datachange",this)
}else{if(k.hasClass("minus")){d.remove();
if(this.getCount()<1){this.accountContainerEl.append(this.renderSocialAccount({type:this.config.networks[0],username:""}))
}this.panel.fire("datachange",this)
}else{if(k.hasClass("chooser-button")){var g=d.one(".logo");
var f=d.one(".chooser");
this.clearSocial(g);
var j=this.config.networks;
for(var c=0;
c<j.length;
c++){if(h.target.hasClass(j[c])){g.addClass(j[c]);
d.one(".type").set("text",j[c])
}}this.hideChooser(d);
this.panel.fire("datachange",this)
}}}}},clearSocial:function(d){var e=this.config.networks;
for(var c=0;
c<e.length;
c++){console.log(e[c]);
d.removeClass(e[c])
}},toggleChooser:function(c){if(c.one(".logo").hasClass("active")){this.hideChooser(c)
}else{this.showChooser(c)
}},hideChooser:function(d){d.one(".logo").removeClass("active");
this.activeEl=null;
var c=this._anim({node:d.one(".chooser"),to:{width:0},duration:0.25,easing:b.Easing.easeOutStrong});
c.run()
},showChooser:function(d){var e=d.one(".chooser");
b.all(".social-account .chooser").setStyle("width","0");
var c=this._anim({node:e,to:{width:154},duration:0.25,easing:b.Easing.easeOutStrong});
this._subscribe(c,"end",function(){var f=this.panel.bodyEl;
var i=e.get("region").bottom;
var g=f.get("region").bottom;
var h=i>g;
if(f.hasClass("scrollable")&&h){f.set("scrollTop",f.get("scrollHeight"))
}},this);
c.run();
d.one(".logo").addClass("active");
this.activeEl=d
},renderSocialAccount:function(d,f){var c=b.DB.DIV("chooser-container");
var g=this.config.networks;
for(var e=0;
e<g.length;
e++){c.append(b.DB.DIV("chooser-button "+g[e]))
}return b.DB.DIV("social-account "+(f?"hidden":""),b.DB.DIV("logo "+(d.type?d.type:""),b.DB.DIV("chooser",c)),b.DB.DIV("type",{html:d.type}),b.DB.INPUT("username",{value:d.username,placeholder:"Enter Username",maxlength:30,spellcheck:false,autocomplete:false}),b.DB.DIV("buttons",b.DB.DIV("plus"),b.DB.DIV("minus")))
},render:function(c){this.accountContainerEl.set("innerHTML","");
if(c){for(var d=0;
d<c.length;
d++){this.accountContainerEl.append(this.renderSocialAccount(c[d]))
}}},getValue:function(){var c=[];
this.accountContainerEl.all(".social-account").each(function(d){var e={type:d.one(".type").get("text"),username:d.one("input").get("value").replace(" ","")};
if(e.username.length>0){c.push(e)
}},this);
return c
},setValue:function(c){this.render(c)
},getCount:function(){var c=0;
this.accountContainerEl.all(".social-account").each(function(d){c++
},this);
return c
}})};
b.Squarespace.DialogFieldGenerators["date-picker"]=Class.extend(b.Squarespace.DialogField,{_name:"date-picker",_defaultOptions:{"yui3-calendar":{showPrevMonth:true,showNextMonth:true,width:"100%",height:"100%",selectionMode:"single"}},initialize:function(d,c,e){this._super(d,c,e);
this.config=b.merge(this._defaultOptions,d);
this.calendarOptions=b.merge(this._defaultOptions["yui3-calendar"]);
if(d["yui3-calendar"]){this.calendarOptions=b.merge(this.calendarOptions,d["yui3-calendar"])
}if(c[this.config.name]){this.calendarOptions.date=new Date(c[this.config.name])
}if(this.config.width){this.calendarOptions.width=this.config.width
}if(this.config.height){this.calendarOptions.height=this.config.height
}this.calendar=new b.Calendar(this.calendarOptions);
this.html=b.DB.DIV("field-wrapper clear"+(this.config.className?this.config.className:"")+" date-picker");
this.calendarWrapper=b.DB.DIV("calendar-wrapper");
this.html.append(this.calendarWrapper);
this._subscribe(this.calendar,"selectionChange",this.onSelectionChange);
this.value=c[this.config.name]||null;
this.calendar.selectDates([new Date(this.value)]);
this.render()
},render:function(){this.calendar.render(this.calendarWrapper)
},focus:function(){this.calendar.focus()
},enable:function(){this.html.removeClass("disabled");
this.calendar.enable()
},disable:function(){this.html.addClass("disabled");
this.calendar.disable()
},getValue:function(){return this.value?this.value.valueOf():null
},onSelectionChange:function(c){this.value=c.newSelection[0]
},setValue:function(c){this._super(c);
if(c){this.calendar.selectDates([c])
}},_destroy:function(){this.calendar.destroy()
}});
b.Squarespace.DialogFieldGenerators["datetime-picker"]=Class.extend(b.Squarespace.DialogFieldGenerators["date-picker"],{_name:"datetime-picker",initialize:function(d,c,e){this._super(b.merge({dateFormat:"%A, %B %d %Y at %I:%M%p"},d),c,e);
if(c[d.name]){this.setValue(new Date(c[d.name]))
}else{if(!this.config.clearable){this.setValue(new Date())
}else{this.setValue(null)
}}},render:function(){this._renderPicker();
this._renderLabel()
},_renderPicker:function(){this.html=b.DB.DIV("field-wrapper clear "+(this.config.className?this.config.className:"")+" datetime-picker-field");
this.calendarWrapper=b.DB.DIV("calendar-wrapper");
var c=this.value;
this.hourControl=b.DB.INPUT("time-control hour",{maxlength:2,style:"text-align: right;"});
this.minuteControl=b.DB.INPUT("time-control minute",{maxlength:2,style:"text-align: left;"});
this.ampmControl=b.DB.INPUT("time-control ampm",{maxlength:2,style:"text-align: left; width: 36px;"});
this.timeWrapper=b.DB.DIV("time-wrapper",this.hourControl,b.DB.DIV("time-control",{html:":",style:"width: 5px; border: 0px"}),this.minuteControl,this.ampmControl);
if(c){this.updateFlyout(c)
}this.calendar.render(this.calendarWrapper);
this.dateFlyoutEvents=[b.on("click",this.onCalendarClick,this.dateFlyout,this),b.on("keyup",this.onTimeFieldKeyUp,this.hourControl,this),b.on("keyup",this.onTimeFieldKeyUp,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.hourControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.ampmControl,this),b.on("blur",this.onTimeFieldBlur,this.hourControl,this),b.on("blur",this.onTimeFieldBlur,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.hourControl,this),b.on("click",this.onTimeFieldClick,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.ampmControl,this),b.on("resize",this.onResize,b.one(window),this)];
this.errorFlyoutAnchor=this.html
},updateFlyout:function(c){this.hourControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%l"})));
this.minuteControl.set("value",b.Squarespace.Utils.dateFormat(c,{format:"%M"}));
this.ampmControl.set("value",b.Squarespace.Utils.dateFormat(c,{format:"%p"}));
this.calendar.set("date",c)
},_renderLabel:function(){this.label=b.DB.DIV("field-workflow-description",b.DB.SPAN("datetime-label",this.config.title+"&nbsp;"),b.DB.SPAN("date","Feb 20 2012"));
this.html.append(b.DB.DIV("date-picker-field",this.label));
this.panel.bodyEvents.push(b.on("click",this.onDatetimeChangeRequest,this.label.one(".date"),this));
if(this.config.clearable){var c=b.DB.DIV("remove-date",{html:"&nbsp;"});
this.label.append(c);
c.on("click",this.onClearDate,this)
}},onClearDate:function(){this.setValue(null)
},setValue:function(c){this._super(c);
this.updateDisplay()
},onDatetimeChangeRequest:function(c){if(this.flyout){return
}if(c.target.hasClass("date")){this.html.addClass("date-picker-active");
this.openFlyout();
this.calendarWrapper.one(".yui3-calendar").setStyle("width","auto");
this.refreshTimeField();
return
}this.closeFlyout();
return
},onResize:function(){if(this.flyout){this.alignFlyout()
}},alignFlyout:function(){var d=b.one(document.body).get("docScrollY");
this.dateFlyoutWidth=this.flyout.get("offsetWidth");
var c=this.label.getX()-(this.dateFlyoutWidth-this.label.get("offsetWidth"))/2-15;
var e=this.label.getY()+this.label.get("offsetHeight")+5;
this.flyout.setXY([c,e])
},openFlyout:function(){var e=this.label.getX();
var d=400;
this.flyout=b.DB.DIV("workflow-flyout tight",b.DB.DIV("workflow-flyout-content",b.DB.DIV("flyout-notch-select-top"),b.DB.DIV("workflow-flyout-options",{style:"position:relative; top:-1px;"},b.DB.DIV("flyout-title","Select a Date & Time"),b.DB.DIV("flyout-calendar",this.calendarWrapper,this.timeWrapper))));
b.one(document.body).append(this.flyout);
this.flyout.one(".flyout-notch-select-top").setStyles({marginLeft:((d/2)-8)});
this.dateFlyoutHeight=this.flyout.get("offsetHeight");
this.dateFlyoutWidth=this.flyout.get("offsetWidth");
this.flyout.setStyles({width:(d)+"px",height:this.dateFlyoutHeight+"px",opacity:1});
this.dateFlyoutContents=this.flyout.one(".workflow-flyout-content");
this.dateFlyoutContents.setStyles({marginTop:-1*this.dateFlyoutHeight,opacity:0});
this.alignFlyout();
var c=this._anim({node:this.dateFlyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong});
c.run();
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout, .calendar-wrapper",field:this})
},refreshTimeField:function(){if(!this.value){this.timeWrapper.addClass("disabled");
this.hourControl.set("value","10");
this.minuteControl.set("value","00");
this.ampmControl.set("value","AM")
}else{this.timeWrapper.removeClass("disabled");
this.hourControl.set("value",b.Squarespace.Utils.dateFormat(this.value,{format:"%I"}));
this.minuteControl.set("value",b.Squarespace.Utils.dateFormat(this.value,{format:"%M"}));
this.ampmControl.set("value",b.Squarespace.Utils.dateFormat(this.value,{format:"%p"}))
}},updateDisplay:function(){if(this.label){if(!this.value){this.label.one(".date").setContent("Not Set");
this.html.addClass("no-date")
}else{this.label.one(".date").setContent(b.Squarespace.Utils.dateFormat(this.value,{format:this.config.dateFormat}));
this.html.removeClass("no-date")
}}else{console.log("[datetime-picker] tried to update display but no label el was found")
}},closeFlyout:function(){if(!this.flyout){return
}this.html.removeClass("date-picker-active");
var c=this.flyout.get("offsetHeight");
animation=this._anim({node:this.dateFlyoutContents,to:{marginTop:-1*c,opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
animation.on("end",function(){this.flyout.remove();
this.flyout=null;
this.dateFlyoutContents=null
},this);
animation.run();
this.panel.clearActiveFlyout()
},onTimeFieldKeyUp:function(d){var c;
if(d.target.hasClass("hour")){c=parseInt(this.hourControl.get("value"),10);
if(c>12||c<1){this.hourControl.set("value",this.prevVal)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>60||c<0){this.minuteControl.set("value",this.prevVal)
}}}this._updateTime()
},onTimeFieldClick:function(c){if(c.target.hasClass("hour")){this.hourControl.select()
}else{if(c.target.hasClass("minute")){this.minuteControl.select()
}else{if(c.target.hasClass("ampm")){this.ampmControl.select()
}}}},onTimeFieldBlur:function(d){var c;
if(d.target.hasClass("hour")){c=this.hourControl.get("value");
if(c.indexOf("0")===0){this.hourControl.set("value",parseInt(c,10))
}c=parseInt(c,10);
if(c>12||c<1){this.hourControl.set("value",12)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>=0&&c<=9){this.minuteControl.set("value","0"+c)
}c=parseInt(c,10);
if(c>60||c<0){this.minuteControl.set("value",0)
}}}this._updateTime()
},onTimeFieldKeyDown:function(c){if(c.keyCode==65){this.ampmControl.set("value","AM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==80){this.ampmControl.set("value","PM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==13){this.closeFlyout();
return
}}}if(c.target.hasClass("hour")){if(c.keyCode==186){this.minuteControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.hourControl.get("value")
}else{if(c.target.hasClass("minute")){if(c.keyCode==32){this.ampmControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.minuteControl.get("value")
}else{if(c.target.hasClass("ampm")){if(c.keyCode!=9){c.halt()
}}}}},_updateTime:function(){var f=parseInt(this.hourControl.get("value"),10);
var c=parseInt(this.minuteControl.get("value"),10);
var e=this.ampmControl.get("value");
if(f>12||f<=0){f=12
}if(c>60||c<0){c=0
}if(f==12&&e=="AM"){f=0
}else{if(f!=12&&e=="PM"){f+=12
}}var d=new Date(this.value.getTime()).set({hour:f,minute:c});
d.setMinutes(d.getMinutes()-d.getTimezoneOffset()-parseInt(Static.SQUARESPACE_CONTEXT.website.timeZoneOffset,10)/60000);
this.setValue(d);
this.updateDisplay()
},onSelectionChange:function(c){if(!this.label){return
}var f=c.newSelection[0];
if(this.value){f.setHours(this.value.getHours());
f.setMinutes(this.value.getMinutes())
}this.value=f;
this.updateDisplay()
}});
b.Squarespace.DialogFieldGenerators["textbox-datetime-picker"]=Class.extend(b.Squarespace.DialogFieldGenerators["datetime-picker"],{initialize:function(d,c,e){this._super(d,c,e);
b.Squarespace.EscManager.addTarget(this)
},getValue:function(){return this.value!=null?this.value.valueOf():null
},render:function(){this._renderPicker();
this.label=b.Node.create('<input type = "text" class = "field-input date" spellcheck="false"/>');
this.html.append(this.label);
this.panel.bodyEvents.push(b.on("click",this.onDatetimeChangeRequest,this.label,this));
this.label.on("keyup",function(c){if(a(c.keyCode)){this.lastChangeTime=(new Date()).valueOf();
b.later(500,this,this.onKeyup,[this.lastChangeTime])
}},this);
this.label.on("blur",this.updateDisplay,this)
},updateDisplay:function(){if(this.value){var c=b.Squarespace.Utils.dateFormat(this.value,{format:"%D @ %I:%M %p"});
this.label.set("value",c)
}else{this.label.set("value","")
}},closeFlyout:function(){this._super();
this.updateDisplay()
},onKeyup:function(d){var c=new Date(this.label.get("value"));
if(b.Lang.isNumber(c.valueOf())){this.value=c;
this.calendar.deselectDates();
this.updateFlyout(c);
this.calendar.selectDates([c])
}},onSelectionChange:function(d){var c=d.newSelection[0];
var f=this.value?new Date(this.value):new Date();
if(c){c.setHours(f.getHours());
c.setMinutes(f.getMinutes());
this.value=c;
if(this.label){if(this.label.get("value")===""||c.valueOf()!==f.valueOf()){this.updateDisplay()
}}}},_destroy:function(){this._super();
b.Squarespace.EscManager.removeTarget(this)
},close:function(){this.closeFlyout()
}});
b.Squarespace.DialogFieldGenerators.toggle=Class.extend(b.Squarespace.DialogField,{initialize:function(d,c,e){this._super(d,c,e);
this.value=((c[this.config.name]===undefined?this.config.defaultValue:c[this.config.name])?true:false);
this._toggle=new b.Squarespace.Widgets.ToggleButton({active:this.value}).plug(b.Squarespace.ToggleDrag);
this._bindToggleChangeEvent();
this.html=b.DB.DIV("field-wrapper clear toggle");
if(this.config.padding){this.html.setStyle("padding-top",this.config.padding[0]);
this.html.setStyle("padding-bottom",this.config.padding[1])
}this._toggle.render(this.html)
},_bindToggleChangeEvent:function(){this._toggleChangeEvent=this._toggle.after("activeChange",function(c){this.setValue(c.newVal);
this.dialog.fire("datachange",{field:this})
},this)
},setValue:function(c){this._toggleChangeEvent.detach();
this._toggle.set("active",c);
this._bindToggleChangeEvent();
if(this.value!==c){this._super(c)
}},getValue:function(){return this._toggle.get("active")
},updateDisplay:function(){this._toggle.set("active",this.value)
}});
b.Squarespace.DialogFieldGenerators.datatable=Class.extend(b.Squarespace.DialogField,{initialize:function(d,c,e){this._super(d,c,e);
var g=["sku","name","price"];
this.data=[{id:"ga-3475",sku:"14612",name:"gadget",price:"6.99",cost:"$5.99"},{id:"sp-9980",sku:"125601",name:"sprocket",price:"3.75",cost:"$3.25"},{id:"wi-0650",sku:"55019",name:"widget",price:"4.25",cost:"$3.75"}];
this.html=b.DB.DIV("field-wrapper clear datatable");
var f=new b.DataTable.Base({columnset:g,recordset:this.data}).render(this.html)
},getValue:function(){return this.data
}});
b.Squarespace.DialogFieldGenerators.picker=Class.extend(b.Squarespace.DialogField,{_name:"Picker",initialize:function(d,c,e){this._super(d,c,e);
this.control=b.DB.DIV("field-input-wrapper select",{html:"test"});
this.html=b.DB.DIV("field-wrapper picker clear");
this.valueToNode={};
this.value=c[this.config.name]
},render:function(){var c=b.DB.DIV("options-wrapper");
if(!this.config.groups){this.renderGroup(c,this.config.data)
}c.delegate("click",this.onClick,".option",this);
this.html.append(c);
if(this.value){this.setValue(this.value)
}},onClick:function(d){var c=d.target.ancestor(".option",true).getData("value");
this.setValue(c)
},setValue:function(d){var c=this.getValue();
this._super(d);
this.panel.fire("datachange",this);
if(this.isValidValue(d)){if(c){this.getNode(c).removeClass("active")
}this.getNode(d).addClass("active")
}this.dialog.edited=true
},renderGroup:function(c,d){b.Array.each(d,function(f){var e=b.DB.DIV("option",{data:{value:f.value}},b.DB.DIV("title",{html:f.title}),f.description?b.DB.DIV("description",{html:f.description}):null);
this.registerNode(f.value,e);
c.append(e)
},this);
return c
},show:function(){this.render()
},registerNode:function(d,c){this.valueToNode[d]=c
},getNode:function(c){return this.valueToNode[c]
},isValidValue:function(d){if(!this.config.groups){for(var c=0;
c<this.config.data.length;
c++){if(this.config.data[c].value==d){return true
}}}return false
}});
b.Squarespace.DialogFieldGenerators["module-picker"]=Class.extend(b.Squarespace.DialogField,{_name:"ModulePicker",initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.control=b.DB.DIV("field-input-wrapper select",{html:"Anthony Casalena"});
if(!this.config.mode){this.config.mode="pages"
}this.html=b.DB.DIV("field-wrapper clear navigation-field-mode-"+this.config.mode);
this.value=c[this.config.name];
Static.SQUARESPACE_CONTEXT.navigationData=null;
this.html.set("innerHTML","Loading...");
this.events=[];
this.library=b.Squarespace.Library
},showEmptyMessage:function(){this.html.appendChild(b.DB.DIV("empty-message",{html:this.config.emptyMessage||"There are no collections available."}))
},render:function(){this.destroy();
this.html.set("innerHTML","");
this.events=[this.html.on("click",this.onClick,this)];
if(this.config.groups){var c=this.config.groups;
for(var e in c){if(!c.hasOwnProperty(e)){continue
}var f=c[e];
this._renderGroup(f.collections,f.title)
}}this.setValue(this.value);
var d=this.html.ancestor(".standard-dialog-wrapper").one(".edit-pages");
if(d){this.events.push(d.on("click",this.onEditPages,this))
}},_renderGroup:function(g,j){var e=b.DB.DIV("navigation-wrapper",{data:{actualHeight:null}},b.DB.DIV("navigation-title clear",b.DB.DIV("text",{html:j||""}),b.DB.DIV("active-count")));
var c=0;
for(var d=0;
d<g.length;
d++){var k=d;
var f=b.Squarespace.Library.getCollection(g[k].getId());
if(!f||!f.getEnabled()){continue
}var h=this._createPageElement(f);
++c;
e.append(h)
}if(c){this.html.append(e)
}},_createPageElement:function(e){var d=b.DB.DIV("page clear module-"+e.getTypeName()+" "+e.getClass(),{data:{item:e}},b.DB.DIV("title",{html:b.Escape.html(e.getNavigationTitle())}),b.DB.DIV("description",{html:e.getTypeLabel()}));
if(this.config.deleteCollections){var c=b.DB.A("delete");
c.on("click",this.onDeleteClick,e);
d.append(c)
}return d
},onDeleteClick:function(c){c.halt();
new b.Squarespace.ConfirmationDialog().show("Remove "+this.getName(),"Are you sure you wish to remove this "+this.getName().toLowerCase()+"?  <strong>All contained data will be deleted.</strong>",function(){c.target.ancestor(".page").transition({opacity:0},function(){this.remove()
});
this.remove()
},this)
},show:function(){this.render()
},destroy:function(){for(var c=0;
c<this.events.length;
++c){this.events[c].detach()
}},onEditPages:function(c){this.panel.close();
b.Squarespace.Management.manageSite("content",(Static.SQUARESPACE_CONTEXT.collectionId?Static.SQUARESPACE_CONTEXT.collectionId:null))
},onClick:function(h){var f=h.target.ancestor(".page",true);
var c=h.target.ancestor(".navigation-group-wrapper");
var g=h.target.ancestor(".navigation-wrapper");
var i=h.target.ancestor(".navigation-title",true);
if(this.config.mode=="page"){this.html.all(".page").each(function(e){e.removeClass("active")
},this);
if(f){f.addClass("active")
}if(f){this.setValue(f.data().item.getId())
}}else{if(f){if(f.hasClass("active")){f.removeClass("active")
}else{f.addClass("active")
}var d=g.all(".page.active").size();
f.ancestor(".navigation-wrapper").one(".active-count").set("innerHTML",(d?d+" Selected":""))
}}this.panel.fire("datachange",this)
},getValue:function(){if(this.config.mode=="pages"){this.value=[];
this.html.all(".page.active").each(function(d){this.value.push("page-"+d.data().item.getId())
},this);
return this.value
}else{var c=null;
this.html.all(".page.active").each(function(d){c=d.data().item.getId()
},this);
return c||this.value
}},setValue:function(c){var f={};
if(c){if(typeof(c)=="object"){for(var e=0;
e<c.length;
e++){var d=c[e];
if(d.indexOf("page-")===0){f[d.substring(5)]=true
}else{f[d]=true
}}}else{f[c]=true
}}this.html.all(".page").each(function(g){if(f[g.data().item.getId()]){g.addClass("active")
}else{g.removeClass("active")
}},this);
if(this.config.mode==="pages"){this.html.all(".navigation-wrapper").each(function(h){var g=h.all(".page.active").size();
h.one(".active-count").set("innerHTML",(g?g+" Selected":""));
if(g===0){h.addClass("collapsed");
h.data().actualHeight=h.get("offsetHeight");
h.setStyle("height",h.one(".navigation-title").get("offsetHeight"))
}})
}this.value=c
},createGroupNode:function(c){return b.DB.DIV("site-page clear",b.DB.DIV("site-page-title",{html:page.title}),b.DB.DIV("site-page-type",{html:this.getPageTypeDisplayName(page.type)}),b.DB.DIV("site-page-url",{html:(page.url?page.url:"-")}),b.DB.DIV("site-page-controls",{html:"configure"}))
}});
b.Squarespace.DialogFieldGenerators.email=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(d,c,e){this._super(d,c,e);
this._emailRegex=new RegExp(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)
},isValid:function(){var g=this.control.get("value"),d=[this._validateExistence,this._validateFormat],c=true;
for(var f=0;
f<d.length;
f++){var e=d[f];
c=c&&e.call(this,g);
if(!c){break
}}return c
},getErrors:function(){var d=this.control.get("value");
var c=[this._validateFormat,this._validateExistence].map(function(e){return e.call(this,d)
},this).filter(b.Lang.isString);
return c
},_validateExistence:function(f){var e=!!this.config.required,c=f!=="",d=true;
if(e&&!c){d=false
}if(!d){return"Required field"
}return null
},_validateFormat:function(e){var d=e.match(this._emailRegex)||[],c=!!d.length;
if(!c){return"The email address you entered is invalid."
}return null
}});
b.Squarespace.DialogFieldGenerators["structured-input"]=Class.extend(b.Squarespace.DialogField,{initialize:function(d,c,e){this._super(d,c,e);
this.value=c[d.name];
this.dialog=e;
this._variables=d.variables;
this.render()
},render:function(){this.html=b.DB.DIV("field-wrapper clear structured-input-field");
this.control=b.DB.DIV("structured-input-wrapper",b.DB.DIV("structured-input"));
if(this.config.width){this.control.setStyle("width",this.config.width)
}this.html.append(this.control)
},destroy:function(){if(this._structInput){this._structInput.destroy()
}},show:function(){this._structInput=new b.Squarespace.StructuredInput({target:this.control.one(".structured-input"),value:this.value,variables:this._variables,tabIndex:this.dialog.getNextTabIndex()});
var c=this.html.one("input");
this._subscribe(this._structInput,"valueChange",function(){this.dialog.fire("datachange")
},this)
},getValue:function(){return this._structInput.get("value")
}});
b.Squarespace.DialogFieldGenerators.numeric=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(e,c,d){this._super(e,c,d);
if(c[e.name]===undefined){if(this.config.defaultValue!==undefined){this.setValue(Number(this.config.defaultValue))
}}},didDataChange:function(){return this.initialData[this.getName()]!=Number(this.getValue())
},getErrors:function(){var c=this._super();
if(this.config.required&&(this.getValue().trim()===""||!b.Lang.isNumber(Number(this.getValue())))){return["This must be a numeric value."]
}else{return c
}}});
b.Squarespace.DialogFieldGenerators.percentage=Class.extend(b.Squarespace.DialogFieldGenerators.numeric,{getErrors:function(){var d=this._super();
var c=Number(this.getValue());
if(c>100||c<0){return["This must be between 0% and 100%."]
}else{return d
}},getValue:function(){return this.control.get("value").trim()
}});
b.Squarespace.DialogFieldGenerators.url=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(e,c,d){this._super(e,c,d);
this.panel=d;
var f=b.DB.DIV("internal-linker",b.DB.DIV("icon"))
}});
b.Squarespace.DialogFieldGenerators.money=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(e,c,d){this._super(e,c,d);
if(c[e.name]!==undefined){this.setValue(c[e.name])
}else{if(this.config.defaultValue){this.setValue(Number(this.config.defaultValue))
}else{this.setValue(0)
}}this.control.set("value","$"+b.Squarespace.Utils.moneyFormat(this.getValue()))
},onKeyDown:function(f){this._super(f);
if(f.keyCode==9){return
}if(f.keyCode==8||f.keyCode==46){var c=String(this.getValue());
var d=c.substr(0,((c.length-1)>=0)?c.length-1:0);
if(d.length===0){this.setValue(0)
}else{this.setValue(Number(d))
}}var g;
if(f.keyCode>=96&&f.keyCode<=105){g=String.fromCharCode(f.keyCode-48)
}else{g=String.fromCharCode(f.keyCode)
}if(isFinite(Number(g))){this.setValue(this.getValue()+g)
}this.control.set("value","$"+b.Squarespace.Utils.moneyFormat(this.getValue()));
f.stopPropagation();
f.preventDefault()
},setValue:function(c){this.underlyingValue=Number(c)
},getValue:function(){return this.underlyingValue
}})
},"1.0",{requires:["node","datatype-date","node-focusmanager","anim","dd","attribute","slider","datatable","json","widget","node-event-simulate","calendar","squarespace-gizmo","squarespace-dombuilder","squarespace-dialog-css","squarespace-debugger","squarespace-toggle","squarespace-node-flyout","squarespace-structured-input","squarespace-mailcheck",]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-drag-selection-status-history",function(b){var a=b.namespace("Squarespace").DragSelectionStatusHistory=function a(c){this._savedStatuses={};
this._previousStatuses=[];
this.after(this.get("id")+"|enabledChange",function(d){this._previousStatuses.push(d.newVal)
},this)
};
a.NAME="dragSelectionStatusHistory";
a.prototype={_findIdForObj:function(c){var d;
b.Object.some(this._savedStatuses,function(e,f){if(c===e.source){d=f;
return true
}else{return false
}},this);
return d
},saveStatus:function(e){var d=this._findIdForObj(e);
if(d){this._savedStatuses[d].status=this.get("enabled")
}else{var c=e.name||e.NAME||e._name;
var f=b.guid(c?c+"_":"");
this._savedStatuses[f]={status:this.get("enabled"),source:e}
}},restoreStatus:function(d){var e=this._findIdForObj(d);
if(!e){console.error(this.name+": There is no state saved for that object")
}else{var c=this._savedStatuses[e];
this.set("enabled",c.status,{restore:true});
delete this._savedStatuses[e]
}}}
},"1.0",{requires:["base"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-drag-selection-selector-blacklist",function(b){var a=b.namespace("Squarespace").DragSelectionSelectorBlackList=b.Base.create("dragSelectionSelectorBlackList",b.Base,[],{_getInvalidRegions:function(c){return c.concat(this.get("selectorBlacklist"))
}},{ATTRS:{invalidRegions:{value:[],getter:"_getInvalidRegions"},selectorBlacklist:{valueFn:function(){var c=[".dialog-screen-overlay",".mode-visual",".mode-source",".content-title .add-content",".config-panel-wrapper","input","object",".dropdown select"];
if(b.Squarespace.STANDARD_CONTROL_CLASSES){c=c.concat(b.Squarespace.STANDARD_CONTROL_CLASSES)
}c=b.Array.dedupe(c);
c.remove(".standard-dialog-wrapper");
return c
}}}})
},"1.0",{requires:["base-build"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-drag-selection",function(b){var a=b.Base.create("dragSelection",b.Base,[b.Squarespace.DragSelectionSelectorBlackList,b.Squarespace.DragSelectionStatusHistory],{initializer:function(c){this._selectionNode=b.Node.create('<div class="squarespace-selection"></div>');
this._dragClassName="drag-selection-dragging";
this.publish("selection-started",{preventable:true,defaultFn:this._initSelection,context:this});
this.on(this.get("id")+"|activationRegionChange",this._bindUI);
b.on("domready",function(){this._bindUI()
},this)
},destructor:function(){this._selectionNode.remove(true);
b.detachAll(this._yuid+"|*")
},_bindUI:function(){if(this._activationSubscription){this._activationSubscription.detach()
}var c=this.get("activationRegion");
var d=b.instanceOf(c,b.Node)?c:b.one(window);
this._activationSubscription=d.on(this._yuid+"|mousedown",this._onMouseDown,this)
},_onMouseDown:function(c){if(!this.get("enabled")){return
}this.fire("selection-started",{originalMousedown:c})
},_initSelection:function(d){var c=d.originalMousedown;
if(this.get("dragging")||c.button!==1){return
}this._origin={x:c.pageX,y:c.pageY};
if(!this._pointInActivationRegion(this._origin.x,this._origin.y)){return
}if(!this._mouseDownInValidRegion(c)){return
}if(this._hideAnimation){this._hideAnimation.stop(true)
}this._selectionNode.setStyles({top:this._origin.y+1,left:this._origin.x+1,right:document.body.offsetWidth-this._origin.x,bottom:window.innerHeight-this._origin.y});
b.one("body").addClass(this._dragClassName).appendChild(this._selectionNode);
b.one(window).once(this._yuid+"|mouseup",this._endSelection,this);
this._mouseMoveSubscription=b.one(window).on(this._yuid+"|mousemove",this._dragSelection,this)
},_dragSelection:function(e){if(!this.get("enabled")){return
}if(!this._origin){return
}e.halt();
var g=this.get("boundingRegion"),d=this._origin,j={x:e.pageX,y:e.pageY},i=j.x>d.x?d.x:j.x,f=j.x>d.x?j.x:d.x,h=j.y>d.y?d.y:j.y,c=j.y>d.y?j.y:d.y;
if(g){if(g.top){h=h<g.top?g.top:h
}if(g.bottom){c=c>g.bottom?g.bottom:c
}if(g.left){i=i<g.left?g.left:i
}if(g.right){f=f>g.right?g.right:f
}}this._selectionNode.setStyles({top:h,left:i,right:document.body.offsetWidth-f,bottom:window.innerHeight-c});
this.fire("selection-dragged",{region:this._selectionNode.get("region"),originalMousemove:e})
},_endSelection:function(c){if(c){c.halt()
}if(this._mouseMoveSubscription){this._mouseMoveSubscription.detach();
delete this._mouseMoveSubscription
}if(this._clickBlockSubscription){this._clickBlockSubscription.detach();
delete this._clickBlockSubscription
}if(this._origin){delete this._origin
}b.one("body").removeClass(this._dragClassName);
this.fire("selection-complete",{region:this._selectionNode.get("region"),originalMouseup:c});
if(this._selectionNode.ancestor("body")){this._hideAnimation=new b.Anim({node:this._selectionNode,to:{opacity:0},duration:0.3,easing:b.Easing.easeOutStrong});
this._hideAnimation.once(this._yuid+"|end",function(){this._selectionNode.remove();
this._selectionNode.setStyle("opacity",1);
delete this._hideAnimation
},this);
this._hideAnimation.run()
}},_mouseDownInValidRegion:function(d){var c=this.get("invalidRegions");
for(var e=0;
e<c.length;
e++){var f=c[e];
if(!f){continue
}if(typeof(f)==="string"){if(d.target.ancestor(f,true)){return false
}}else{f=this._getRegion(f);
if(this._pointInRegion(this._origin.x,this._origin.y,f)){return false
}}}return true
},_pointInActivationRegion:function(c,e){var d=this.get("activationRegion");
if(!d){return true
}return this._pointInRegion(c,e,d)
},_pointInRegion:function(c,e,d){if(d.top&&d.right&&d.bottom&&d.left){return(c>=d.left&&c<=d.right)&&(e>=d.top&&e<=d.bottom)
}if(d.left&&c<d.left){return false
}if(d.right&&c>d.right){return false
}if(d.top&&e<d.top){return false
}if(d.bottom&&e>d.bottom){return false
}return true
},_getRegion:function(c){if(b.instanceOf(c,b.Node)){return c.get("region")
}return c
},_getDragging:function(){var c=b.one("body");
if(!!c){return c.hasClass(this._dragClassName)
}return false
},_setEnabled:function(c){if(this._activationSubscription){this._activationSubscription.detach()
}if(!c){if(this.get("dragging")){this._endSelection()
}}else{this._bindUI()
}b.one("body").addClass(c?"drag-selection-enabled":"drag-selection-disabled").removeClass(!c?"drag-selection-enabled":"drag-selection-disabled");
return c
},enable:function(){this.set("enabled",true)
},disable:function(){this.set("enabled",false)
}},{ATTRS:{boundingRegion:{value:null,getter:"_getRegion"},activationRegion:{value:null,getter:"_getRegion"},enabled:{value:true,setter:"_setEnabled"},dragging:{value:false,valueFn:"_getDragging",getter:"_getDragging",readOnly:true},invalidRegions:{value:[]}}});
b.Squarespace.DragSelection=new a({enabled:false})
},"1.0",{requires:["base","base-build","node","anim","squarespace-drag-selection-status-history","squarespace-drag-selection-selector-blacklist"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-dialog",function(a){a.namespace("Squarespace");
a.Squarespace.OPEN_DIALOGS=[];
a.Squarespace.DialogStates={CLOSED:1,EDITING:2,LOADING:3,CLOSING:4,SAVING:5,MOVING:6};
a.Squarespace.EditingDialog=Class.extend(a.Squarespace.ZombieGizmo,{_name:"EditingDialog",_events:{show:{},shown:{},aftershowanim:{},"align-to-anchor":{},"aligned-to-anchor":{},loading:{},"cancel-loading":{},"loading-ready":{},ready:{},drag:{},hide:{},hidden:{},close:{},closed:{},canceled:{},"overlay-click":{},"show-save-overlay":{},"save-overlay-shown":{},"hide-save-overlay":{},"save-overlay-hidden":{},"render-anchor":{},datachange:{},datachanged:{},"send-requested":{},"remove-requested":{},"data-saved":{},"auto-save":{},"allow-editing":{},"editing-allowed":{},"show-errors":{},"local-errors":{}},initialize:function(b){this._super(b);
this.setParams(b);
this.state=a.Squarespace.DialogStates.CLOSED;
this.bodyEvents=[];
this.buttonEvents=[];
this.globalEvents=[];
this.childDialogs=[];
this.verticalFields=[];
this.timers=[];
this.fields={};
this.sections={};
this._noNameFields=[];
this.edited=false;
this.editedSinceLastSave=false;
this.NOTCH_WIDTH=20;
this.BUTTONS_BASE_IDX=100;
this.NOTCH_HEIGHT=11;
this.lastTabIndex=1;
this.on("datachange",this.onDataChange,this);
this._debug=new a.Squarespace.Debugger({name:"EditingDialog",output:false})
},defaultOpts:{tabs:[],initialData:{},buttons:[],style:"standard",colorScheme:"light",buttonAlign:"right",position:"center",verticalHeight:"fixed",flyoutPointerDirection:"left",closingText:"Canceled...",savingText:"Saving...",top:60,closeOthers:true,disableTips:true,closeable:true,autoFocus:true,discardChangesConfirmation:true,overlay:false,validateActiveTabOnly:false,edgeMargin:20,initialDataByReference:false},getName:function(){return this.params.name
},getInitialData:function(){return this.params.initialData
},setParams:function(b){if(!b){return
}if(b.embedWithinEl){b.closeable=false;
b.closeOthers=false;
if(!b.style){b.style="transparent"
}if(!b.colorScheme){b.colorScheme="dark"
}if(!b.buttonAlign){b.buttonAlign="left"
}if(!b.top){b.top=null
}}this.params=a.merge(this.defaultOpts,b);
if(this.params.primaryTabs){this.params.tabs=this.params.tabs.concat(this.params.primaryTabs);
delete this.params.primaryTabs
}if(this.params.secondaryTabs){this.params.tabs=this.params.tabs.concat(this.params.secondaryTabs);
delete this.params.secondaryTabs
}if((!this.params.tabs||this.params.tabs.length==0)&&this.params.fields){this.params.tabs=[{fields:this.params.fields}]
}if(!this.params.tabs[0].tabTitle){this.params.tabs[0].tabTitle="Item"
}if(!this.params.tabs[0].name){this.params.tabs[0].name="item"
}if(this.params.style=="transparent"){this.params.disableSaveOverlay=true
}if(!b.discardChangesConfirmation&&this.params.buttons.length===0){this.params.discardChangesConfirmation=false
}this.definitionChanged=true
},show:function(e){this.fire("show");
this._debug.log("Showing",["showParams",e],["this.params",this.params]);
if(this.moving){this.state=a.Squarespace.DialogStates.EDITING;
if(this.a){this.a.stop()
}this.fire("cancel-loading")
}if(this.destroyTimer||(this.state===a.Squarespace.DialogStates.LOADING||this.state===a.Squarespace.DialogStates.CLOSING)){return
}if(a.Squarespace.ToolTipManager&&this.params.disableTips){a.Squarespace.ToolTipManager.disableTooltips()
}if(this.anchorEl){this.anchorEl.removeClass("targeted")
}if(e){if(e.data){this.data=e.data
}if(e.anchor){this.anchorEl=e.anchor
}if(e.anchorData){this.anchorData=e.anchorData
}if(e.top){this.params.top=e.top
}if(e.flyoutPointerDirection){this.params.flyoutPointerDirection=e.flyoutPointerDirection
}}if(this.params.parentDialog){this.params.parentDialog.addChildDialog(this)
}if(this.state!==a.Squarespace.DialogStates.CLOSED){if(this.anchorEl){this.anchorEl.addClass("targeted")
}else{return
}this.state=a.Squarespace.DialogStates.LOADING;
this.moving=true;
this.updateTitle();
this.fire("loading");
this._updatePosition(false);
if(this.position){this.a=this._anim({node:this.el,to:{left:this.position.getX()+"px",top:this.position.getY()+"px"},duration:0.25,easing:a.Easing.easeOutStrong});
this.a.on("end",function(){this.fire("loading-ready");
this.dataReady()
},this);
this.a.run()
}return
}this.definitionChanged=false;
if(this.params.closeOthers){for(var f=0;
f<a.Squarespace.OPEN_DIALOGS.length;
++f){a.Squarespace.OPEN_DIALOGS[f].cancel()
}}a.Squarespace.OPEN_DIALOGS.push(this);
a.one(document.body).addClass("dialog-open");
this.fire("loading");
this.state=a.Squarespace.DialogStates.LOADING;
var n=a.one(document).get("winWidth");
var d=a.one(document).get("winHeight");
this.titleEl=a.DB.DIV("title-block loading");
this.titlePrimaryTabEl=a.DB.DIV("icon-holder");
this.titleTextEl=a.DB.DIV("text-holder");
this.titleEl.append(this.titlePrimaryTabEl);
this.titleEl.append(this.titleTextEl);
this.tabsEl=a.DB.DIV("configuration-container-tabs");
var b=a.DB.DIV("icon",{style:"background-image: url("+this.params.tabs[0].icon+");",data:{index:0}});
this.params.tabs[0].tabObj=b;
this.titlePrimaryTabEl.append(b);
this.timers.push(a.later(100,this,function(){if(this.params.closeable){a.Squarespace.EscManager.addTarget(this)
}this.globalEvents.push(a.on("resize",this.onResize,a.one(window),this))
}));
if(!a.Lang.isNumber(this.currentTabIndex)){this.currentTabIndex=0
}this.titleEl.append(this.tabsEl);
this.updateTitle();
this.bodyEl=a.DB.DIV("body-block");
if(this.params.buttons.length!==0){this.controlsEl=a.DB.DIV("controls-block")
}else{this.bodyEl.addClass("bottom")
}this.mainEl=a.DB.DIV("main-container",this.titleEl,this.bodyEl,this.controlsEl);
this.el=a.DB.DIV("standard-dialog-wrapper squarespace-managed-ui "+(this.params.style)+" "+(this.params.colorScheme)+" buttons-"+this.params.buttonAlign+(this.params.name?" dialog-"+a.Squarespace.Utils.slugify(this.params.name):""),this.mainEl);
this.bodyEvents.push(this.el.on("click",function(h){this.cancelChildDialogs();
this.fire("click",h)
},this));
if(!this.params.zIndex){a.Squarespace.DIALOG_ZINDEX_BASE+=10;
this.zIndex=a.Squarespace.DIALOG_ZINDEX_BASE
}else{this.zIndex=this.params.zIndex
}this.el.setStyle("zIndex",this.zIndex);
if(this.params.draggable){this.enableDragging()
}if(this.params.hidable){var r=a.DB.DIV("dialog-close");
this.el.prepend(r);
r.on("click",function(){this.fire("user-close");
this.close()
},this)
}if(this.params.headerButton){var s=a.DB.DIV("header-button");
var o=a.DB.INPUT({type:"button",value:this.params.headerButton.title,data:{type:this.params.headerButton.type}});
a.on("click",this.params.headerButton.onclick,o,this);
this.el.append(s.append(o))
}this.buttonHolder=a.DB.DIV("button-holder");
this.autosaveEl=a.DB.DIV("autosave-state");
if(this.controlsEl){this.controlsEl.append(this.autosaveEl);
this.controlsEl.append(this.buttonHolder)
}var m,j;
if(this.anchorEl){this.el.setStyle("position",this.params.forcePosition||"absolute");
this.anchorEl.addClass("targeted");
if(this.params.flyoutPointerDirection==="left"||this.params.flyoutPointerDirection==="right"){this.el.setStyle("width",(this.params.width+this.NOTCH_HEIGHT)+"px");
this.mainEl.setStyle("width",this.params.width+"px");
this.el.addClass("flyout");
a.one(document.body).append(this.el)
}else{if(this.params.flyoutPointerDirection==="hidden"){this.el.setStyle("width",this.params.width+"px");
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}else{if(this.params.flyoutPointerDirection==="top"){this.notchEl=a.DB.DIV("flyout-notch-top",{html:"&nbsp;"});
this.el.insertBefore(this.notchEl,this.mainEl);
var p=this.anchorEl.get("offsetWidth");
var g=this.anchorEl.get("offsetHeight");
m=this.anchorEl.getX();
j=this.anchorEl.getY()+g;
if(this.params.width>p){m-=(this.params.width-p)/2
}this.currentXY=[m,j-3];
this.notchEl.setStyle("marginLeft",((this.params.width-30)/2)+"px");
var c=this.params.left||this.currentXY[0];
var q=this.params.top||this.currentXY[1];
this.el.setStyles({left:c+"px",top:q+"px",width:this.params.width+"px"});
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}else{if(this.params.flyoutPointerDirection==="bottom"){this.notchEl=a.DB.DIV("flyout-notch-top bottom",{html:"&nbsp;"});
this.el.append(this.notchEl);
var p=this.anchorEl.get("offsetWidth");
var g=this.anchorEl.get("offsetHeight");
m=this.anchorEl.getX();
j=this.anchorEl.getY()+g;
if(this.params.width>p){m-=(this.params.width-p)/2
}this.currentXY=[m,j-3];
this.notchEl.setStyle("marginLeft",((this.params.width-30)/2)+"px");
var c=this.params.left||this.currentXY[0];
var q=this.params.top||this.currentXY[1];
this.el.setStyles({left:c+"px",top:q+"px",width:this.params.width+"px"});
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}else{this.currentXY=[(this.anchorEl.getX()+(this.anchorEl.get("offsetWidth")/2)-(this.params.width/2)),(this.anchorEl.getY()+(this.anchorEl.get("offsetHeight")/2)-(this.params.height/2)-15)];
this.el.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px",width:this.params.width+"px"});
this.el.setStyle();
this.mainEl.setStyle("width",this.params.width+"px");
j=this.currentXY[1];
a.one(document.body).append(this.el)
}}}}}else{if(this.params.embedWithinEl){if(this.params.left||this.params.top){this.el.setStyle("position","absolute");
if(this.params.top){this.el.setStyle("top",this.params.top+"px")
}if(this.params.left){this.el.setStyle("left",this.params.left+"px")
}}this.el.setStyle("width",this.params.width+"px");
this.mainEl.setStyle("width",this.params.width+"px");
this.params.embedWithinEl.append(this.el)
}else{this.el.setStyle("position","fixed");
if(this.params.position=="right"){this.el.setStyles({right:this.params.edgeMargin+"px",top:"0px"});
if(this.params.edgeMargin===0){this.titleEl.setStyle("border-radius","0px");
this.controlsEl.setStyle("border-radius","0px")
}}else{if(typeof this.params.left!=="undefined"){this.currentXY=[this.params.left,this.params.top]
}else{this.currentXY=[((n/2)-(this.params.width/2)),this.params.top];
this.el.setStyle("position","fixed")
}}if(this.currentXY){this.el.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px"});
j=this.currentXY[1]
}this.el.setStyle("width",this.params.width+"px");
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}}if(this.params.loadingState){var k=this._anim({node:this.el,to:(j?{opacity:0.9,top:j}:{opacity:0.9}),duration:0.15,easing:a.Easing.easeOutStrong});
k.on("end",function(){this.fire("loading-ready")
},this);
k.run()
}else{this.dataReady()
}if(this.params.verticalHeight=="full"){this.el.setStyles({top:this.params.edgeMargin+"px",bottom:this.params.edgeMargin+"px"});
this.params.top=this.params.edgeMargin
}if(this.params.overlay){this.overlayEl=a.DB.DIV("dialog-screen-overlay");
this.overlayEl.setStyle("zIndex",(this.zIndex-1));
a.one(document.body).append(this.overlayEl);
var k=this._anim({node:this.overlayEl,to:{opacity:this.params.overlay},duration:0.1,easing:a.Easing.easeOutStrong});
k.run();
this.globalEvents.push(a.on("click",this.onOverlayClick,this.overlayEl,this))
}a.Squarespace.DragSelection.saveStatus(this);
a.Squarespace.DragSelection.disable();
this.fire("shown",this);
this.moveIntoView()
},cancelChildDialogs:function(){for(var b=0;
b<this.childDialogs.length;
++b){this.childDialogs[b].cancel()
}this.childDialogs=[]
},isOpen:function(){return(this.state==a.Squarespace.DialogStates.LOADING||this.state==a.Squarespace.DialogStates.EDITING)
},disableBodyScroll:function(){this.oldBodyScroll=a.one("body").getStyle("overflow");
a.one("body").setStyle("overflow","hidden")
},restoreBodyScroll:function(){if(this.hasOwnProperty("oldBodyScroll")){if(this.oldBodyScroll){a.one("body").setStyle("overflow",this.oldBodyScroll)
}else{a.one("body").setStyle("overflow",null)
}}},getAnchorEl:function(){return this.anchorEl
},getAnchorData:function(){return this.anchorData
},getChildDialogs:function(){return this.childDialogs
},addChildDialog:function(b){if(this.childDialogs.indexOf(b)<0){this.cancelChildDialogs();
this._debug.log("addChildDialog",b);
this.childDialogs.push(b)
}b.params.parentDialog=this
},removeChildDialog:function(c){for(var b=0;
b<this.childDialogs.length;
++b){if(this.childDialogs[b]==c){this.childDialogs.splice(b,1);
return
}}},enableDragging:function(){this.titleEl.setStyle("cursor","move");
this.dd=new a.DD.Drag({node:this.el});
this.dd.on("drag:mouseDown",function(b){if(a.Squarespace.Help&&a.Squarespace.Help.active){b.halt()
}if(b.ev.target.ancestor(".body-block",true)){b.halt()
}},this);
this.dd.on("drag:start",function(b){this.cancelChildDialogs()
},this);
this.dd.on("drag:drag",function(b){this.fire("drag",b)
},this);
this.dd.on("drag:end",function(b){this.moveIntoView()
},this)
},temporaryHide:function(b){this.fire("hide");
for(var c=0;
c<this.childDialogs.length;
++c){this.childDialogs[c].temporaryHide()
}if(this.hideAnim){this.hideAnim.stop()
}if(this._hideAnimEvent){this._hideAnimEvent.detach()
}if(this.overlayHideAnim){this.overlayHideAnim.stop()
}if(this._overlayHideAnimEvent){this._overlayHideAnimEvent.detach()
}this.hideAnim=this._anim({node:this.el,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong});
if(this.overlayEl){this.overlayHideAnim=this._anim({node:this.overlayEl,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong});
this._overlayHideAnimEvent=this._subscribe(this.overlayHideAnim,"end",function(){this.overlayEl.setStyle("display","none")
})
}this._hideAnimEvent=this._subscribe(this.hideAnim,"end",function(){this.el.setStyle("display","none");
this.fire("hidden",this)
});
if(b){this.el.setStyle("display","none");
if(this.overlayEl){this.overlayEl.setStyle("display","none")
}this.fire("hidden",this)
}else{this.hideAnim.run();
if(this.overlayEl){this.overlayHideAnim.run()
}}a.Squarespace.DragSelection.restoreStatus(this)
},temporaryShow:function(c){this.fire("show",this);
a.Squarespace.DragSelection.saveStatus(this);
a.Squarespace.DragSelection.disable();
if(c){if(c.data){this.data=c.data
}if(c.anchor){this.anchorEl=c.anchor
}if(c.anchorData){this.anchorData=c.anchorData
}}if(this.hideAnim){this.hideAnim.stop()
}if(this._hideAnimEvent){this._hideAnimEvent.detach()
}if(this.overlayHideAnim){this.overlayHideAnim.stop()
}if(this.overlayEl){this.overlayEl.setStyle("display","block");
this.overlayHideAnim=this._anim({node:this.overlayEl,to:{opacity:1},duration:0.35,easing:a.Easing.easeOutStrong});
this.overlayHideAnim.run()
}this.el.setStyle("display","block");
this.hideAnim=this._anim({node:this.el,to:{opacity:1},duration:0.35,easing:a.Easing.easeOutStrong});
this._hideAnimEvent=this._subscribeOnce(this.hideAnim,"end",function(){this.fire("shown",this)
});
this.hideAnim.run();
for(var b=0;
b<this.childDialogs.length;
++b){this.childDialogs[b].temporaryShow()
}this.moveIntoView()
},isVisible:function(){return this.state!==a.Squarespace.DialogStates.CLOSED
},_updatePosition:function(b){if(this.el){var c=this.el.get("offsetHeight");
if(this.anchorEl){if(this.params.flyoutPointerDirection==="top"){return
}if(this.params.flyoutPointerDirection==="bottom"){return
}if(this.params.flyoutPointerDirection==="centered"){this.position=new a.Squarespace.Position({x:(this.anchorEl.getX()+(this.anchorEl.get("offsetWidth")/2)-(this.params.width/2)),y:(this.anchorEl.getY()+(this.anchorEl.get("offsetHeight")/2)-(c/2)),w:(this.params.width),h:c});
this.position.nudgeFix()
}else{this.position=new a.Squarespace.Position({avoidElX:this.anchorEl,avoidElY:this.anchorEl,xdir:"right",ydir:"bottom",x:this.anchorEl.getX(),y:this.anchorEl.getY(),xo:2,yo:0,w:(this.params.width+this.NOTCH_HEIGHT),h:c});
this.position.reflectFix()
}if(this.params.flyoutPointerDirection!=="hidden"&&this.params.flyoutPointerDirection!=="centered"){if(!this.notchEl){this.notchEl=a.DB.DIV("flyout-notch-left",{html:"&nbsp;"})
}this.notchEl.set("className",(this.position.xdir==="right"?"flyout-notch-left":"flyout-notch-right"));
this.notchEl.remove();
if(this.position.xdir==="right"){this.el.insertBefore(this.notchEl,this.mainEl)
}else{this.el.append(this.notchEl)
}}if(b){this.el.setStyles({left:this.position.getX(),top:this.position.getY()});
this._alignNotch(this.anchorEl)
}}}},_alignNotch:function(i){if(!this.notchEl){return
}var h=this.el.get("offsetHeight");
var j=Math.max(h-36,220),f=12,g=11,b=f;
var e=this.el.get("region"),d=i.get("region"),c=d.top+d.height/2;
if(d.top>e.top){b=c-e.top;
b-=g
}if(b>j){b=j
}else{if(b<f){b=f
}}this.notchEl.setStyle("marginTop",b+"px")
},onDataChange:function(b){this.fire("render-anchor",this.getData());
this.setEdited();
this._debug.log("onDataChange");
this.fire("datachanged")
},onOverlayClick:function(b){b.halt();
this.fire("overlay-click");
if(this.params.disableOverlayCancel){return
}this.close()
},setEdited:function(){if(this.state==a.Squarespace.DialogStates.SAVING){return
}if(this.params.discardChangesConfirmation){var b=this;
window.onbeforeunload=function(){if(b.isVisible()){return"You have unsaved changes."
}}
}this.edited=true;
this.editedSinceLastSave=true
},clearEdited:function(){if(this.params.discardChangesConfirmation){window.onbeforeunload=null
}this.edited=false;
this.editedSinceLastSave=false
},getEditedSinceLastSave:function(){return this.editedSinceLastSave
},getNextTabIndex:function(){return this.lastTabIndex++
},getEdited:function(){return this.edited
},getState:function(){return this.state
},setInitialData:function(b){if(!this.params.initialDataByReference){this.params.initialData=a.clone(b)
}else{this.params.initialData=b
}if(this.fields){a.Object.each(this.fields,function(c,d){if(a.Squarespace.DialogField2&&c instanceof a.Squarespace.DialogField2&&c.get("name")&&!a.Lang.isUndefined(this.params.initialData[c.get("name")])){c.set("data",this.params.initialData[c.get("name")]);
c.setCurrentDataAsInitial()
}},this)
}},getBodyHeight:function(){if(this.params.height){return this.params.height
}else{var b=a.one(document).get("winHeight");
return b-this.params.edgeMargin*2-this.controlsHeight-this.titleEl.get("offsetHeight")
}},setActiveFlyout:function(b){if(this.activeFlyout){this.activeFlyout.field.closeFlyout()
}a.later(10,this,function(){this.activeFlyout=b
})
},clearActiveFlyout:function(){this.activeFlyout=null
},attachAnchorDataEditingHandlers:function(b){this.on("loading",function(){this.setInitialData(this.anchorData.getEditableParams());
this.autoSave=false
});
this.on("cancel",function(){if(this.anchorData.__saveHandler){this.anchorData.__saveHandler.detach();
this.anchorData.__saveHandler=null
}});
this.on("close",function(){if(this.anchorData.__saveHandler){this.anchorData.__saveHandler.detach();
this.anchorData.__saveHandler=null
}});
this.publish("send-requested",{emitFacade:true,defaultFn:function(){this.autoSave=false;
if(this.anchorData.setUnsaved){this.anchorData.setUnsaved(false)
}if(this.params.waitForServerOnClose){this.saveAnchorData()
}else{this.send()
}},preventedFn:function(){this.hideSaveOverlay()
},context:this});
this.on("sent",function(){if(!this.params.waitForServerOnClose){this.saveAnchorData()
}});
this.saveAnchorData=function(){if(!this.anchorData.__saveHandler){this.anchorData.__saveHandler=this.anchorData.on("save",function(c){this.hideSaveOverlay();
if(!this.autoSave){this.fire("data-saved",c);
this.autoSave=false;
if(this.params.waitForServerOnClose){this.send()
}}else{this.fire("auto-save")
}},this)
}this.anchorData.setEditableParams(this.getData());
this.anchorData.save(this.autoSave)
}
},onResize:function(d){if(this.params.embedWithinEl){return
}var c=a.one(document).get("winWidth");
var f=a.one(document).get("winHeight");
if(!this.anchorEl&&!this.params.draggable){var b={};
if(this.params.verticalHeight=="full"){this.bodyHeight=this.getBodyHeight();
this.bodyEl.setStyle("height",this.bodyHeight);
this.bodyEl.all(".scrollable-body").each(function(e){e.setStyle("height",(this.bodyHeight-30)+"px");
e.setStyle("paddingBottom","30px")
},this);
this.resizeVerticalFields()
}if(this.params.position!="right"){this.hideErrors();
b.left=((c/2)-(this.params.width/2));
b.top=this.params.top;
if(this.params.left){b.left=this.params.left
}}this.currentXY=[b.left,b.top];
if(this.moveAnim){this.moveAnim.stop()
}this.moveAnim=this._anim({node:this.el,to:b,duration:0.15,easing:a.Easing.easeOutStrong});
this.moveAnim.run()
}this.moveIntoView()
},moveIntoView:function(k){if(!this.params.draggable){return
}if(k&&(!this.anchorEl&&!this.position)){k=false
}var h=this.el.get("docScrollX"),g=this.el.get("docScrollY"),i=this.el.get("winWidth")+h,f=this.el.get("winHeight"),c=f+g,d=this.el.getY(),e=this.el.getX(),b={},j=false;
if(d<g){b.top=g;
j=true
}if((d+this.el.get("offsetHeight"))>c){b.top=(c-this.el.get("offsetHeight"));
j=true
}if((e+this.el.get("offsetWidth"))>i){b.left=(i-this.el.get("offsetWidth"));
j=true
}if(this.el.getX()<h){b.left=h;
j=true
}if(k){b.top=(b.top)?Math.max(b.top,this.position.getY()):this.position.getY();
j=true
}if(j){this._anim({node:this.el,to:b,duration:0.3,easing:a.Easing.easeOutStrong}).run()
}if(this.preferredHeight+120>f){this.bodyHeight=f-120;
this.bodyEl.setHeight(this.bodyHeight)
}else{if(this.bodyHeight!=this.preferredHeight){this.bodyHeight=this.preferredHeight;
this.bodyEl.setHeight(this.preferredHeight)
}}},scrollIntoView:function(b){this.el.scrollIntoView(b)
},showErrors:function(d){this.fire("show-errors",d);
this.allowEditing();
this.currentErrors=d;
this.errorCount=0;
this.errorsByTab={};
for(var b in d){var c=this.getField(b);
if(!c){console.error("Server error returned for a dialog field that is not present: "+b)
}if(c.tab.tabNavigationObj){c.tab.tabNavigationObj.addClass("error")
}this.errorCount++;
if(!this.errorsByTab[c.tab.name]){this.errorsByTab[c.tab.name]=0
}this.errorsByTab[c.tab.name]++
}this.activateErrors()
},clearError:function(b){if(this.currentErrors&&this.currentErrors[b.getName()]){this.errorsByTab[b.tab.name]--;
delete this.currentErrors[b.getName()];
this.errorCount--;
if(b.tab.tabNavigationObj&&this.errorsByTab[b.tab.name]===0){b.tab.tabNavigationObj.removeClass("error")
}}},activateErrors:function(){if(this.errorCount){var b=this.currentTab.tabFields;
var d=null;
for(var c=0;
c<b.length;
++c){var e=b[c];
if(this.currentErrors[e.getName()]){e.showError(this.currentErrors[e.getName()]);
if(!d){d=e
}}}if(d&&d.focus){d.focus()
}}},hideErrors:function(){if(!this.currentTab){return
}var b=this.currentTab.tabFields||[];
a.Array.each(b,function(c){if(a.Lang.isFunction(c.hideError)){c.hideError()
}},this)
},updateTitle:function(d){var c=this.params.tabs[this.currentTabIndex];
if(c&&this.currentTab&&c.title!=this.currentTab.title){this.currentTab.title=c.title
}if(a.Lang.isUndefined(d)){d=this.state
}var b;
if(this.currentTab&&this.currentTab.title){b=this.currentTab.title
}else{b=this.params.title
}var e="";
if(this.params.subtext){e='<div class="title-subtext">'+this.params.subtext+"</div>"
}switch(d){case a.Squarespace.DialogStates.LOADING:if(this.params.loadingText){this.titleTextEl.set("innerHTML",'<div class="title-text">'+this.params.loadingText+"</div>"+e)
}break;
case a.Squarespace.DialogStates.EDITING:if(b){this.titleTextEl.set("innerHTML",'<div class="title-text">'+b+"</div>"+e)
}break;
case a.Squarespace.DialogStates.SAVING:if(this.params.savingText){this.titleTextEl.set("innerHTML",'<div class="title-text">'+this.params.savingText+"</div>"+e)
}break
}},setData:function(e){var b=this.currentTab.tabFields;
for(var c=0;
c<b.length;
++c){var d=b[c];
if(d.setValue){if(e[d.getName()]){d.setValue(e[d.getName()])
}else{d.setValue(null)
}this.fire("datachange",d)
}}},focusTab:function(){if(!this.currentTab){return
}this.fire("tab-focused:"+this.currentTab.name);
var b=this.currentTab.tabFields;
var d=null;
for(var c=0;
c<b.length;
++c){var e=b[c];
if(e.setValue&&e.focus){e.focus();
return
}}},dataReady:function(){this.clearEdited();
this.state=a.Squarespace.DialogStates.EDITING;
this.titleEl.removeClass("loading");
if(!this.params.initialData){this.params.initialData={}
}this.bodyHeight=this.params.height;
this.controlsHeight=(this.params.style=="standard"?65:60);
if(this.params.verticalHeight=="full"){this.bodyHeight=a.one(document).get("winHeight")-this.params.edgeMargin*2-this.controlsHeight-this.titleEl.get("offsetHeight")
}this.preferredHeight=this.bodyHeight;
this.bodyEl.setStyle("width",this.params.width+"px");
if(this.params.overlay&&(!this.params.doNotDisableBodyScroll)){this.disableBodyScroll()
}if(this.moving){this.moving=false;
this.updateTitle();
if(this.definitionChanged){this.definitionChanged=false;
this.destroyBody();
this.destroyButtons();
this.render();
var b=this._anim({node:this.bodyEl,duration:0.25,easing:a.Easing.easeOutStrong,to:{height:this.bodyHeight}});
b.on("end",function(){this.fire("ready")
},this);
b.run()
}else{if(this.rendered){this.setData(this.params.initialData);
if(this.params.autoFocus){this.focusTab()
}}else{this.once("rendered",function(){this.setData(this.params.initialData);
if(this.params.autoFocus){this.focusTab()
}},this)
}this.fire("ready")
}this.clearEdited()
}else{this.currentTabIndex=0;
this.currentTab=this.params.tabs[0];
this.updateTitle();
if(this.params.loadingState){var b=this._anim({node:this.el,to:{opacity:1},duration:0.15,easing:a.Easing.easeOutStrong});
b.run();
if(this.controlsEl){b=this._anim({node:this.controlsEl,to:{height:this.controlsHeight},duration:0.15,easing:a.Easing.easeOutStrong});
b.run()
}b=this._anim({node:this.bodyEl,to:{height:this.bodyHeight},duration:0.25,easing:a.Easing.easeOutStrong});
b.on("end",function(){this.render();
this.fire("ready")
},this);
b.run()
}else{this.render();
var c=this;
var e=function(){if(c.el){c.el.setStyle("transform",null)
}};
switch(this.params.showAnim){case"custom":this.params.customShowAnim(this.el,function(){c.fire("ready")
});
break;
case"slideDownUp":this.el.setStyles({marginTop:-this.el.height()+"px"});
var d=this.el.anim({marginTop:0},{duration:0.3});
d.on("end",function(){c.fire("ready")
});
d.run();
break;
case"fade":this.el.transition({opacity:{duration:0.2,value:1},easing:"ease-out"},function(){c.fire("ready");
e()
});
break;
case"noshow":this.el.setStyles({display:"none"});
c.fire("ready");
break;
default:this.el.transition({opacity:{duration:0.4,value:1},easing:"ease-out"},function(){c.fire("ready");
e()
});
break
}}}this.currentData=this.params.initialData
},containsNode:function(b){return(this.bodyEl&&this.bodyEl.contains(b))
},activateTab:function(f,c){this.hideErrors();
var d=(c?c:a.DB.unpackData(f.target));
if(!this.currentTab){this.currentTab=d
}for(var b=0;
b<this.params.tabs.length;
b++){if(b==d.index){this.params.tabs[b].tabNavigationObj.addClass("active");
this._showPanelByIndex(d.index)
}else{this.params.tabs[b].tabNavigationObj.removeClass("active")
}}},_showField:function(b){if(b instanceof a.Squarespace.DialogField2){if(b.get("visible")){b.show(true)
}}else{if(!b.config.hidden){b.show(true)
}}},_showPanelByIndex:function(e){if(e==this.currentTabIndex){return
}var d=this.params.tabs[e];
var f=this.params.tabs[this.currentTabIndex];
if(!this.params.noTabAnim){if(d.tabPanelObj.a){d.tabPanelObj.a.stop(true)
}if(f.tabPanelObj.a){f.tabPanelObj.a.stop(true)
}}var b=f.tabFields;
if(!this.params.noTabAnim){d.tabPanelObj.setStyles({left:((d.index>f.index?1:-1)*this.params.width)+"px",opacity:1,zIndex:"300"});
f.tabPanelObj.setStyles({zIndex:"0"});
var c=this._anim({node:f.tabPanelObj,to:{left:((d.index<f.index?1:-1)*this.params.width)+"px",opacity:0},duration:0.25,easing:a.Easing.easeOutStrong});
c.on("end",function(){this.tab.addClass("hidden")
},{tab:f.tabPanelObj});
c.run();
f.tabPanelObj.a=c
}else{f.tabPanelObj.setStyles({opacity:1,zIndex:"300"});
f.tabPanelObj.addClass("hidden")
}this.currentTab=d;
this.currentTabIndex=e;
this.updateTitle();
d.tabPanelObj.removeClass("hidden");
if(!this.params.noTabAnim){var c=this._anim({node:d.tabPanelObj,to:{left:0},duration:0.25,easing:a.Easing.easeOutStrong});
c.on("end",function(){var g=this.currentTab.tabFields;
a.Array.forEach(g,function(h){this._showField(h)
},this);
this.focusTab();
this.activateErrors()
},this);
c.run();
d.tabPanelObj.a=c
}else{var b=this.currentTab.tabFields;
a.Array.forEach(b,function(g){this._showField(g)
},this);
this.focusTab();
this.activateErrors()
}if(this.currentTab.height){this.currentTab.tabPanelObj.setStyle("height",f.height-50);
this._anim({node:this.bodyEl,to:{height:this.currentTab.height},duration:0.25,easing:a.Easing.easeOutStrong}).run()
}if(this.currentTab.scroll){this.bodyEl.addClass("scrollable")
}else{this.bodyEl.removeClass("scrollable")
}},render:function(){if(this.rendered){return
}this.observedHeight=0;
this.tabs=[];
this.tabsEl.setContent("");
for(var b=this.params.tabs.length-1;
b>=0;
b--){var c=a.DB.A("configuration-container-tab "+(b==0?"active":""),{href:"javascript:noop();",data:{index:b},html:this.params.tabs[b].tabTitle});
if(this.params.tabs.length>1){if(this.params.tabs[b].noTabTitle){c.addClass("noTabTitle")
}this.bodyEvents.push(c.on("click",this.activateTab,this));
this.tabsEl.append(c)
}this.params.tabs[b].tabNavigationObj=c;
this.params.tabs[b].index=b;
this.renderTab(this.params.tabs[b],(b==0))
}this.renderButtons();
if(!this.bodyHeight){this.bodyHeight=this.observedHeight+14;
this.preferredHeight=this.bodyHeight
}this.fire("rendered");
this.rendered=true;
if((this.params.embedWithinEl&&this.params.height)||!this.params.embedWithinEl){this.bodyEl.setStyle("height",this.bodyHeight+"px")
}if(this.controlsEl){this.controlsEl.setStyle("height",this.controlsHeight+"px")
}this._updatePosition(true);
if(this.params.autoFocus){this.focusTab()
}if(this.params.name==="configure-collection"){this._scrollRepositionSub=a.one(window).on(["scroll","mousewheel"],a.bind(this._updatePosition,this))
}},getButtons:function(){return this.params.buttons
},setButtons:function(){var b=arguments;
if(arguments.length===1&&a.Lang.isArray(arguments[0])){b=arguments[0]
}this.params.buttons=[];
this.destroyButtons();
b.forEach(function(c){this.params.buttons.push(c)
},this);
if(this.isVisible()){this.renderButtons()
}},_removeButton:function(c){var f;
if(a.Lang.isString(c)){var d=this.getButtons();
for(var b=0;
b<d.length;
b++){if(d[b]!=null&&d[b].type==c){f=b
}}}else{f=this.getButtons().indexOf(c)
}if(f>=0){var e=this.getButtons();
e.removeAt(f);
this.setButtons(e)
}},renderButtons:function(){this.saveAndCloseButton=a.DB.INPUT("saveAndClose",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,type:"button",value:"Save & Close"});
this.saveButton=a.DB.INPUT("save",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,type:"button",value:"Save"});
this.cancelButton=a.DB.A("cancel",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,href:"javascript:noop();",html:"Cancel"});
this.removeButton=a.DB.INPUT("remove",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,type:"button",value:"Remove"});
this.buttonEvents.push(a.on("click",this.saveAndClose,this.saveAndCloseButton,this),a.on("click",this.save,this.saveButton,this),a.on("click",this.remove,this.removeButton,this),a.on("click",this.cancel,this.cancelButton,this));
for(var d=(this.params.buttons.length-1);
d>=0;
d--){var c=this.params.buttons[d];
if(!c){continue
}switch(c.type){case"cancel":this.cancelButton.set("innerHTML",c.title);
this.buttonHolder.append(a.DB.DIV("cancel-block",this.cancelButton));
break;
case"save":this.saveButton.set("value",c.title);
this.buttonHolder.append(a.DB.DIV("button-block",this.saveButton));
break;
case"remove":this.removeButton.set("value",c.title);
this.buttonHolder.append(a.DB.DIV("button-block",this.removeButton));
break;
case"saveAndClose":this.saveAndCloseButton.set("value",c.title);
this.buttonHolder.append(a.DB.DIV("button-block",this.saveAndCloseButton));
break;
default:var e;
if(c.style=="text"){e=a.DB.A({html:c.title,href:"javascript:noop();",data:{type:c.type}});
this.buttonHolder.append(a.DB.DIV("cancel-block",e))
}else{e=a.DB.INPUT((c.className?c.className:""),{type:"button",value:c.title,data:{type:c.type}});
this.buttonHolder.append(a.DB.DIV("button-block",e))
}this.buttonEvents.push(a.on("click",this.onCustomButtonPress,e,this))
}}},onCustomButtonPress:function(b){this.fire("button-"+b.target.data().type)
},showSaveOverlay:function(b){this.fire("show-save-overlay");
if(this.params.disableSaveOverlay){return
}if(this.saveOverlayAnimationManager&&this.saveOverlayAnimationManager.isRunning()){this.saveOverlayAnimationManager.stop(true)
}if(this.saveOverlay){this.saveOverlay.remove()
}this.saveOverlay=a.DB.DIV("save-overlay",{style:"height: "+(this.bodyEl.get("offsetHeight")+5)+"px; padding-top: "+(this.bodyEl.get("offsetHeight")/2-40)+"px; width: "+this.bodyEl.get("offsetWidth")+"px",html:"&nbsp;"});
this.bodyEl.append(this.saveOverlay);
if(b){this.titleEl.addClass("save-overlay-active")
}this.saveOverlayAnimationManager=new a.Squarespace.AnimationManager();
this.saveOverlayAnimationManager.push(this._anim({node:this.tabsEl,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}));
this.saveOverlayAnimationManager.push(this._anim({node:this.saveOverlay,to:{opacity:0.8},duration:0.25,easing:a.Easing.easeOutStrong}));
if(this.controlsEl){this.saveOverlayAnimationManager.push(this._anim({node:this.autosaveEl,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}))
}if(this.params.style!="transparent"){this.saveOverlayAnimationManager.push(this._anim({node:this.titleEl,to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}));
if(this.controlsEl){this.saveOverlayAnimationManager.push(this._anim({node:this.controlsEl.get("firstChild"),to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}))
}}this.saveOverlayAnimationManager.on("end",function(){this.fire("save-overlay-shown")
},this);
this.saveOverlayAnimationManager.run()
},hideSaveOverlay:function(){if(this.saveOverlay){this.fire("hide-save-overlay");
this.titleEl.removeClass("save-overlay-active");
if(this.saveOverlayAnimationManager&&this.saveOverlayAnimationManager.isRunning()){this.saveOverlayAnimationManager.stop(true)
}this.saveOverlayAnimationManager=new a.Squarespace.AnimationManager();
this.saveOverlayAnimationManager.push(this._anim({node:this.saveOverlay,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}));
this.saveOverlayAnimationManager.push(this._anim({node:this.tabsEl,to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}));
this.saveOverlayAnimationManager.on("end",function(){this.saveOverlay.remove();
this.fire("save-overlay-hidden");
this.state=a.Squarespace.DialogStates.EDITING;
this.updateTitle()
},this);
this.saveOverlayAnimationManager.run()
}else{this.state=a.Squarespace.DialogStates.EDITING
}},allowEditing:function(){this.hideSaveOverlay();
this.clearEdited();
this.fire("editing-allowed");
this.state=a.Squarespace.DialogStates.EDITING
},save:function(){if(!this._showLocalErrors()){this._debug.log("save");
this.closeOnSend=false;
this._saveData()
}},_showLocalErrors:function(){var f=function(j){return j.inActiveFrame
};
var i=this.currentTab;
var c=function(j){return j.tab.name===i.name
};
var h=function(j){return{field:j,errors:j.getErrors()}
};
var b=a.Object.values(this.fields);
if(this.params.validateActiveTabOnly){b=b.filter(function(j){return f(j)&&c(j)
},this)
}else{b=b.filter(f,this)
}var e=a.Array.map(b,h);
var g=false;
var d={};
e.forEach(function(j){var k=j.field,m=j.errors;
var l=m[m.length-1];
if(l){d[j.field.getName()]=m[m.length-1];
g=true
}},this);
if(g){this.showErrors(d)
}return g
},saveAndShow:function(){if(!this._showLocalErrors()){this._debug.log("saveAndShow");
this.closeOnSend=false;
this._saveData();
this.show()
}},saveAndClose:function(){if(!this._showLocalErrors()){this.fire("preClose");
this._debug.log("saveAndClose");
if(this.params.closeable){this.closeOnSend=true
}this._saveData()
}},_saveData:function(){this._debug.log("_saveData");
if(this.state==a.Squarespace.DialogStates.SAVING){this._debug.log("_saveData","Exiting because dialog state is in SAVING");
return
}this.clearEdited();
this.hideErrors();
this.state=a.Squarespace.DialogStates.SAVING;
this.updateTitle();
this.showSaveOverlay();
this._debug.log("_saveData","fire","send-requested");
this.fire("send-requested")
},remove:function(b){if(b){b.halt()
}this.fire("remove-requested")
},canClose:function(b,d){var c=0;
if(this.childDialogs&&this.childDialogs.length>0){for(c=0;
c<this.childDialogs.length;
c++){if(!this.childDialogs[c].canClose(this.saveAndClose,this.cancel)){return false
}}}if((this.edited||this.editedSinceLastSave)&&this.params.discardChangesConfirmation){var g=false;
for(var f in this.fields){var e=this.fields[f];
if(e.didDataChange()){g=true
}else{}}if(g){new a.Squarespace.ConfirmationDialog({style:"confirmOrReject",confirmText:"Save",rejectText:"Discard",showScreenOverlay:true,showSaveOverlay:false,scope:this,onSuccess:function(){this.clearEdited();
this._debug.log("canClose","calling onSuccess()",b);
b.call(this)
},onReject:function(){this.clearEdited();
this._debug.log("canClose","calling onReject()",d);
d.call(this)
},onCancel:function(){a.Squarespace.EscManager.addTarget(this);
this._debug.log("canClose","onCancel");
this.fire("cancel-close")
}}).show("Review Changes","You have made changes. Do you want to save or discard them?");
this._debug.log("canClose",false,"Showing confirmation dialog");
return false
}}this._debug.log("canClose",true);
return true
},close:function(c,b){this._debug.log("close",c);
if(this.state!=a.Squarespace.DialogStates.EDITING&&this.state!=a.Squarespace.DialogStates.SAVING){this._debug.log("close","Exiting because state is in Editing or Saving.");
return
}if(!b){if(this.canClose(this.saveAndClose,this.cancel)===false){this._debug.log("close","Exiting because canClose came back false");
return
}}else{this._debug.log("canClose skipped due to force = true")
}this.fire("close");
if(this.getAnchorData()&&((this.getAnchorData()._name=="Item"&&this.getAnchorData().getUnsaved())||((this.getAnchorData().saved!==undefined)&&!this.getAnchorData().saved))&&!this.edited){this.cancel(c);
return
}this.dismiss(true)
},cancel:function(b){this._debug.log("cancel",b);
if(this.state!=a.Squarespace.DialogStates.EDITING&&this.state!=a.Squarespace.DialogStates.SAVING){return
}this.clearEdited();
this.fire("cancel");
this.dismiss(false)
},dismiss:function(e){this.fire("dismiss");
this.state=a.Squarespace.DialogStates.CLOSING;
this.updateTitle();
this.clearEdited();
this._preDestroy();
this.hideErrors();
if(this.params.overlay){this.restoreBodyScroll()
}a.Squarespace.DragSelection.restoreStatus(this);
switch(this.params.hideAnim){case"noHideAnimation":this._finishCancelation();
break;
case"custom":var d=this;
this.params.customHideAnim(this.el,function(){d._finishCancelation()
});
break;
case"slideDownUp":var b=this._anim({node:this.el,to:{marginTop:-this.el.height()+"px"},duration:0.3,easing:a.Easing.easeOut});
b.on("end",this._finishCancelation,this);
b.run();
break;
default:var b=this._anim({node:this.el,to:{opacity:0},duration:0.3,easing:a.Easing.easeOut});
b.on("end",this._finishCancelation,this);
b.run();
break
}if(this.params.overlay&&this.overlayEl){this.overlayEl.destroying=true;
var c=this._anim({node:this.overlayEl,to:{opacity:0},duration:0.2,easing:a.Easing.easeOutStrong});
c.on("end",function(){this.overlayEl.remove();
this.overlayEl=null
},this);
c.run()
}},_finishCancelation:function(){this.fire("render-anchor",this.getInitialData());
this.destroy();
this.state=a.Squarespace.DialogStates.CLOSED;
this.fire("canceled")
},_preDestroy:function(){this._preDestroyCalled=true;
var b=a.Squarespace.OPEN_DIALOGS.indexOf(this);
if(b!=-1){a.Squarespace.OPEN_DIALOGS.splice(b,1)
}if(a.Squarespace.OPEN_DIALOGS.length===0){a.one(document.body).removeClass("dialog-open")
}for(var c=0;
c<this.childDialogs.length;
++c){this.childDialogs[c].close()
}for(var c=0;
c<this.timers.length;
++c){this.timers[c].cancel()
}this.timers=[];
if(a.Squarespace.EscManager){a.Squarespace.EscManager.removeTarget(this)
}if(this.activeFlyout){this.activeFlyout.field.closeFlyout()
}if(a.Squarespace.ToolTipManager&&this.params.disableTips){a.Squarespace.ToolTipManager.enableTooltips()
}if(this.firstShowEvent){this.firstShowEvent.detach();
this.firstShowEvent=null
}if(this.anchorEl&&this.anchorEl._node){this.anchorEl.removeClass("targeted")
}},send:function(){var g=0;
var d={};
for(var b in this.fields){var c=this.fields[b];
var e=false;
if(a.Squarespace.DialogField2&&c instanceof a.Squarespace.DialogField2){e=c.get("required")&&c.isEmpty()
}else{e=(c.config.required&&(c.getValue()===""||c.getValue()===0))
}if(e){d[c.getName()]="This is a required field.";
g++
}}if(g){this.showErrors(d);
this.fire("local-errors")
}else{if(this.closeOnSend){this.saved=true;
this.closeOnSend=false;
this.close()
}this.fire("sent")
}},updateAutoSave:function(d,b){if(!this.autosaveEl.inDoc()){this.editedSinceLastSave=false;
return
}this.autosaveEl.setStyle("display","block");
var c=this._anim({node:this.autosaveEl,from:{opacity:1},to:{opacity:0.5},duration:0.25,easing:a.Easing.easeOutStrong});
c.on("end",function(){if(d){this.autosaveEl.set("innerHTML",d)
}else{this.autosaveEl.set("innerHTML","Last saved <span class='time'></span>.");
this.autosaveEl.one(".time").plug(a.Squarespace.RelativeTimeDisplay)
}if(b){this.autosaveEl.addClass("error")
}else{this.autosaveEl.removeClass("error")
}if(this.autosaveEl.ancestor("body")){this._anim({node:this.autosaveEl,from:{opacity:0.5},to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}).run()
}},this);
c.run();
this.editedSinceLastSave=false
},_recordFieldData:function(d,g){for(var f in g.fields){f=g.fields[f];
if(a.Lang.isFunction(f.getValue)){var c=f.getValue();
if(c&&a.Lang.isObject(c)&&a.Object.isEmpty(c)){c=undefined
}d[f.getName()]=c;
if(f.getAssociatedVars!==undefined){var e=f.getAssociatedVars();
for(var b=0;
b<e.length;
b++){d[e[b].name]=e[b].value
}}if(((f.ctor&&f.ctor===a.Squarespace.DialogFileImage)||(f.constructor&&f.constructor==a.Squarespace.DialogFileImage))&&f.getMediaFocalPoint()){console.log("saving the mediaFocalPoint",f.getMediaFocalPoint());
d.mediaFocalPoint=f.getMediaFocalPoint()
}}if(f.fields){this._recordFieldData(d,f)
}}},getData:function(){var c={};
for(var b in this.params.initialData){c[b]=this.params.initialData[b]
}this._recordFieldData(c,this);
return c
},getField:function(b){var d=this.fields[b];
if(d){return d
}for(var c in this.fields){if(this.fields[c].getField){d=this.fields[c].getField(b);
if(d){break
}}}return d
},getSection:function(b){return this.sections[b]
},_renderFields:function(c,b,d,e){var f=30;
a.Array.each(b,function(l,o){var q;
if(!l){return
}var n;
var k;
var j;
var h;
if(!e&&!this.params.dontSetWidthOnFields){e=this.params.width-f*2
}if(e){this._debug.log("availableWidth: ",e);
this._debug.log("fieldConfig.width: ",l.width);
j=(l.ctor&&l.config?l.config.width:l.width)||1,h=(j<=1?Math.floor(j*e):j)
}if(l.type==="splitter"){n=a.DB.DIV("split-field clear "+(l.fields.length>1?"padding-adjust":""));
if(!l.width){l.width=1
}if(e){n.setStyle("width",(Math.round(l.width*e)+f)+"px");
k=e-(f*(l.fields.length-1))
}else{k=d.get("offsetWidth")-(f*(l.fields.length-1))-f*2
}d.append(n);
this._renderFields(c,l.fields,n,k);
if(l.countHeight){this._takenHeight+=n.get("offsetHeight")
}if(l.hidden){n.hide()
}}else{if(l.type==="multi-frame"){q=new a.Squarespace.DialogFieldGenerators[l.type](l,this.params.initialData,this);
q.type=l.type;
q.append(c,b,d,e);
if(q.getName()){this.fields[q.getName()]=q
}else{this._noNameFields.push(q)
}}else{if(l.ctor&&l.ctor==a.Squarespace.DialogFields.MultiFrame){var g=a.merge(l,l.config,{dialog:this,data:this.params.initialData[l.config.name],render:d});
q=new l.ctor(g);
if(e){q.get("boundingBox").setStyle("width",h+"px")
}var r=q.getName()||q.get("name");
if(r){this.fields[r]=q
}else{this._noNameFields.push(q)
}q.each(function(i){var w=i.getName()||i.get("name");
if(w){this.fields[w]=i
}else{this._noNameFields.push(i)
}c.tabFields.push(i);
i.tab=c
},this)
}else{if(l.type==="section"){var x=a.DB.DIV("section-inner clear");
sectionField=a.DB.DIV("section-field container-field-wrapper field-wrapper clear "+((l.style!==undefined)?l.style:""),x);
d.append(sectionField);
if(!l.width){l.width=1
}k=e;
sectionField.setStyle("width",(Math.round(l.width*k))+"px");
var t=Math.round(l.width*k);
this._renderFields(c,l.fields,x,t);
if(l.hidden){sectionField.hide()
}if(l.name){this.sections[l.name]=n
}}else{if(l.type==="stack"){n=a.DB.DIV("stack-field stack-field-wrapper clear");
d.append(n);
k=e;
if(!e){k=this.params.width-f*2
}if(!l.width){l.width=1
}if(l["float"]){n.setStyle("float",l["float"])
}n.setStyle("width",(Math.round(l.width*k))+"px");
if(o!=b.length-1){n.setStyle("paddingRight",f+"px")
}var t=Math.round(l.width*k);
this._renderFields(c,l.fields,n,t);
if(l.hidden){n.hide()
}if(l.name){this.sections[l.name]=n
}}else{var s;
var p=a.merge(l,l.config||{},{dialog:this,render:d});
var v=p.name||l.name;
if(a.Lang.isUndefined(p.data)&&this.params.initialData&&!a.Lang.isUndefined(v)){p.data=this.params.initialData[v];
p.panel=this
}if(l.ctor){s=new l.ctor(p)
}else{if(!l.type){console.error("dialog: field type was",l.type,", and constructor was",l.ctor);
console.error("dialog: config was",l);
throw"Could not find field constructor or field type."
}var u=this._convertToDialogField2Name(l.type),m=a.namespace("Squarespace.DialogFields")[u];
if(!m&&!a.Squarespace.DialogFieldGenerators[l.type]){throw"Unknown field type: "+l.type
}this._debug.log("Generating field type: ",l.type);
if(m){s=new m(p)
}else{s=new a.Squarespace.DialogFieldGenerators[l.type](l,this.params.initialData,this);
s.type=l.type;
s.append(d);
if(l.verticalSpan){this._verticalEl=s
}if(l.countHeight&&!l.verticalSpan){this._takenHeight+=s.getTakenHeight()
}}}if(e){if(a.Squarespace.DialogField2&&s instanceof a.Squarespace.DialogField2){this._debug.log("setting width",h);
s.get("boundingBox").setStyle("width",h+"px")
}else{if(s.html){this._debug.log("setting width",h);
s.html.setStyle("width",h+"px")
}}}if(s.resize){s.resize()
}if(l.hidden){s.temporaryHide(true)
}if(a.Squarespace.DialogField2&&s instanceof a.Squarespace.DialogField2){this.bodyEvents.push(s.on("dataStateChange",function(y){var w=y.newVal,i=s.getProperty("DATA_STATES");
this.fire("field-loading-change",{field:s,loading:w===w.LOADING})
},this))
}else{this.bodyEvents.push(s.on("loadingChange",function(i){this.fire("field-loading-change",{field:s,loading:i.newVal})
},this))
}if(s.getName()){this.fields[s.getName()]=s
}else{this._noNameFields.push(s)
}c.tabFields.push(s);
s.tab=c
}}}}}},this)
},resizeVerticalFields:function(){for(var b=0;
b<this.verticalFields.length;
++b){var c=this.verticalFields[b];
c.setHeight(this.getBodyHeight()-c._takenHeight)
}},renderTab:function(e,c){var d=a.DB.DIV("tab-wrapper");
d.setStyles({width:this.params.width+"px",left:(c?"0px":this.params.width+"px")});
this.bodyEl.append(d);
e.tabFields=[];
this._verticalEl=null;
this._takenHeight=0;
this._renderFields(e,e.fields||[],d);
if(!!e.noTabTitle){d.addClass("noTabTitle")
}if(this._verticalEl){var b=parseInt(d.getStyle("paddingTop"),10);
this._takenHeight+=b;
if(!this._verticalEl.setHeight){console.error("No setHeight for vertical el: ",this._verticalEl)
}this._verticalEl.setHeight(this.getBodyHeight()-this._takenHeight);
this._verticalEl._takenHeight=this._takenHeight;
this.verticalFields.push(this._verticalEl)
}e.tabPanelObj=d;
this.observedHeight+=d.get("offsetHeight");
if(c){if(e.tabFields){a.Array.forEach(e.tabFields,function(f){this._showField(f)
},this)
}}if(e.scroll){this.bodyEl.addClass("scrollable")
}else{this.bodyEl.removeClass("scrollable")
}if(!c){d.addClass("hidden")
}return d
},_convertToDialogField2Name:function(c){var d=a.Squarespace.Utils.slugify(c).split("-");
for(var b=d.length-1;
b>=0;
b--){if(d[b].capitalize){d[b]=d[b].capitalize()
}}return d.join("")+"Field"
},destroyBody:function(){this.rendered=false;
if(this.fields){for(var d in this.fields){var c=this.fields[d];
c.destroy()
}a.Array.each(this._noNameFields,function(e){if(e){e.destroy()
}},this);
this._noNameFields=[]
}this.fields={};
if(this.bodyEl&&this.bodyEl._node){this.bodyEl.empty()
}for(var b=0;
b<this.params.tabs.length;
++b){this.params.tabs[b].tabPanelObj=null;
this.params.tabs[b].tabNavigationObj=null;
this.params.tabs[b].tabFields=null
}for(var b=0;
b<this.bodyEvents.length;
b++){this.bodyEvents[b].detach()
}this.bodyEvents=[]
},destroyButtons:function(){for(var b=0;
b<this.buttonEvents.length;
b++){this.buttonEvents[b].detach()
}this.buttonEvents=[];
if(this.buttonHolder&&this.buttonHolder._node){this.buttonHolder.set("innerHTML","")
}},_destroy:function(){if(!this.preDestroyCalled){this._preDestroy()
}this.destroyTimer=null;
this.currentErrors=null;
this.bodyHeight=null;
this.destroyBody();
this.destroyButtons();
if(this.overlayEl&&!this.overlayEl.destroying){this.overlayEl.remove();
this.overlayEl=null
}for(var b=0;
b<this.globalEvents.length;
b++){this.globalEvents[b].detach()
}if(this.dd){this.dd.destroy();
this.dd=null
}this.globalEvents=[];
if(this.el){this.el.remove();
this.el=null;
this.bodyEl=null
}if(this.params.parentDialog){this.params.parentDialog.removeChildDialog(this);
this.params.parentDialog=null
}this.state=a.Squarespace.DialogStates.CLOSED;
this.position=null;
this.anchorEl=null;
this.anchorData=null
}});
a.augment(a.Squarespace.EditingDialog,a.EventTarget)
},"1.0",{requires:["node","datatype-date","node-focusmanager","anim","dd","attribute","json","node-event-simulate","transition","squarespace-animation-manager","squarespace-debugger","squarespace-dialog-fields","squarespace-dialog-field-2","squarespace-ui-base","squarespace-dombuilder","squarespace-dialog-css","squarespace-gizmo","squarespace-drag-selection"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-signup",function(a){a.namespace("Squarespace");
a.Squarespace.Signup=Singleton.create({ready:function(){this.chromeEl=null;
this.params={type:"Website",cloneIdentifier:(Static.SQUARESPACE_CONTEXT.website?Static.SQUARESPACE_CONTEXT.website.identifier:null),page:"preview"}
},show:function(d){if(d){this.params=a.merge(this.params,d)
}if(!this.signupDialog){var e={loadingText:"Loading...",savingText:"Verifying...",closingText:"Success!...",name:"squarespace-signup",discardChangesConfirmation:false,disableOverlayCancel:true,style:"transparent",overlay:1,width:425,top:120,zIndex:200000,closeOthers:false,buttons:[{type:"cancel",title:"Cancel"},{type:"saveAndClose",title:"Finish & Create Site"}],tabs:[{title:"Squarespace Signup",icon:"/universal/images-v6/dialog/login-icon.png?4",fields:[{type:"description",className:"big-signup-title",text:"Create Your "+this.params.type},{type:"description",text:"<strong>Create an account.</strong>  Enter your email and password which you'll use when logging into your Squarespace website.",padding:[10,0]},{type:"splitter",fields:[{type:"text",width:0.5,required:true,name:"firstName",title:"First Name",style:"title",titleStyle:"inline",submitOnEnter:true},{type:"text",width:0.5,required:true,name:"lastName",title:"Last Name",style:"title",titleStyle:"inline",submitOnEnter:true}]},{type:"text",required:true,name:"email",title:"your@email.com",style:"title",titleStyle:"inline",submitOnEnter:true,mailcheck:true},{type:"text",required:true,name:"password",password:true,title:"Password",style:"title",titleStyle:"inline",submitOnEnter:true},{type:"description",className:"big-signup-footer",text:'By clicking below to sign up, you are agreeing to the Squarespace <a target="new" href="http://www.squarespace.com/terms">Terms of Service.</a>'},{type:"hidden",name:"SK1"}]}]};
var b={name:"squarespace-signup",style:"transparent",overlay:1,width:375,top:180,height:150,zIndex:200000,buttons:[{type:"cancel",title:"Cancel"}],tabs:[{title:"Squarespace Signup",icon:"/universal/images-v6/dialog/login-icon.png?4",fields:[{type:"description",className:"big-signup-title",text:"Create Your "+this.params.type},{type:"description",text:"You are not using a supported web browser. Squarespace's management interface and site creation currently supports the latest versions of Firefox, Safari and Google Chrome. Please update your browser to continue.",padding:[10,0]}]}]};
if(!a.Squarespace.Utils.advancedBrowserCheck()){this.signupDialog=new a.Squarespace.EditingDialog(b)
}else{this.signupDialog=new a.Squarespace.EditingDialog(e)
}this.signupDialog.on("loading",function(){if(a.Squarespace.Management){a.Squarespace.Management.hideChrome()
}a.all(".map-widget").each(function(c){c.setStyle("visibility","hidden")
});
a.Data.get({url:"/api/auth/SignupKey",success:function(c){this.signupDialog.getField("SK1").setValue(c.key)
}},this)
},this);
this.signupDialog.on("cancel",function(){if(a.Squarespace.Management){a.Squarespace.Management.showChrome()
}a.all(".map-widget").each(function(c){c.setStyle("visibility","visible")
})
},this);
this.signupDialog.on("datachange",function(){if(!this.getData().remember){a.Cookie.remove("email")
}this.hideErrors()
});
this.signupDialog.on("show-errors",function(f){for(var c in f){a.Squarespace.Analytics.trackInternal("marketplace_signup_rejected",{field:c,reason:f[c],identifier:a.Squarespace.Signup.params.cloneIdentifier});
break
}},this);
this.signupDialog.on("send-requested",function(){a.Squarespace.Analytics.trackInternal("marketplace_signup_attempt",{identifier:a.Squarespace.Signup.params.cloneIdentifier});
var c=this.getData();
a.Data.sendForm(this,{url:"/api/auth/Signup",secure:true,data:{cloneIdentifier:a.Squarespace.Signup.params.cloneIdentifier,page:a.Squarespace.Signup.params.page,confirmOnly:true,category:a.Squarespace.Signup.params.type,developer:a.Squarespace.Signup.params.developer},success:function(f){if(a.Squarespace.Signup.params.lifeCycleTrialEventFn){a.Squarespace.Signup.params.lifeCycleTrialEventFn(f)
}a.Squarespace.Transitions.getTransition({el:this.el,name:"scale",direction:"out",duration:0.3}).run();
this.LB=new a.Squarespace.Lightbox({content:'<div class="squarespace-signup-spinner">&nbsp;</div><div class="squarespace-signup-text">Please wait a moment while your Squarespace site is created...</div>',contentOnly:true,zIndex:200100,transition:"scale",margin:0,clickAnywhereToExit:false});
this.LB.show();
var g={cloneIdentifier:a.Squarespace.Signup.params.cloneIdentifier,page:a.Squarespace.Signup.params.page,category:a.Squarespace.Signup.params.type,developer:a.Squarespace.Signup.params.developer};
if(a.Squarespace.TweakManager&&a.Squarespace.TweakManager.dialog){g.tweakSettings=a.Squarespace.TweakManager._getTweakSettings()
}a.Data.sendForm(this,{url:"/api/auth/Signup",secure:true,data:g,success:function(h){top.location.href="http://"+h.website+"."+Static.SQUARESPACE_CONTEXT.appDomain+"/config/?loginToken="+h.loginToken
},failure:function(h){this.LB.hide();
a.Squarespace.Transitions.getTransition({el:this.el,name:"scale",direction:"in",duration:0.3}).run()
}},this)
}},this)
})
}this.signupDialog.setInitialData({inviteCode:a.Cookie.get("invitationId")});
this.signupDialog.show();
a.one("body").setStyle("overflowY","visible");
a.one(".dialog-squarespace-signup").setStyle("position","absolute");
window.scrollTo(0,0);
a.Squarespace.Analytics.trackInternal("marketplace_signup_view",{identifier:a.Squarespace.Signup.params.cloneIdentifier})
},onSignupClick:function(b){if(b.target.ancestor(".squarespace-signup-tweak",true)){b.halt();
a.Squarespace.TweakManager.enable();
return
}if(b.target.ancestor(".sqsp-chrome-style-mode .sqsp-chrome-close-button",true)){b.halt();
a.Squarespace.TweakManager.disable();
return
}if(this.topOrigin){top.postMessage({installTemplate:a.Squarespace.Signup.params.cloneIdentifier},this.topOrigin)
}else{this.show({lifeCycleTrialEventData:{trial_start_origin:"template-direct"}})
}},updateSignupChrome:function(){if(Static.SQUARESPACE_CONTEXT.website.cloneable&&!a.UA.mobile&&!(window.SQUARESPACE_LOGIN&&window.SQUARESPACE_LOGIN.isLoggedIn())&&!this.chromeEl){a.Squarespace.Analytics.trackInternal("marketplace_site_view",{identifier:Static.SQUARESPACE_CONTEXT.website.identifier});
this.chromeEl=a.DB.DIV("sqsp-chrome",a.DB.DIV("sqsp-chrome-badge squarespace-signup-chrome squarespace-managed-ui",{data:{manager:this}},a.DB.DIV("squarespace-signup-avatar",{html:"&nbsp;"}),a.DB.DIV("sqsp-chrome-text squarespace-signup-about",a.DB.DIV("sqsp-chrome-text-primary squarespace-signup-username",{html:"Create a Site Like This"}),a.DB.DIV("sqsp-chrome-text-secondary squarespace-signup-description",{html:"Free trial.  Instant access."})),a.DB.DIV("sqsp-chrome-buttons",a.DB.DIV("sqs-chrome-button squarespace-signup-button squarespace-signup-create",{html:"&nbsp;"}))));
this.eventHandlers=[a.on("click",this.onSignupClick,this.chromeEl,this)];
var d=a.zen(".sqsp-chrome-style-mode.sqsp-chrome-badge");
var e=d.zen("> .sqsp-chrome-text");
e.zen("> .sqsp-chrome-text-primary").setContent("Style Mode");
e.zen("> .sqsp-chrome-text-secondary").setContent("Change fonts, colors and sizes.");
var c=d.zen("> .sqsp-chrome-buttons");
var b=c.zen("> .sqsp-chrome-button.sqsp-chrome-close-button");
this.chromeEl.append(d);
a.one(document.body).append(this.chromeEl)
}else{if(window.SQUARESPACE_LOGIN&&window.SQUARESPACE_LOGIN.isLoggedIn()){if(this.chromeEl){this.chromeEl.remove();
this.chromeEl=null
}}}}})
},"1.0",{requires:["node","squarespace-dialog","squarespace-dialog-hidden"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-ui-lang",function(a){a.namespace("Squarespace.Lang").bindPricingPlanTooltips=function(){new a.Squarespace.ToolTip({target:".feature-page-limit",title:"Page Limit",body:"Squarespace's standard package has a limit of 20 pages.  Note that adding entries to your blog do not count against your page limit, even though each entry will have its own page.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-pages",title:"Pages",body:"Squarespace's unlimited package does not place a limit on the number of pages on your site.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-bandwidth-limit",title:"Bandwidth Limit",body:"Bandwidth is a measurement of how much traffic your site is serving to visitors.  Every image and page of your site must be downloaded by your visitors with every request.  The more media and video your site serves, the more bandwidth it will require.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-bandwidth",title:"Unlimited Bandwidth",body:"Squarespace's unlimited package does not place any limits on the amount of traffic served to your site visitors.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-storage-limit",title:"Storage Limit",body:"Each image and video uploaded to your site contributes to your site's storage limit.  The more media you have on your website, the more storage it uses.  <strong>Please note that files uploaded to Squarespace are limited to 20mb in size.</strong>",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-storage",title:"Unlimited Storage",body:"Squarespace's unlimited package does not place any limits on the amount of storage your site is granted. <strong>Please note that files uploaded to Squarespace are limited to 20mb in size.</strong>",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-contributors",title:"Unlimited Contributors",body:"Squarespace's unlimited package allows you to invite multiple contributors to your site.  Contributors can be given individual permission levels, allowing them to optionally edit content, configure your website, manage billing, manage comments, or view your site's statistics.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-forms",title:"Complex Form Builder",body:"Squarespace's unlimited package allows you to use up to 16 different types of form fields in your contact forms (up from just 4 in the standard plan).  You can use these forms to collect complex information from your site's visitors.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-mailchimpdocs",title:"MailChimp/Google Docs Enabled Forms",body:"Squarespace's unlimited package allows you to connect your website forms to both Google Docs and MailChimp so you can build mailing lists and share your form data with a team.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-facebookpage",title:"Facebook Page Integration",body:"Squarespace's unlimited package allows you to connect your website with a Facebook page, making it easy to install tabs representing your site pages and galleries.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-support",title:"24/7 Premium Support",body:"All Squarespace packages include premium customer support with a 10-minute average response time.",dialogTooltip:true,showTimeout:200,clickToShow:true});
new a.Squarespace.ToolTip({target:".feature-free-domain",title:"Free Custom Domain",body:"All annual and bi-annual terms include a free custom domain of your choosing. Select between .COM, .ORG, .NET, .BIZ, or .INFO. If the domain is available, it's yours to keep. This will give your website a professional and custom look.",dialogTooltip:true,showTimeout:200,clickToShow:true})
}
},"1.0",{requires:["node","base","squarespace-ui-base"]});/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-murmurhash",function(c){c.namespace("Squarespace");
c.Squarespace.MurmurHash={hash:function(e,d){return a(b(e),d)
}};
function a(n,j){var o,p,l,e,h,d,f,m,k,g;
o=n.length&3;
p=n.length-o;
l=j;
h=3432918353;
f=461845907;
g=0;
while(g<p){k=((n.charCodeAt(g)&255))|((n.charCodeAt(++g)&255)<<8)|((n.charCodeAt(++g)&255)<<16)|((n.charCodeAt(++g)&255)<<24);
++g;
k=((((k&65535)*h)+((((k>>>16)*h)&65535)<<16)))&4294967295;
k=(k<<15)|(k>>>17);
k=((((k&65535)*f)+((((k>>>16)*f)&65535)<<16)))&4294967295;
l^=k;
l=(l<<13)|(l>>>19);
e=((((l&65535)*5)+((((l>>>16)*5)&65535)<<16)))&4294967295;
l=(((e&65535)+27492)+((((e>>>16)+58964)&65535)<<16))
}k=0;
switch(o){case 3:k^=(n.charCodeAt(g+2)&255)<<16;
case 2:k^=(n.charCodeAt(g+1)&255)<<8;
case 1:k^=(n.charCodeAt(g)&255);
k=(((k&65535)*h)+((((k>>>16)*h)&65535)<<16))&4294967295;
k=(k<<15)|(k>>>17);
k=(((k&65535)*f)+((((k>>>16)*f)&65535)<<16))&4294967295;
l^=k
}l^=n.length;
l^=l>>>16;
l=(((l&65535)*2246822507)+((((l>>>16)*2246822507)&65535)<<16))&4294967295;
l^=l>>>13;
l=((((l&65535)*3266489909)+((((l>>>16)*3266489909)&65535)<<16)))&4294967295;
l^=l>>>16;
return l
}function b(e){var d=e.replace(/[\u0080-\u07ff]/g,function(g){var f=g.charCodeAt(0);
return String.fromCharCode(192|f>>6,128|f&63)
});
d=d.replace(/[\u0800-\uffff]/g,function(g){var f=g.charCodeAt(0);
return String.fromCharCode(224|f>>12,128|f>>6&63,128|f&63)
});
return d
}},"1.0");/* Host: nyc-webster3 Request Version: 12232012020414 Local Version: 12232012020414 Served from: LOCAL */ 
YUI.add("squarespace-abtest",function(c){c.namespace("Squarespace");
var o=/^[a-zA-Z]\w{0,63}$/;
var h=/^[a-zA-Z0-9][\w ]{0,63}$/;
var l=/^[a-zA-Z0-9][\w ]{0,63}$/;
var k="SS_MID";
var g="SS_ABPP";
var j=42;
var m=0.1;
var p=function(s){q(s.participations);
c.io("/api/events/ABTest",{data:{variation:s.selected.name,selectionCriteria:s.user,description:c.JSON.stringify(s.test._description)},on:{}})
};
var i=[];
var a=-1;
var b=0;
var r="__non_participant__";
var n=function(s){if(!c.Array.test(s)||!s.length){throw"Must provide a non-empty array of test names"
}var t=c.Array(s);
return function(v,u){return !c.Object.some(u,function(y,x){var w=x.indexOf(":");
if(w<0){return false
}var z=x.substring(0,w);
if(c.Array.some(t,function(A){return z==A
})){return true
}return false
})
}
};
var e=function(t){if(!c.Array.test(t)||!t.length){throw"Must provide a non-empty array of test names"
}var s={};
c.Array.each(t,function(u){s[u]=false
});
return function(v,u){c.Object.each(u,function(y,x){var w=x.indexOf(":");
if(w<0){return false
}var z=x.substring(0,w);
if(c.Object.hasKey(s,z)){s[z]=true
}});
return !c.Object.some(s,function(x,w){return !x
})
}
};
function q(s){c.Cookie.set(g,c.QueryString.stringify(s))
}function f(){var s=c.Cookie.get(g);
return(s==null)?{}:c.QueryString.parse(s)
}function d(s,w){if(!o.test(s)){throw"Test name must match regex "+o
}if(w===undefined){w=100
}else{if(!(typeof w==="number"&&Math.floor(w)===w)||(w<2)){throw"Units must be an integer > 2, not: "+w
}}this.name=s;
this._variations=[];
this._conversion_goal=null;
this._total_units=w;
this._selection_listeners=[];
this._participation_filters=[];
this._item_for_non_participant=null;
this._finalized=false;
function C(D){if(D==null){return null
}return D.toString()
}function y(E){var D=c.JSON.stringify({name:E.name,totalFrequencyUnits:E.totalFrequencyUnits,variations:E.variations});
return c.Squarespace.MurmurHash.hash(D)
}function x(G){var F={name:G.name,totalFrequencyUnits:G._total_units,variations:[],conversionGoal:G._conversion_goal};
for(var E=0;
E<G._variations.length;
E++){var D=G._variations[E];
F.variations.push({name:D.name,frequency:D.units,item:C(D.item)})
}F.variations.sort(function(I,H){return I.name<H.name?-1:(I.name>H.name?1:0)
});
F.hash=y(F);
return F
}function v(K){if(K._finalized){return
}if(K._variations.length<2){throw"Must have at least two variations defined."
}K._variations.sort(function(O,N){return O.name<N.name?-1:(O.name>N.name?1:0)
});
var G=0;
var J=new Array();
var E=new Array();
K._variations.forEach(function(N){if(N.units!=a){G+=N.units;
J.push(N)
}else{E.push(N)
}});
if(E.length>0){if(G>=K._total_units){throw"Total units for variations excluding the REMAINDER variations must be less than total units of "+K._total_units+", instead of "+G
}var D=K._total_units-G;
var L=Math.floor(D/E.length);
var F=D%E.length;
if(L<1){throw"Remaining "+D+" units cannot be distributed among "+E.length+" variations."
}for(var I=0;
I<E.length;
I++){var M=E[I];
var H=I+1==E.length;
M.units=H?(L+F):L;
G+=M.units;
J.push(M)
}}if(G!=K._total_units){throw"Total units for all variations must equal the specified total units of "+K._total_units+", instead of "+G
}K._variations=J;
if(K._conversion_goal==null){throw"Must define a conversionGoal for a test"
}K._description=x(K);
K._finalized=true
}function t(E,F,D){return(Math.abs(c.Squarespace.MurmurHash.hash(E+F,j))&65535)%D
}function z(I,E,G){var D=null;
var J=0;
var H=0;
for(var F=0;
F<I.length;
F++){D=I[F];
H=J+D.units;
if(G>=J&&G<H){break
}J=H
}if(!D){throw"No variation found for bucket id: "+G
}return D
}function A(F,D){for(var E=0;
E<F.length;
E++){if(F[E].name==D){return F[E]
}}return null
}function u(J,E,D,H){if(J._finalized){throw"Cannot add a variation to a test already finalized and used for selection"
}for(var F=0;
F<J._variations.length;
F++){var G=J._variations[F];
if(E==G.name){throw"Already have a test variation with name: "+E
}}var I={name:E,units:D,item:H};
J._variations.push(I)
}function B(G,E){for(var D=0;
D<i.length;
D++){try{i[D](E)
}catch(F){console.log("Global selection listener error: "+F)
}}for(var D=0;
D<G._selection_listeners.length;
D++){try{G._selection_listeners[D](E)
}catch(F){console.log("Selection listener error: "+F)
}}}this.variation=function(E,D,G){var F;
if(arguments.length==2){G=D;
F=a
}else{F=parseInt(D,10);
if(isNaN(F)||(F<1)){throw"Units must be a number > 0, not: "+D
}}if(!h.test(E)){throw"Variation name must match regex "+h
}u(this,E,F,G);
return this
};
this.conversionGoal=function(D,E){if(this._conversion_goal!=null){throw"Already defined a conversion goal: "+this._conversion_goal
}if(!l.test(D)){throw"Conversion goal name must match regex "+l
}if(E===undefined){E=m
}if(isNaN(E)){throw"percent_change_target for a conversion goal must be number"
}if(E>1||E<-1){throw"percent_change_target is a fraction, e.g. 0.10 for 10%. Cannot exceed 1 or be less than -1."
}this._conversion_goal={metric:D,targetPercentChange:E};
return this
};
this.filter=function(E,D){this._participation_filters.push(E);
if(arguments.length>1){this._item_for_non_participant=D
}return this
};
this.filterOutParticipantsInOtherTests=function(D,E){if(arguments.length>1){return this.filter(n(D),E)
}else{return this.filter(n(D))
}};
this.requireParticipationInOtherTests=function(D,E){if(arguments.length>1){return this.filter(e(D),E)
}else{return this.filter(e(D))
}};
this.itemForNonParticipant=function(D){this._item_for_non_participant=D;
return this
};
this.addSelectionListener=function(D){this._selection_listeners.push(D);
return this
};
this.removeSelectionListener=function(E){var D=this._selection_listeners.indexOf(E);
if(D>=0){this._selection_listeners.splice(D,1)
}return this
};
this.pastParticipationKey=function(){v(this);
return this.name+":"+this._description.hash
};
this.select=function(){v(this);
var F=f();
var K=c.Cookie.get(k)||"";
var L=null;
var E=null;
var I=true;
if(F[this.pastParticipationKey()]!==undefined){L=A(this._variations,F[this.pastParticipationKey()])
}if(L==null){var D=false;
for(var G=0;
G<this._participation_filters.length;
G++){if(!this._participation_filters[G](K,F)){D=true;
break
}}if(D){L={name:r,units:b,item:this._item_for_non_participant};
I=false
}else{E=t(K,this.name,this._total_units);
L=z(this._variations,this._total_units,E);
F[this.pastParticipationKey()]=L.name
}}var J={test:this,selected:L,bucket_id:E,user:K,participations:F};
if(I){try{p(J)
}catch(H){console.log("ABTest selection recording error: "+H)
}}B(this,J);
return L.item
};
return this
}c.Squarespace.ABTest={newTest:function(t,s){return new d(t,s)
},addSelectionListener:function(s){i.push(s)
},removeSelectionListener:function(t){var s=i.indexOf(t);
if(s>=0){i.splice(s,1)
}}}
},"1.0",{requires:["io-base","cookie","json","querystring-stringify-simple","querystring-parse-simple","squarespace-murmurhash"]});